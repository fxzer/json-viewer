import{i as Ze,a as $,b as at,c as U,u as qe,A as Xt,d as gr,p as pr,f as fo,e as A,g as rn,t as go,h as le,j as Gt,R as _t,l as yr,C as mr,k as gt,T as Rs,P as Rt,I as po,E as ei,m as an,n as yo,o as mo,F as vr,s as Qe,q as Te,H as vo,r as B,v as xe,w as br,x as tt,y as Er,z as cn,G as Ls,B as bo,D as ni,J as Eo,K as xo,L as si,M as xr,N as Sr,O as vs,Q as So,S as bs,U as Or,V as Es,W as Dr,X as wr,Y as Cr,Z as _r,_ as Tr,$ as Ar,a0 as Mr,a1 as Pr,a2 as Rr,a3 as Oo,a4 as Lr,a5 as ii,a6 as oi,a7 as Nr,a8 as Ir,a9 as kr,aa as ke,ab as Br,ac as jr,ad as zr,ae as Fr,af as $r,ag as Wr,ah as Vr,ai as Hr,aj as Ur,ak as Yr,al as Kr}from"./vendor-DpL_3BW5.js";const Xr={duration:500},Gr={duration:1e3,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",iterations:1,fill:"both"};var I;(function(i){i.NodeAdded="NodeAdded",i.NodeUpdated="NodeUpdated",i.NodeRemoved="NodeRemoved",i.EdgeAdded="EdgeAdded",i.EdgeUpdated="EdgeUpdated",i.EdgeRemoved="EdgeRemoved",i.ComboAdded="ComboAdded",i.ComboUpdated="ComboUpdated",i.ComboRemoved="ComboRemoved"})(I||(I={}));var q;(function(i){i.DRAW="draw",i.COLLAPSE="collapse",i.EXPAND="expand",i.TRANSFORM="transform"})(q||(q={}));var Dt;(function(i){i.CLICK="canvas:click",i.DBLCLICK="canvas:dblclick",i.POINTER_OVER="canvas:pointerover",i.POINTER_LEAVE="canvas:pointerleave",i.POINTER_ENTER="canvas:pointerenter",i.POINTER_MOVE="canvas:pointermove",i.POINTER_OUT="canvas:pointerout",i.POINTER_DOWN="canvas:pointerdown",i.POINTER_UP="canvas:pointerup",i.CONTEXT_MENU="canvas:contextmenu",i.DRAG_START="canvas:dragstart",i.DRAG="canvas:drag",i.DRAG_END="canvas:dragend",i.DRAG_ENTER="canvas:dragenter",i.DRAG_OVER="canvas:dragover",i.DRAG_LEAVE="canvas:dragleave",i.DROP="canvas:drop",i.WHEEL="canvas:wheel"})(Dt||(Dt={}));var Ht;(function(i){i.CLICK="combo:click",i.DBLCLICK="combo:dblclick",i.POINTER_OVER="combo:pointerover",i.POINTER_LEAVE="combo:pointerleave",i.POINTER_ENTER="combo:pointerenter",i.POINTER_MOVE="combo:pointermove",i.POINTER_OUT="combo:pointerout",i.POINTER_DOWN="combo:pointerdown",i.POINTER_UP="combo:pointerup",i.CONTEXT_MENU="combo:contextmenu",i.DRAG_START="combo:dragstart",i.DRAG="combo:drag",i.DRAG_END="combo:dragend",i.DRAG_ENTER="combo:dragenter",i.DRAG_OVER="combo:dragover",i.DRAG_LEAVE="combo:dragleave",i.DROP="combo:drop"})(Ht||(Ht={}));var x;(function(i){i.CLICK="click",i.DBLCLICK="dblclick",i.POINTER_OVER="pointerover",i.POINTER_LEAVE="pointerleave",i.POINTER_ENTER="pointerenter",i.POINTER_MOVE="pointermove",i.POINTER_OUT="pointerout",i.POINTER_DOWN="pointerdown",i.POINTER_UP="pointerup",i.CONTEXT_MENU="contextmenu",i.DRAG_START="dragstart",i.DRAG="drag",i.DRAG_END="dragend",i.DRAG_ENTER="dragenter",i.DRAG_OVER="dragover",i.DRAG_LEAVE="dragleave",i.DROP="drop",i.KEY_DOWN="keydown",i.KEY_UP="keyup",i.WHEEL="wheel",i.PINCH="pinch"})(x||(x={}));var ce;(function(i){i.KEY_DOWN="keydown",i.KEY_UP="keyup"})(ce||(ce={}));var Je;(function(i){i.CLICK="edge:click",i.DBLCLICK="edge:dblclick",i.POINTER_OVER="edge:pointerover",i.POINTER_LEAVE="edge:pointerleave",i.POINTER_ENTER="edge:pointerenter",i.POINTER_MOVE="edge:pointermove",i.POINTER_OUT="edge:pointerout",i.POINTER_DOWN="edge:pointerdown",i.POINTER_UP="edge:pointerup",i.CONTEXT_MENU="edge:contextmenu",i.DRAG_ENTER="edge:dragenter",i.DRAG_OVER="edge:dragover",i.DRAG_LEAVE="edge:dragleave",i.DROP="edge:drop"})(Je||(Je={}));var O;(function(i){i.BEFORE_CANVAS_INIT="beforecanvasinit",i.AFTER_CANVAS_INIT="aftercanvasinit",i.BEFORE_SIZE_CHANGE="beforesizechange",i.AFTER_SIZE_CHANGE="aftersizechange",i.BEFORE_ELEMENT_CREATE="beforeelementcreate",i.AFTER_ELEMENT_CREATE="afterelementcreate",i.BEFORE_ELEMENT_UPDATE="beforeelementupdate",i.AFTER_ELEMENT_UPDATE="afterelementupdate",i.BEFORE_ELEMENT_DESTROY="beforeelementdestroy",i.AFTER_ELEMENT_DESTROY="afterelementdestroy",i.BEFORE_ELEMENT_TRANSLATE="beforeelementtranslate",i.AFTER_ELEMENT_TRANSLATE="afterelementtranslate",i.BEFORE_DRAW="beforedraw",i.AFTER_DRAW="afterdraw",i.BEFORE_RENDER="beforerender",i.AFTER_RENDER="afterrender",i.BEFORE_ANIMATE="beforeanimate",i.AFTER_ANIMATE="afteranimate",i.BEFORE_LAYOUT="beforelayout",i.AFTER_LAYOUT="afterlayout",i.BEFORE_STAGE_LAYOUT="beforestagelayout",i.AFTER_STAGE_LAYOUT="afterstagelayout",i.BEFORE_TRANSFORM="beforetransform",i.AFTER_TRANSFORM="aftertransform",i.BATCH_START="batchstart",i.BATCH_END="batchend",i.BEFORE_DESTROY="beforedestroy",i.AFTER_DESTROY="afterdestroy",i.BEFORE_RENDERER_CHANGE="beforerendererchange",i.AFTER_RENDERER_CHANGE="afterrendererchange"})(O||(O={}));var Pt;(function(i){i.UNDO="undo",i.REDO="redo",i.CANCEL="cancel",i.ADD="add",i.CLEAR="clear",i.CHANGE="change"})(Pt||(Pt={}));var rt;(function(i){i.CLICK="node:click",i.DBLCLICK="node:dblclick",i.POINTER_OVER="node:pointerover",i.POINTER_LEAVE="node:pointerleave",i.POINTER_ENTER="node:pointerenter",i.POINTER_MOVE="node:pointermove",i.POINTER_OUT="node:pointerout",i.POINTER_DOWN="node:pointerdown",i.POINTER_UP="node:pointerup",i.CONTEXT_MENU="node:contextmenu",i.DRAG_START="node:dragstart",i.DRAG="node:drag",i.DRAG_END="node:dragend",i.DRAG_ENTER="node:dragenter",i.DRAG_OVER="node:dragover",i.DRAG_LEAVE="node:dragleave",i.DROP="node:drop"})(rt||(rt={}));const R="combo",J="tree";var Se;(function(i){i.NODE="node",i.EDGE="edge",i.COMBO="combo",i.THEME="theme",i.PALETTE="palette",i.LAYOUT="layout",i.BEHAVIOR="behavior",i.PLUGIN="plugin",i.ANIMATION="animation",i.TRANSFORM="transform",i.SHAPE="shape"})(Se||(Se={}));const xs={animation:{},behavior:{},combo:{},edge:{},layout:{},node:{},palette:{},theme:{},plugin:{},transform:{},shape:{}};function wt(i,t){var e;const n=(e=xs[i])===null||e===void 0?void 0:e[t];if(n)return n}const Zr="5.0.45",qr="G6";function St(i){return`[${qr} v${Zr}] ${i}`}const yt={mute:!1,debug:i=>{console.debug(St(i))},info:i=>{console.info(St(i))},warn:i=>{console.warn(St(i))},error:i=>{console.error(St(i))}};function Do(i){const{theme:t}=i;if(!t)return{};const e=wt(Se.THEME,t);return e||(yt.warn(`The theme of ${t} is not registered.`),{})}function Ns(i,t){if(Array.isArray(i)&&i.length===0)return null;const e=Array.isArray(i)?i[0]:i,n=Array.isArray(i)?i.slice(1):t||[];return new Proxy(e,{get(s,o){return typeof s[o]=="function"&&!["onframe","onfinish"].includes(o)?(...r)=>{s[o](...r),n.forEach(a=>{var c;return(c=a[o])===null||c===void 0?void 0:c.call(a,...r)})}:o==="finished"?Promise.all([e.finished,...n.map(r=>r.finished)]):Reflect.get(s,o)},set(s,o,r){return["onframe","onfinish"].includes(o)||n.forEach(a=>{a[o]=r}),Reflect.set(s,o,r)}})}function Ss(i){const t=i.reduce((n,s)=>(Object.entries(s).forEach(([o,r])=>{n[o]===void 0?n[o]=[r]:n[o].push(r)}),n),{});Object.entries(t).forEach(([n,s])=>{(s.length!==i.length||s.some(o=>Ze(o))||s.every(o=>!["sourceNode","targetNode","childrenNode"].includes(n)&&$(o,s[0])))&&delete t[n]});const e=Object.entries(t).reduce((n,[s,o])=>(o.forEach((r,a)=>{n[a]?n[a][s]=r:n[a]={[s]:r}}),n),[]);return i.length!==0&&e.length===0&&e.push({_:0},{_:0}),e}function Oe(i){switch(i){case"opacity":return 1;case"x":case"y":case"z":case"zIndex":return 0;case"visibility":return"visible";case"collapsed":return!1;case"states":return[];default:return}}function wo(i,t){const{animation:e}=i;if(e===!1||t===!1)return!1;const n=Object.assign({},Xr);return at(e)&&Object.assign(n,e),at(t)&&Object.assign(n,t),n}function Qr(i){if(typeof i=="string"){const t=wt(Se.ANIMATION,i);return t||(yt.warn(`The animation of ${i} is not registered.`),[])}return i}function Jr(i,t,e,n){var s,o;const{animation:r}=i;if(r===!1||n===!1)return[];const a=(s=i==null?void 0:i[t])===null||s===void 0?void 0:s.animation;if(a===!1)return[];const c=a==null?void 0:a[e];if(c===!1)return[];const l=(o=Do(i)[t])===null||o===void 0?void 0:o.animation,d=(u=[])=>Qr(u).map(f=>Object.assign(Object.assign(Object.assign(Object.assign({},Gr),at(r)&&r),f),at(n)&&n));if(c)return d(c);if(!l)return[];const h=l[e];return h===!1?[]:d(h)}function Co(i,t,e,n=[]){if(!n&&i===0&&t===0&&e===0)return null;if(Array.isArray(n)){let o=-1;const r=[];for(let a=0;a<n.length;a++){const c=n[a];if(c[0]==="translate"){if(c[1]===i&&c[2]===t)return null;o=a,r.push(["translate",i,t])}else if(c[0]==="translate3d"){if(c[1]===i&&c[2]===t&&c[3]===e)return null;o=a,r.push(["translate3d",i,t,e??0])}else r.push(c)}return o===-1&&r.splice(0,0,U(e)?["translate3d",i,t,e??0]:["translate",i,t]),r.length===0?null:r}const s=n?n.replace(/translate(3d)?\([^)]*\)/g,""):"";return e===0?`translate(${i}, ${t})${s}`:`translate3d(${i}, ${t}, ${e})${s}`}var ta=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};const ea=(i,t,e)=>{if(!e.length)return null;const[n,s]=t,o=l=>{var d;if(l){const h=i.getShape(l);if(!h)return null;const u=`get${qe(l)}Style`,f=((d=i==null?void 0:i[u])===null||d===void 0?void 0:d.bind(i))||(y=>y),g=(f==null?void 0:f(n))||{},p=(f==null?void 0:f(s))||{};return{shape:h,fromStyle:g,toStyle:p}}else return{shape:i,fromStyle:n,toStyle:s}};let r;const a=e.map(l=>{var{fields:d,shape:h,states:u}=l,f=ta(l,["fields","shape","states"]);const g=o(h);if(!g)return null;const{shape:p,fromStyle:y,toStyle:m}=g,E=[{},{}];if(d.forEach(S=>{var D,w;Object.assign(E[0],{[S]:(D=y[S])!==null&&D!==void 0?D:Oe(S)}),Object.assign(E[1],{[S]:(w=m[S])!==null&&w!==void 0?w:Oe(S)})}),E.some(S=>Object.keys(S).some(D=>["x","y","z"].includes(D)))){const{x:S=0,y:D=0,z:w,transform:C=""}=p.attributes||{};E.forEach(_=>{var M,k,ct;_.transform=Co((M=_.x)!==null&&M!==void 0?M:S,(k=_.y)!==null&&k!==void 0?k:D,(ct=_.z)!==null&&ct!==void 0?ct:w,C)})}const b=p.animate(Ss(E),f);return h===void 0&&(r=b),b}).filter(Boolean),c=r||(a==null?void 0:a[0]);return c?Ns(c,a.filter(l=>l!==l)):null},na=[{fields:["opacity"]}],sa=[{fields:["x","y"]}],_o=[{fields:["x","y"]}],ia=_o,To=[{fields:["sourceNode","targetNode"]}],oa=To,Ao=[{fields:["childrenNode","x","y"]}],ra=Ao;function aa(i){return"source"in i&&"target"in i}function ca(i){return i.length===2}function de(i){return i instanceof Float32Array?!0:Array.isArray(i)&&(i.length===2||i.length===3)?i.every(t=>typeof t=="number"):!1}function pt(i,t,e){return i>=t&&i<=e}function mt(i=0){if(Array.isArray(i)){const[t=0,e=t,n=t,s=e]=i;return[t,e,n,s]}return[i,i,i,i]}function la(i=0){const t=mt(i);return t[0]+t[2]}function vt(i){return i.max[0]-i.min[0]}function bt(i){return i.max[1]-i.min[1]}function jt(i){return[vt(i),bt(i)]}function Lt(i,t){const e=de(i)?Is(i):i.getShape("key").getBounds();return t?zt(e,t):e}function Is(i){const[t,e,n=0]=i,s=new Xt;return s.setMinMax([t,e,n],[t,e,n]),s}function zt(i,t){const[e,n,s,o]=mt(t),[r,a,c]=i.min,[l,d,h]=i.max,u=new Xt;return u.setMinMax([r-o,a-e,c],[l+n,d+s,h]),u}function Ae(i){if(i.length===0)return new Xt;if(i.length===1)return i[0];const t=new Xt;t.setMinMax(i[0].min,i[0].max);for(let e=1;e<i.length;e++){const n=i[e];t.setMinMax([Math.min(t.min[0],n.min[0]),Math.min(t.min[1],n.min[1]),Math.min(t.min[2],n.min[2])],[Math.max(t.max[0],n.max[0]),Math.max(t.max[1],n.max[1]),Math.max(t.max[2],n.max[2])])}return t}function da(i,t){const[e,n]=i.min,[s,o]=i.max,[r,a]=t.min,[c,l]=t.max;return e>=r&&s<=c&&n>=a&&o<=l}function ht(i,t){return pt(i[0],t.min[0],t.max[0])&&pt(i[1],t.min[1],t.max[1])}function Mo(i,t,e=!1){const{min:[n,s],max:[o,r]}=t,a=(i[1]===s||i[1]===r)&&(e||pt(i[0],n,o)),c=(i[0]===n||i[0]===o)&&(e||pt(i[1],s,r));return a||c}function ha(i,t){return!ht(i,t)}function tn(i,t){const{center:e}=t;return i[0]===e[0]&&i[1]===e[1]}function be(i,t){const[e,n]=i,[s,o]=t.min,[r,a]=t.max,c=e-s,l=r-e,d=n-o,h=a-n,u=Math.min(c,l,d,h);return u===c?"left":u===l?"right":u===d?"top":u===h?"bottom":"left"}function Yt(i,t){const e=gr(i);if(ht(i,t))switch(be(i,t)){case"left":e[0]=t.min[0];break;case"right":e[0]=t.max[0];break;case"top":e[1]=t.min[1];break;case"bottom":e[1]=t.max[1];break}else{const[n,s]=i,[o,r]=t.min,[a,c]=t.max;e[0]=pt(n,o,a)?n:n<o?o:a,e[1]=pt(s,r,c)?s:s<r?r:c}return e}function ua(i,t){const{center:e}=i,[n,s]=jt(i),o=t==="up"||t==="down"?e[0]:t==="right"?e[0]-n/6:e[0]+n/6,r=t==="left"||t==="right"?e[1]:t==="down"?e[1]-s/6:e[1]+s/6;return[o,r]}function fa(i,t){let[e,n]=jt(i);return[e,n]=t==="up"||t==="down"?[e,n]:[n,e],(Math.pow(n,2)-Math.pow(Math.sqrt(Math.pow(e/2,2)+Math.pow(n,2))-e/2,2))/(2*n)}function ga(i){const{min:[t,e],max:[n,s]}=i,o=[t,s],r=[n,s],a=[n,e],c=[t,e];return[[o,r],[r,a],[a,c],[c,o]]}function v(i){if(i.id!==void 0)return i.id;if(i.source!==void 0&&i.target!==void 0)return`${i.source}-${i.target}`;throw new Error(St("The datum does not have available id."))}function Be(i){return i.combo}function Po(i,t){const e={nodes:(i.nodes||[]).map(v),edges:(i.edges||[]).map(v),combos:(i.combos||[]).map(v)};return t?Object.values(e).flat():e}const Ro=(i,t,e)=>{var n;switch(e.type){case"degree":{const s=new Map;return(n=i.nodes)===null||n===void 0||n.forEach(o=>{const r=t(v(o),e.direction).length;s.set(v(o),r)}),s}case"betweenness":return pa(i,e.directed,e.weightPropertyName);case"closeness":return ya(i,e.directed,e.weightPropertyName);case"eigenvector":return va(i,e.directed);case"pagerank":return ma(i,e.epsilon,e.linkProb);default:return Lo(i)}},Lo=i=>{var t;const e=new Map;return(t=i.nodes)===null||t===void 0||t.forEach(n=>{e.set(v(n),0)}),e},pa=(i,t,e)=>{const n=Lo(i),{nodes:s=[]}=i;return s.forEach(o=>{s.forEach(r=>{if(o!==r){const{allPath:a}=fo(i,v(o),v(r),t,e),c=a.length;a.flat().forEach(l=>{l!==v(o)&&l!==v(r)&&n.set(l,n.get(l)+1/c)})}})}),n},ya=(i,t,e)=>{const n=new Map,{nodes:s=[]}=i;return s.forEach(o=>{const r=s.reduce((a,c)=>{if(o!==c){const{length:l}=fo(i,v(o),v(c),t,e);a+=l}return a},0);n.set(v(o),1/r)}),n},ma=(i,t,e)=>{var n;const s=new Map,o=pr(i,t,e);return(n=i.nodes)===null||n===void 0||n.forEach(r=>{s.set(v(r),o[v(r)])}),s},va=(i,t)=>{const{nodes:e=[]}=i,n=ba(i,t),s=Ea(n,e.length),o=new Map;return e.forEach((r,a)=>{o.set(v(r),s[a])}),o},ba=(i,t)=>{const{nodes:e=[],edges:n=[]}=i,s=Array(e.length).fill(null).map(()=>Array(e.length).fill(0));return n.forEach(({source:o,target:r})=>{const a=e.findIndex(l=>v(l)===o),c=e.findIndex(l=>v(l)===r);t?s[a][c]=1:(s[a][c]=1,s[c][a]=1)}),s},Ea=(i,t,e=100,n=1e-6)=>{let s=Array(t).fill(1),o=1/0;for(let r=0;r<e&&o>n;r++){const a=Array(t).fill(0);for(let l=0;l<t;l++)for(let d=0;d<t;d++)a[l]+=i[l][d]*s[d];const c=Math.sqrt(a.reduce((l,d)=>l+d*d,0));for(let l=0;l<t;l++)a[l]/=c;o=Math.sqrt(a.reduce((l,d,h)=>l+(d-s[h])*d,0)),s=a}return s};function It(i,t,e,n=$){const s=new Map(i.map(u=>[e(u),u])),o=new Map(t.map(u=>[e(u),u])),r=new Set(s.keys()),a=new Set(o.keys()),c=[],l=[],d=[],h=[];return a.forEach(u=>{r.has(u)?n(s.get(u),o.get(u))?h.push(o.get(u)):l.push(o.get(u)):c.push(o.get(u))}),r.forEach(u=>{a.has(u)||d.push(s.get(u))}),{enter:c,exit:d,keep:h,update:l}}function Zt(i,t,e){const n=s=>{e&&!e(s)||(s.style.visibility=t)};i.forEach(s=>{n(s)})}function xa(i,t,e){const n={},s=o=>(o in n||(n[o]=0),`${t}-${o}-${n[o]++}`);return e.map(o=>typeof o=="string"?{type:o,key:s(o)}:typeof o=="function"?o.call(i):o.key?o:Object.assign(Object.assign({},o),{key:s(o.type)}))}class ks{constructor(t){this.extensions=[],this.extensionMap={},this.context=t}setExtensions(t){const e=xa(this.context.graph,this.category,t),{enter:n,update:s,exit:o,keep:r}=It(this.extensions,e,a=>a.key);this.createExtensions(n),this.updateExtensions([...s,...r]),this.destroyExtensions(o),this.extensions=e}createExtension(t){const{category:e}=this,{key:n,type:s}=t,o=wt(e,s);if(!o)return yt.warn(`The extension ${s} of ${e} is not registered.`);const r=new o(this.context,t);this.extensionMap[n]=r}createExtensions(t){t.forEach(e=>this.createExtension(e))}updateExtension(t){const{key:e}=t,n=this.extensionMap[e];n&&n.update(t)}updateExtensions(t){t.forEach(e=>this.updateExtension(e))}destroyExtension(t){const e=this.extensionMap[t];e&&(e.destroy(),delete this.extensionMap[t])}destroyExtensions(t){t.forEach(({key:e})=>this.destroyExtension(e))}destroy(){Object.values(this.extensionMap).forEach(t=>t.destroy()),this.context={},this.extensions=[],this.extensionMap={}}}class Bs{constructor(t,e){this.events=[],this.destroyed=!1,this.context=t,this.options=e}update(t){this.options=Object.assign(this.options,t)}destroy(){this.context={},this.options={},this.destroyed=!0}}class st extends Bs{}class ln extends st{constructor(t,e){super(t,Object.assign({},ln.defaultOptions,e)),this.isOverlapping=(n,s)=>s.some(o=>n.intersects(o)),this.occupiedBounds=[],this.detectLabelCollision=n=>{const s=this.context.viewport,o={show:[],hide:[]};return this.occupiedBounds=[],n.forEach(r=>{const a=r.getShape("label").getRenderBounds();s.isInViewport(a,!0)&&!this.isOverlapping(a,this.occupiedBounds)?(o.show.push(r),this.occupiedBounds.push(zt(a,this.options.padding))):o.hide.push(r)}),o},this.hideLabelIfExceedViewport=(n,s)=>{const{exit:o}=It(n,s,r=>r.id);o==null||o.forEach(this.hideLabel)},this.nodeCentralities=new Map,this.sortNodesByCentrality=(n,s)=>{const{model:o}=this.context,r=o.getData(),a=o.getRelatedEdgesData.bind(o);return n.map(l=>(this.nodeCentralities.has(l.id)||(this.nodeCentralities=Ro(r,a,s)),{node:l,centrality:this.nodeCentralities.get(l.id)})).sort((l,d)=>d.centrality-l.centrality).map(l=>l.node)},this.sortLabelElementsInView=n=>{const{sort:s,sortNode:o,sortCombo:r,sortEdge:a}=this.options,{model:c}=this.context;if(A(s))return n.sort((p,y)=>s(c.getElementDataById(p.id),c.getElementDataById(y.id)));const{node:l=[],edge:d=[],combo:h=[]}=rn(n,p=>p.type),u=A(r)?h.sort((p,y)=>r(...c.getComboData([p.id,y.id]))):h,f=A(o)?l.sort((p,y)=>o(...c.getNodeData([p.id,y.id]))):this.sortNodesByCentrality(l,o),g=A(a)?d.sort((p,y)=>a(...c.getEdgeData([p.id,y.id]))):d;return[...u,...f,...g]},this.labelElementsInView=[],this.isFirstRender=!0,this.onToggleVisibility=n=>{var s;if(((s=n.data)===null||s===void 0?void 0:s.stage)==="zIndex")return;if(!this.validate(n)){this.hiddenElements.size>0&&(this.hiddenElements.forEach(this.showLabel),this.hiddenElements.clear());return}const o=this.isFirstRender?this.getLabelElements():this.getLabelElementsInView();this.hideLabelIfExceedViewport(this.labelElementsInView,o),this.labelElementsInView=o;const r=this.sortLabelElementsInView(this.labelElementsInView),{show:a,hide:c}=this.detectLabelCollision(r);for(let l=a.length-1;l>=0;l--)this.showLabel(a[l]);c.forEach(this.hideLabel)},this.hiddenElements=new Map,this.hideLabel=n=>{const s=n.getShape("label");s&&Zt(s,"hidden"),this.hiddenElements.set(n.id,n)},this.showLabel=n=>{const s=n.getShape("label");s&&Zt(s,"visible"),n.toFront(),this.hiddenElements.delete(n.id)},this.onTransform=go(this.onToggleVisibility,this.options.throttle,{leading:!0}),this.enableToggle=!0,this.toggle=n=>{this.enableToggle&&this.onToggleVisibility(n)},this.onBeforeRender=()=>{this.enableToggle=!1},this.onAfterRender=n=>{this.onToggleVisibility(n),this.enableToggle=!0},this.bindEvents()}update(t){this.unbindEvents(),super.update(t),this.bindEvents(),this.onToggleVisibility({})}getLabelElements(){const{elementMap:t}=this.context.element,e=[];for(const n in t){const s=t[n];s.isVisible()&&s.getShape("label")&&e.push(s)}return e}getLabelElementsInView(){const t=this.context.viewport;return this.getLabelElements().filter(e=>t.isInViewport(e.getShape("key").getRenderBounds()))}bindEvents(){const{graph:t}=this.context;t.on(O.BEFORE_RENDER,this.onBeforeRender),t.on(O.AFTER_RENDER,this.onAfterRender),t.on(O.AFTER_DRAW,this.toggle),t.on(O.AFTER_LAYOUT,this.toggle),t.on(O.AFTER_TRANSFORM,this.onTransform)}unbindEvents(){const{graph:t}=this.context;t.off(O.BEFORE_RENDER,this.onBeforeRender),t.off(O.AFTER_RENDER,this.onAfterRender),t.off(O.AFTER_DRAW,this.toggle),t.off(O.AFTER_LAYOUT,this.toggle),t.off(O.AFTER_TRANSFORM,this.onTransform)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}}ln.defaultOptions={enable:!0,throttle:100,padding:0,sortNode:{type:"degree"}};const ri=[0,0,0];function T(i,t){return i.map((e,n)=>e+t[n])}function P(i,t){return i.map((e,n)=>e-t[n])}function lt(i,t){return typeof t=="number"?i.map(e=>e*t):i.map((e,n)=>e*t[n])}function ut(i,t){return typeof t=="number"?i.map(e=>e/t):i.map((e,n)=>e/t[n])}function Sa(i,t){return i.reduce((e,n,s)=>e+n*t[s],0)}function Oa(i,t){const e=De(i),n=De(t);return[e[1]*n[2]-e[2]*n[1],e[2]*n[0]-e[0]*n[2],e[0]*n[1]-e[1]*n[0]]}function Nt(i,t){return i.map(e=>e*t)}function N(i,t){return Math.sqrt(i.reduce((e,n,s)=>e+Math.pow(n-t[s]||0,2),0))}function en(i,t){return i.reduce((e,n,s)=>e+Math.abs(n-t[s]),0)}function Ot(i){const t=i.reduce((e,n)=>e+Math.pow(n,2),0);return i.map(e=>e/Math.sqrt(t))}function js(i,t,e=!1){const n=i[0]*t[1]-i[1]*t[0];let s=Math.acos(lt(i,t).reduce((o,r)=>o+r,0)/(N(i,ri)*N(t,ri)));return e&&n<0&&(s=2*Math.PI-s),s}function dn(i,t=!0){return t?[-i[1],i[0]]:[i[1],-i[0]]}function rs(i,t){return i.map(e=>e%t)}function qt(i){return[i[0],i[1]]}function De(i){return ca(i)?[i[0],i[1],0]:i}function No(i){const[t,e]=i;return!t&&!e?0:Math.atan2(e,t)}function Io(i,t){const[e,n]=i,[s,o]=t,r=P(e,n),a=P(s,o);return Oa(r,a).every(c=>c===0)}function zs(i,t,e=!1){if(Io(i,t))return;const[n,s]=i,[o,r]=t,a=((n[0]-o[0])*(o[1]-r[1])-(n[1]-o[1])*(o[0]-r[0]))/((n[0]-s[0])*(o[1]-r[1])-(n[1]-s[1])*(o[0]-r[0])),c=r[0]-o[0]?(n[0]-o[0]+a*(s[0]-n[0]))/(r[0]-o[0]):(n[1]-o[1]+a*(s[1]-n[1]))/(r[1]-o[1]);if(!(!e&&(!pt(a,0,1)||!pt(c,0,1))))return[n[0]+a*(s[0]-n[0]),n[1]+a*(s[1]-n[1])]}function ko(i){if(Array.isArray(i))return pt(i[0],0,1)&&pt(i[1],0,1)?i:[.5,.5];const t=i.split("-"),e=t.includes("left")?0:t.includes("right")?1:.5,n=t.includes("top")?0:t.includes("bottom")?1:.5;return[e,n]}function V(i){const{x:t=0,y:e=0,z:n=0}=i.style||{};return[+t,+e,+n]}function Da(i){const{x:t,y:e,z:n}=i.style||{};return t!==void 0||e!==void 0||n!==void 0}function wa(i,t){const[e,n]=t,{min:s,max:o}=i;return[s[0]+e*(o[0]-s[0]),s[1]+n*(o[1]-s[1])]}function xt(i,t="center"){const e=ko(t);return wa(i,e)}function K(i){var t;return[i.x,i.y,(t=i.z)!==null&&t!==void 0?t:0]}function dt(i){var t;return{x:i[0],y:i[1],z:(t=i[2])!==null&&t!==void 0?t:0}}function pe(i,t=0){return i.map(e=>parseFloat(e.toFixed(t)))}function kt(i,t,e,n=!1){if($(i,t))return i;const s=n?P(i,t):P(t,i),o=Ot(s),r=[o[0]*e,o[1]*e];return T(qt(i),r)}function Bo(i,t){return i[1]===t[1]}function Ca(i,t){return i[0]===t[0]}function _a(i,t){return Bo(i,t)||Ca(i,t)}function jo(i,t,e){return Io([i,t],[t,e])}function zo(i,t){return[2*t[0]-i[0],2*t[1]-i[1]]}function Fo(i,t,e,n=!0,s=!1){for(let o=0;o<e.length;o++){let r=e[o],a=e[(o+1)%e.length];n&&(r=T(t,r),a=T(t,a));const c=s?zo(i,t):i,l=zs([t,c],[r,a]);if(l)return{point:l,line:[r,a]}}return{point:t,line:void 0}}function Ta(i,t,e,n){const s=i[0],o=i[1];let r=!1;e===void 0&&(e=0),n===void 0&&(n=t.length);const a=n-e;for(let c=0,l=a-1;c<a;l=c++){const d=t[c+e][0],h=t[c+e][1],u=t[l+e][0],f=t[l+e][1];h>o!=f>o&&s<(u-d)*(o-h)/(f-h)+d&&(r=!r)}return r}function Aa(i,t,e=!1){const n=xt(t,"center"),s=[xt(t,"left-top"),xt(t,"right-top"),xt(t,"right-bottom"),xt(t,"left-bottom")];return Fo(i,n,s,!1,e).point}function hn(i,t,e=!1){const n=t.center,s=e?zo(i,n):i,o=P(s,t.center),r=Math.atan2(o[1],o[0]);if(isNaN(r))return n;const a=vt(t)/2,c=bt(t)/2,l=n[0]+a*Math.cos(r),d=n[1]+c*Math.sin(r);return[l,d]}function Ma(i,t){let e=1/0,n=[i[0],t[0]];return i.forEach(s=>{t.forEach(o=>{const r=N(s,o);r<e&&(e=r,n=[s,o])})}),n}function Pa(i,t){let e=1/0,n=[[0,0],[0,0]];return t.forEach(s=>{const o=Ra(i,s);o<e&&(e=o,n=s)}),n}function Ra(i,t){const e=$o(i,t);return N(i,e)}function $o(i,t){const[e,n]=t[0],[s,o]=t[1],[r,a]=i,c=s-e,l=o-n;if(c===0&&l===0)return[e,n];let d=((r-e)*c+(a-n)*l)/(c*c+l*l);d>1?d=1:d<0&&(d=0);const h=e+d*c,u=n+d*l;return[h,u]}function La(i){const t=i.reduce((e,n)=>T(e,n),[0,0]);return ut(t,i.length)}function Fs(i,t=!0){const e=La(i);return i.sort(([n,s],[o,r])=>{const a=Math.atan2(s-e[1],n-e[0]),c=Math.atan2(r-e[1],o-e[0]);return t?c-a:a-c})}function ai(i,t){return[i,[i[0],t[1]],t,[t[0],i[1]]]}class j{constructor(t,e,n){if(this.phase=e,this.pointerByTouch=[],this.initialDistance=null,this.emitter=t,j.instance)return j.callbacks[this.phase].push(n),j.instance;this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.bindEvents(),j.instance=this,j.callbacks[this.phase].push(n)}bindEvents(){const{emitter:t}=this;t.on(x.POINTER_DOWN,this.onPointerDown),t.on(x.POINTER_MOVE,this.onPointerMove),t.on(x.POINTER_UP,this.onPointerUp)}updatePointerPosition(t,e,n){const s=this.pointerByTouch.findIndex(o=>o.pointerId===t);s>=0&&(this.pointerByTouch[s]={x:e,y:n,pointerId:t})}onPointerDown(t){const{x:e,y:n}=t.client||{};if(!(e===void 0||n===void 0)&&(this.pointerByTouch.push({x:e,y:n,pointerId:t.pointerId}),t.pointerType==="touch"&&this.pointerByTouch.length===2)){j.isPinching=!0;const s=this.pointerByTouch[0].x-this.pointerByTouch[1].x,o=this.pointerByTouch[0].y-this.pointerByTouch[1].y;this.initialDistance=Math.sqrt(s*s+o*o),j.callbacks.pinchstart.forEach(r=>r(t,{scale:0}))}}onPointerMove(t){if(this.pointerByTouch.length!==2||this.initialDistance===null)return;const{x:e,y:n}=t.client||{};if(e===void 0||n===void 0)return;this.updatePointerPosition(t.pointerId,e,n);const s=this.pointerByTouch[0].x-this.pointerByTouch[1].x,o=this.pointerByTouch[0].y-this.pointerByTouch[1].y,a=Math.sqrt(s*s+o*o)/this.initialDistance;j.callbacks.pinchmove.forEach(c=>c(t,{scale:(a-1)*5}))}onPointerUp(t){var e;j.callbacks.pinchend.forEach(n=>n(t,{scale:0})),j.isPinching=!1,this.initialDistance=null,this.pointerByTouch=[],(e=j.instance)===null||e===void 0||e.tryDestroy()}destroy(){this.emitter.off(x.POINTER_DOWN,this.onPointerDown),this.emitter.off(x.POINTER_MOVE,this.onPointerMove),this.emitter.off(x.POINTER_UP,this.onPointerUp),j.instance=null}off(t,e){const n=j.callbacks[t].indexOf(e);n>-1&&j.callbacks[t].splice(n,1),this.tryDestroy()}tryDestroy(){Object.values(j.callbacks).every(t=>t.length===0)&&this.destroy()}}j.isPinching=!1;j.instance=null;j.callbacks={pinchstart:[],pinchmove:[],pinchend:[]};const ci=i=>i.map(t=>le(t)?t.toLocaleLowerCase():t);class he{constructor(t){this.map=new Map,this.boundHandlePinch=()=>{},this.recordKey=new Set,this.onKeyDown=e=>{e!=null&&e.key&&(this.recordKey.add(e.key),this.trigger(e))},this.onKeyUp=e=>{e!=null&&e.key&&this.recordKey.delete(e.key)},this.onWheel=e=>{this.triggerExtendKey(x.WHEEL,e)},this.onDrag=e=>{this.triggerExtendKey(x.DRAG,e)},this.handlePinch=(e,n)=>{this.triggerExtendKey(x.PINCH,Object.assign(Object.assign({},e),n))},this.onFocus=()=>{this.recordKey.clear()},this.emitter=t,this.bindEvents()}bind(t,e){t.length!==0&&(t.includes(x.PINCH)&&!this.pinchHandler&&(this.boundHandlePinch=this.handlePinch.bind(this),this.pinchHandler=new j(this.emitter,"pinchmove",this.boundHandlePinch)),this.map.set(t,e))}unbind(t,e){this.map.forEach((n,s)=>{$(s,t)&&(!e||e===n)&&this.map.delete(s)})}unbindAll(){this.map.clear()}match(t){const e=ci(Array.from(this.recordKey)).sort(),n=ci(t).sort();return $(e,n)}bindEvents(){var t;const{emitter:e}=this;e.on(x.KEY_DOWN,this.onKeyDown),e.on(x.KEY_UP,this.onKeyUp),e.on(x.WHEEL,this.onWheel),e.on(x.DRAG,this.onDrag),(t=globalThis.addEventListener)===null||t===void 0||t.call(globalThis,"focus",this.onFocus)}trigger(t){this.map.forEach((e,n)=>{this.match(n)&&e(t)})}triggerExtendKey(t,e){this.map.forEach((n,s)=>{s.includes(t)&&$(Array.from(this.recordKey),s.filter(o=>o!==t))&&n(e)})}destroy(){var t,e;this.unbindAll(),this.emitter.off(x.KEY_DOWN,this.onKeyDown),this.emitter.off(x.KEY_UP,this.onKeyUp),this.emitter.off(x.WHEEL,this.onWheel),this.emitter.off(x.DRAG,this.onDrag),(t=this.pinchHandler)===null||t===void 0||t.off("pinchmove",this.boundHandlePinch),(e=globalThis.removeEventListener)===null||e===void 0||e.call(globalThis,"blur",this.onFocus)}}class Me extends st{constructor(t,e){super(t,Gt({},Me.defaultOptions,e)),this.shortcut=new he(t.graph),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.clearStates=this.clearStates.bind(this),this.bindEvents()}onPointerDown(t){if(!this.validate(t)||!this.isKeydown()||this.startPoint)return;const{canvas:e,graph:n}=this.context,s=Object.assign({},this.options.style);this.options.style.lineWidth&&(s.lineWidth=+this.options.style.lineWidth/n.getZoom()),this.rectShape=new _t({id:"g6-brush-select",style:s}),e.appendChild(this.rectShape),this.startPoint=[t.canvas.x,t.canvas.y]}onPointerMove(t){var e;if(!this.startPoint)return;const{immediately:n,mode:s}=this.options;this.endPoint=nn(t),(e=this.rectShape)===null||e===void 0||e.attr({x:Math.min(this.endPoint[0],this.startPoint[0]),y:Math.min(this.endPoint[1],this.startPoint[1]),width:Math.abs(this.endPoint[0]-this.startPoint[0]),height:Math.abs(this.endPoint[1]-this.startPoint[1])}),n&&s==="default"&&this.updateElementsStates(ai(this.startPoint,this.endPoint))}onPointerUp(t){if(this.startPoint){if(!this.endPoint){this.clearBrush();return}this.endPoint=nn(t),this.updateElementsStates(ai(this.startPoint,this.endPoint)),this.clearBrush()}}clearStates(){this.endPoint||this.clearElementsStates()}clearElementsStates(){const{graph:t}=this.context,e=Object.values(t.getData()).reduce((n,s)=>Object.assign({},n,s.reduce((o,r)=>(o[v(r)]=[],o),{})),{});t.setElementState(e,this.options.animation)}updateElementsStates(t){const{graph:e}=this.context,{enableElements:n,state:s,mode:o,onSelect:r}=this.options,a=this.selector(e,t,n);let c={};switch(o){case"union":a.forEach(l=>{c[l]=[...e.getElementState(l),s]});break;case"diff":a.forEach(l=>{const d=e.getElementState(l);c[l]=d.includes(s)?d.filter(h=>h!==s):[...d,s]});break;case"intersect":a.forEach(l=>{const d=e.getElementState(l);c[l]=d.includes(s)?[s]:[]});break;case"default":default:a.forEach(l=>{c[l]=[s]});break}A(r)&&(c=r(c)),e.setElementState(c,this.options.animation)}selector(t,e,n){if(!n||n.length===0)return[];const s=[],o=t.getData();if(n.forEach(r=>{o[`${r}s`].forEach(a=>{const c=v(a);t.getElementVisibility(c)!=="hidden"&&Ta(t.getElementPosition(c),e)&&s.push(c)})}),n.includes("edge")){const r=o.edges;r==null||r.forEach(a=>{const{source:c,target:l}=a;s.includes(c)&&s.includes(l)&&s.push(v(a))})}return s}clearBrush(){var t;(t=this.rectShape)===null||t===void 0||t.remove(),this.rectShape=void 0,this.startPoint=void 0,this.endPoint=void 0}isKeydown(){const{trigger:t}=this.options,e=Array.isArray(t)?t:[t];return this.shortcut.match(e.filter(n=>n!=="drag"))}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}bindEvents(){const{graph:t}=this.context;t.on(x.POINTER_DOWN,this.onPointerDown),t.on(x.POINTER_MOVE,this.onPointerMove),t.on(x.POINTER_UP,this.onPointerUp),t.on(Dt.CLICK,this.clearStates)}unbindEvents(){const{graph:t}=this.context;t.off(x.POINTER_DOWN,this.onPointerDown),t.off(x.POINTER_MOVE,this.onPointerMove),t.off(x.POINTER_UP,this.onPointerUp),t.off(Dt.CLICK,this.clearStates)}update(t){this.unbindEvents(),this.options=Gt(this.options,t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy()}}Me.defaultOptions={animation:!1,enable:!0,enableElements:["node","combo","edge"],immediately:!1,mode:"default",state:"selected",trigger:["shift"],style:{width:0,height:0,lineWidth:1,fill:"#1677FF",stroke:"#1677FF",fillOpacity:.1,zIndex:2,pointerEvents:"none"}};const nn=i=>[i.canvas.x,i.canvas.y],Ct=.8,Qt=["node","edge","combo"];function Kt(i,t,e,n,s=0){n==="TB"&&t(i,s);const o=e(i);if(o)for(const r of o)Kt(r,t,e,n,s+1);n==="BT"&&t(i,s)}function Na(i,t,e){const n=[[i,0]];for(;n.length;){const[s,o]=n.shift();t(s,o);const r=e(s);if(r)for(const a of r)n.push([a,o+1])}}function Wo(i,t,e,n,s="both"){if(t==="combo"||t==="node")return as(i,e,n,s);const o=i.getEdgeData(e);if(!o)return[];const r=as(i,o.source,n-1,s),a=as(i,o.target,n-1,s);return Array.from(new Set([...r,...a,e]))}function as(i,t,e,n="both"){const s=new Set,o=new Set,r=new Set;return Na(t,(a,c)=>{c>e||(r.add(a),i.getRelatedEdgesData(a,n).forEach(l=>{const d=v(l);!o.has(d)&&c<e&&(r.add(d),o.add(d))}))},a=>i.getRelatedEdgesData(a,n).map(c=>c.source===a?c.target:c.source).filter(c=>s.has(c)?!1:(s.add(c),!0))),Array.from(r)}function cs(i){return i.states||[]}var je=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class un extends st{constructor(t,e){super(t,Object.assign({},un.defaultOptions,e)),this.onClickSelect=n=>je(this,void 0,void 0,function*(){var s,o;this.validate(n)&&(yield this.updateState(n),(o=(s=this.options).onClick)===null||o===void 0||o.call(s,n))}),this.onClickCanvas=n=>je(this,void 0,void 0,function*(){var s,o;this.validate(n)&&(yield this.clearState(),(o=(s=this.options).onClick)===null||o===void 0||o.call(s,n))}),this.shortcut=new he(t.graph),this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),Qt.forEach(e=>{t.on(`${e}:${x.CLICK}`,this.onClickSelect)}),t.on(Dt.CLICK,this.onClickCanvas)}get isMultipleSelect(){const{multiple:t,trigger:e}=this.options;return t&&this.shortcut.match(e)}getNeighborIds(t){const{target:e,targetType:n}=t,{graph:s}=this.context,{degree:o}=this.options;return Wo(s,n,e.id,typeof o=="function"?o(t):o).filter(r=>r!==e.id)}updateState(t){return je(this,void 0,void 0,function*(){const{state:e,unselectedState:n,neighborState:s,animation:o}=this.options;if(!e&&!s&&!n)return;const{target:r}=t,{graph:a}=this.context,c=a.getElementData(r.id),l=cs(c).includes(e)?"unselect":"select",d={},h=this.isMultipleSelect,u=[r.id],f=this.getNeighborIds(t);if(h)if(Object.assign(d,this.getDataStates()),l==="select"){const g=(p,y)=>{p.forEach(m=>{const E=new Set(a.getElementState(m));E.add(y),E.delete(n),d[m]=Array.from(E)})};g(u,e),g(f,s),n&&Object.keys(d).forEach(p=>{const y=d[p];!y.includes(e)&&!y.includes(s)&&!y.includes(n)&&d[p].push(n)})}else{const g=d[r.id];d[r.id]=g.filter(p=>p!==e&&p!==s),g.includes(n)||d[r.id].push(n),f.forEach(p=>{d[p]=d[p].filter(y=>y!==s),d[p].includes(e)||d[p].push(n)})}else if(l==="select"){Object.assign(d,this.getClearStates(!!n));const g=(p,y)=>{p.forEach(m=>{d[m]||(d[m]=a.getElementState(m)),d[m].push(y)})};g(u,e),g(f,s),n&&Object.keys(d).forEach(p=>{!u.includes(p)&&!f.includes(p)&&d[p].push(n)})}else Object.assign(d,this.getClearStates());yield a.setElementState(d,o)})}getDataStates(){const{graph:t}=this.context,{nodes:e,edges:n,combos:s}=t.getData(),o={};return[...e,...n,...s].forEach(r=>{o[v(r)]=cs(r)}),o}getClearStates(t=!1){const{graph:e}=this.context,{state:n,unselectedState:s,neighborState:o}=this.options,r=new Set([n,s,o]),{nodes:a,edges:c,combos:l}=e.getData(),d={};return[...a,...c,...l].forEach(h=>{const u=cs(h),f=u.filter(g=>!r.has(g));(t||f.length!==u.length)&&(d[v(h)]=f)}),d}clearState(){return je(this,void 0,void 0,function*(){const{graph:t}=this.context;yield t.setElementState(this.getClearStates(),this.options.animation)})}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;Qt.forEach(e=>{t.off(`${e}:${x.CLICK}`,this.onClickSelect)}),t.off(Dt.CLICK,this.onClickCanvas)}destroy(){this.unbindEvents(),super.destroy()}}un.defaultOptions={animation:!0,enable:!0,multiple:!1,trigger:["shift"],state:"selected",neighborState:"selected",unselectedState:void 0,degree:0};function Q(i){var t;return!!(!((t=i.style)===null||t===void 0)&&t.collapsed)}function sn(i,t){if(!i.startsWith(t))return!1;const e=i[t.length];return e>="A"&&e<="Z"}function Ia(i,t){return`${t}${qe(i)}`}function ka(i,t,e=!0){if(!t||!sn(i,t))return i;const n=i.slice(t.length);return e?yr(n):n}function F(i,t){const e=Object.entries(i).reduce((n,[s,o])=>(s==="className"||s==="class"||sn(s,t)&&Object.assign(n,{[ka(s,t)]:o}),n),{});if("opacity"in i){const n=Ia("opacity",t),s=i.opacity;if(n in i){const o=i[n];Object.assign(e,{opacity:s*o})}else Object.assign(e,{opacity:s})}return e}function Os(i,t){const e=t.length;return Object.keys(i).reduce((n,s)=>{if(s.startsWith(t)){const o=s.slice(e);n[o]=i[s]}return n},{})}function Vo(i,t){const e=typeof t=="string"?[t]:t,n={};return Object.keys(i).forEach(s=>{e.find(o=>s.startsWith(o))||(n[s]=i[s])}),n}function nt(i=0){if(typeof i=="number")return[i,i,i];const[t,e=t,n=t]=i;return[t,e,n]}var Ba=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};function li(i,t){const{datum:e,graph:n}=t;return typeof i=="function"?i.call(n,e):Object.fromEntries(Object.entries(i).map(([s,o])=>typeof o=="function"?[s,o.call(n,e)]:[s,o]))}function Y(i,t){const e=(i==null?void 0:i.style)||{},n=(t==null?void 0:t.style)||{};for(const s in e)s in n||(n[s]=e[s]);return Object.assign({},i,t,{style:n})}function ja(i){const{x:t,y:e,z:n,class:s,className:o,transform:r,transformOrigin:a,zIndex:c,visibility:l}=i;return Ba(i,["x","y","z","class","className","transform","transformOrigin","zIndex","visibility"])}function za(i,t){const e=nt(i);let n={};return t.text&&!t.fontSize&&(n={fontSize:Math.min(...e)*.5}),t.src&&(!t.width||!t.height)&&(n={width:e[0]*.5,height:e[1]*.5}),n}function di(i){if(i)return typeof i=="string"||typeof i=="function"||Array.isArray(i)?{type:"group",field:t=>t.id,color:i,invert:!1}:i}function Fa(i,t){if(!t)return{};const{type:e,color:n,field:s,invert:o}=t,r=c=>{const l=typeof n=="string"?wt("palette",n):n;if(typeof l=="function"){const d={};return c.forEach(([h,u])=>{d[h]=l(o?1-u:u)}),d}else if(Array.isArray(l)){const d=o?[...l].reverse():l,h={};return c.forEach(([u,f])=>{h[u]=d[f%l.length]}),h}return{}},a=(c,l)=>{var d;return typeof c=="string"?(d=l.data)===null||d===void 0?void 0:d[c]:c==null?void 0:c(l)};if(e==="group"){const c=rn(i,u=>{if(!s)return"default";const f=a(s,u);return f?String(f):"default"}),l=Object.keys(c),d=r(l.map((u,f)=>[u,f])),h={};return Object.entries(c).forEach(([u,f])=>{f.forEach(g=>{h[v(g)]=d[u]})}),h}else if(e==="value"){const[c,l]=i.reduce(([h,u],f)=>{const g=a(s,f);if(typeof g!="number")throw new Error(St(`Palette field ${s} is not a number`));return[Math.min(h,g),Math.max(u,g)]},[1/0,-1/0]),d=l-c;return r(i.map(h=>[h.id,(a(s,h)-c)/d]))}}function Ho(i){const t=typeof i=="string"?wt("palette",i):i;if(typeof t!="function")return t}function Uo(i,t){let e=2*i;return typeof t=="string"?e=i*Number(t.replace("%",""))/100:typeof t=="number"&&(e=t),isNaN(e)&&(e=2*i),e}function Yo(i,t,e=1,n=!1){const s=n?e:1,o=(i.max[0]-i.min[0])*s;return Uo(o,t)}function $a(i,t,e=1){const n=N(i[0],i[1])*e;return Uo(n,t)}class Pe extends mr{constructor(t){hi(t.style),super(t),this.shapeMap={},this.animateMap={},this.render(this.attributes,this),this.setVisibility(),this.bindEvents()}get parsedAttributes(){return this.attributes}upsert(t,e,n,s,o){var r,a,c,l,d,h,u,f;const g=this.shapeMap[t];if(n===!1){g&&((r=o==null?void 0:o.beforeDestroy)===null||r===void 0||r.call(o,g),s.removeChild(g),delete this.shapeMap[t],(a=o==null?void 0:o.afterDestroy)===null||a===void 0||a.call(o,g));return}const p=typeof e=="string"?wt(Se.SHAPE,e):e;if(!p)throw new Error(St(`Shape ${e} not found`));if(!g||g.destroyed||!(g instanceof p)){g&&((c=o==null?void 0:o.beforeDestroy)===null||c===void 0||c.call(o,g),g==null||g.destroy(),(l=o==null?void 0:o.afterDestroy)===null||l===void 0||l.call(o,g)),(d=o==null?void 0:o.beforeCreate)===null||d===void 0||d.call(o);const y=new p({className:t,style:n});return s.appendChild(y),this.shapeMap[t]=y,(h=o==null?void 0:o.afterCreate)===null||h===void 0||h.call(o,y),y}return(u=o==null?void 0:o.beforeUpdate)===null||u===void 0||u.call(o,g),As(g,n),(f=o==null?void 0:o.afterUpdate)===null||f===void 0||f.call(o,g),g}update(t={}){const e=Object.assign({},this.attributes,t);hi(e),Xc(this,e),this.render(e,this),this.setVisibility()}bindEvents(){}getGraphicStyle(t){return ja(t)}get compositeShapes(){return[["badges","badge-"],["ports","port-"]]}animate(t,e){if(t.length===0)return null;const n=[];if(t[0].x!==void 0||t[0].y!==void 0||t[0].z!==void 0){const{x:o=0,y:r=0,z:a=0}=this.attributes;t.forEach(c=>{const{x:l=o,y:d=r,z:h=a}=c;Object.assign(c,{transform:h?[["translate3d",l,d,h]]:[["translate",l,d]]})})}const s=super.animate(t,e);if(s&&(ls(this,s),n.push(s)),Array.isArray(t)&&t.length>0){const o=["transform","transformOrigin","x","y","z","zIndex"];if(Object.keys(t[0]).some(r=>!o.includes(r))){Object.entries(this.shapeMap).forEach(([a,c])=>{const l=`get${qe(a)}Style`,d=this[l];if(A(d)){const h=t.map(f=>d.call(this,Object.assign(Object.assign({},this.attributes),f))),u=c.animate(Ss(h),e);u&&(ls(c,u),n.push(u))}});const r=(a,c)=>{if(!gt(a)){const l=`get${qe(c)}Style`,d=this[l];if(A(d)){const h=t.map(u=>d.call(this,Object.assign(Object.assign({},this.attributes),u)));Object.entries(h[0]).map(([u])=>{const f=h.map(p=>p[u]),g=a[u];if(g){const p=g.animate(Ss(f),e);p&&(ls(g,p),n.push(p))}})}}};this.compositeShapes.forEach(([a,c])=>{const l=Os(this.shapeMap,c);r(l,a)})}}return Ns(n)}getShape(t){return this.shapeMap[t]}setVisibility(){const{visibility:t}=this.attributes;Zt(this,t)}destroy(){this.shapeMap={},this.animateMap={},super.destroy()}}function ls(i,t){t==null||t.finished.then(()=>{const e=i.activeAnimations.findIndex(n=>n===t);e>-1&&i.activeAnimations.splice(e,1)})}function hi(i){if(!i)return{};if("x"in i||"y"in i||"z"in i){const{x:t=0,y:e=0,z:n,transform:s}=i,o=Co(t,e,n,s);o&&(i.transform=o)}return i}var Wa=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class Ft extends Pe{constructor(t){super(Y({style:Ft.defaultStyleProps},t))}isTextStyle(t){return sn(t,"label")}isBackgroundStyle(t){return sn(t,"background")}getTextStyle(t){const e=this.getGraphicStyle(t),{padding:n}=e,s=Wa(e,["padding"]);return Vo(s,"background")}getBackgroundStyle(t){if(t.background===!1)return!1;const e=this.getGraphicStyle(t),{wordWrap:n,wordWrapWidth:s,padding:o}=e,r=F(e,"background"),{min:[a,c],center:[l,d],halfExtents:[h,u]}=this.shapeMap.text.getGeometryBounds(),[f,g,p,y]=mt(o),m=h*2+y+g,{width:E,height:b}=r;E&&b?Object.assign(r,{x:l-Number(E)/2,y:d-Number(b)/2}):Object.assign(r,{x:a-y,y:c-f,width:n?Math.min(m,s+y+g):m,height:u*2+f+p});const{radius:S}=r;if(typeof S=="string"&&S.endsWith("%")){const D=Number(S.replace("%",""))/100;r.radius=Math.min(+r.width,+r.height)*D}return r}render(t=this.parsedAttributes,e=this){this.upsert("text",Rs,this.getTextStyle(t),e),this.upsert("background",_t,this.getBackgroundStyle(t),e)}getGeometryBounds(){return(this.getShape("background")||this.getShape("text")).getGeometryBounds()}}Ft.defaultStyleProps={padding:0,fontSize:12,fontFamily:"system-ui, sans-serif",wordWrap:!0,maxLines:1,wordWrapWidth:128,textOverflow:"...",textBaseline:"middle",backgroundOpacity:.75,backgroundZIndex:-1,backgroundLineWidth:0};class ue extends Pe{constructor(t){super(Y({style:ue.defaultStyleProps},t))}getBadgeStyle(t){return this.getGraphicStyle(t)}render(t=this.parsedAttributes,e=this){this.upsert("label",Ft,this.getBadgeStyle(t),e)}getGeometryBounds(){const t=this.getShape("label");return(t.getShape("background")||t.getShape("text")).getGeometryBounds()}}ue.defaultStyleProps={padding:[2,4,2,4],fontSize:10,wordWrap:!1,backgroundRadius:"50%",backgroundOpacity:1};function Va(i,t=!0){const e=[];return i.forEach((n,s)=>{e.push([s===0?"M":"L",...n])}),t&&e.push(["Z"]),e}const ui={M:["x","y"],m:["dx","dy"],H:["x"],h:["dx"],V:["y"],v:["dy"],L:["x","y"],l:["dx","dy"],Z:[],z:[],C:["x1","y1","x2","y2","x","y"],c:["dx1","dy1","dx2","dy2","dx","dy"],S:["x2","y2","x","y"],s:["dx2","dy2","dx","dy"],Q:["x1","y1","x","y"],q:["dx1","dy1","dx","dy"],T:["x","y"],t:["dx","dy"],A:["rx","ry","rotation","large-arc","sweep","x","y"],a:["rx","ry","rotation","large-arc","sweep","dx","dy"]};function Ha(i){const t=i.replace(/[\n\r]/g,"").replace(/-/g," -").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ").trim().split(/\s*,|\s+/),e=[];let n="",s={};for(;t.length>0;){let o=t.shift();o in ui?n=o:t.unshift(o),s={type:n},ui[n].forEach(c=>{o=t.shift(),s[c]=o}),n==="M"?n="L":n==="m"&&(n="l");const[r,...a]=Object.values(s);e.push([r,...a.map(Number)])}return e}function Ua(i){const t=[];return(typeof i=="string"?Ha(i):i).forEach(n=>{const s=n[0];if(s==="Z"){t.push(t[0]);return}if(s!=="A")for(let o=1;o<n.length;o=o+2)t.push([n[o],n[o+1],0]);else{const o=n.length;t.push([n[o-2],n[o-1],0])}}),t}const Ko=i=>{if(i.length<2)return[["M",0,0],["L",0,0]];const t=i[0],e=i[1],n=i[i.length-1],s=i[i.length-2];i.unshift(s,n),i.push(t,e);const o=[["M",n[0],n[1]]];for(let r=1;r<i.length-2;r+=1){const[a,c]=i[r-1],[l,d]=i[r],[h,u]=i[r+1],[f,g]=r!==i.length-2?i[r+2]:[h,u],p=l+(h-a)/6,y=d+(u-c)/6,m=h-(f-l)/6,E=u-(g-d)/6;o.push(["C",p,y,m,E,h,u])}return o};function Ya(i,t,e,n,s,o,r){const[a,c]=xt(i,t),l={textAlign:t==="left"?"right":t==="right"?"left":"center",textBaseline:t==="top"?"bottom":t==="bottom"?"top":"middle",transform:[["translate",a+e,c+n]]};if(t==="center"||!s)return l;const d=Ua(o);if(!d||d.length<=3)return l;const h=d.map((g,p)=>{const y=g,m=d[(p+1)%d.length];return $(y,m)?null:[y,m]}).filter(Boolean),u=Pa([a,c],h),f=$o([a,c],u);if(f&&u&&(l.transform=[["translate",f[0]+e,f[1]+n]],r)){const g=Math.atan((u[0][1]-u[1][1])/(u[0][0]-u[1][0]));l.transform.push(["rotate",g/Math.PI*180]),l.textAlign="center",(t==="right"||t==="left")&&(g>0?l.textBaseline=t==="right"?"bottom":"top":l.textBaseline=t==="right"?"top":"bottom")}return l}var Ka=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class Re extends Pe{constructor(t){super(Y({style:Re.defaultStyleProps},t))}getLabelStyle(t){if(!t.label||!t.d||t.d.length===0)return!1;const e=F(this.getGraphicStyle(t),"label"),{maxWidth:n,offsetX:s,offsetY:o,autoRotate:r,placement:a,closeToPath:c}=e,l=Ka(e,["maxWidth","offsetX","offsetY","autoRotate","placement","closeToPath"]),d=this.shapeMap.key,h=d==null?void 0:d.getRenderBounds();return Object.assign(Ya(h,a,s,o,c,t.d,r),{wordWrapWidth:Yo(h,n)},l)}getKeyStyle(t){return this.getGraphicStyle(t)}render(t,e){this.upsert("key",Rt,this.getKeyStyle(t),e),this.upsert("label",Ft,this.getLabelStyle(t),e)}}Re.defaultStyleProps={label:!0,labelPlacement:"bottom",labelCloseToPath:!0,labelAutoRotate:!0,labelOffsetX:0,labelOffsetY:0};function Xa(i){const t=[],e=n=>{n!=null&&n.children.length&&n.children.forEach(s=>{t.push(s),e(s)})};return e(i),t}function Ga(i){const t=[];let e=i.parentNode;for(;e;)t.push(e),e=e.parentNode;return t}let $s=class extends po{constructor(t){super(t),this.onMounted=()=>{this.handleRadius()},this.onAttrModified=()=>{this.handleRadius()},ae=this,this.isMutationObserved=!0,this.addEventListener(ei.MOUNTED,this.onMounted),this.addEventListener(ei.ATTR_MODIFIED,this.onAttrModified)}handleRadius(){const{radius:t,clipPath:e,width:n=0,height:s=0}=this.attributes;if(t&&n&&s){const[o,r]=this.getBounds().min,a={x:o,y:r,radius:t,width:n,height:s};if(e)Object.assign(this.parsedStyle.clipPath.style,a);else{const c=new _t({style:a});this.style.clipPath=c}}else e&&(this.style.clipPath=null)}};const Ds=new WeakMap;let ae=null;const Ws=i=>{if(ae&&Ga(ae).includes(i)){const t=Ds.get(i);t?t.includes(ae)||t.push(ae):Ds.set(i,[ae])}},Vs=i=>{const t=Ds.get(i);t&&t.forEach(e=>e.handleRadius())};class Xo extends Pe{constructor(t){super(t)}isImage(){const{src:t}=this.attributes;return!!t}getIconStyle(t=this.attributes){const{width:e=0,height:n=0}=t,s=this.getGraphicStyle(t);return this.isImage()?Object.assign({x:-e/2,y:-n/2},s):Object.assign({textBaseline:"middle",textAlign:"center"},s)}render(t=this.attributes,e=this){this.upsert("icon",this.isImage()?$s:Rs,this.getIconStyle(t),e)}}class Go extends Pe{get context(){return this.config.context}get parsedAttributes(){return this.attributes}onframe(){}animate(t,e){const n=super.animate(t,e);return n&&(n.onframe=()=>this.onframe(),n.finished.then(()=>this.onframe())),n}}var ze=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class ft extends Go{constructor(t){super(Y({style:ft.defaultStyleProps},t)),this.type="node"}getSize(t=this.attributes){const{size:e}=t;return nt(e)}getKeyStyle(t){const e=this.getGraphicStyle(t);return Object.assign(Vo(e,["label","halo","icon","badge","port"]))}getLabelStyle(t){if(t.label===!1||!t.labelText)return!1;const e=F(this.getGraphicStyle(t),"label"),{placement:n,maxWidth:s,offsetX:o,offsetY:r}=e,a=ze(e,["placement","maxWidth","offsetX","offsetY"]),c=this.getShape("key").getLocalBounds();return Object.assign(wi(c,n,o,r),{wordWrapWidth:Yo(c,s)},a)}getHaloStyle(t){if(t.halo===!1)return!1;const e=this.getKeyStyle(t),{fill:n}=e,s=ze(e,["fill"]),o=F(this.getGraphicStyle(t),"halo");return Object.assign(Object.assign(Object.assign({},s),{stroke:n}),o)}getIconStyle(t){if(t.icon===!1||!t.iconText&&!t.iconSrc)return!1;const e=F(this.getGraphicStyle(t),"icon");return Object.assign(za(t.size,e),e)}getBadgesStyle(t){var e;const n=Os(this.shapeMap,"badge-"),s={};if(Object.keys(n).forEach(h=>{s[h]=!1}),t.badge===!1||!(!((e=t.badges)===null||e===void 0)&&e.length))return s;const{badges:o=[],badgePalette:r,opacity:a=1}=t,c=ze(t,["badges","badgePalette","opacity"]),l=Ho(r),d=F(this.getGraphicStyle(c),"badge");return o.forEach((h,u)=>{s[u]=Object.assign(Object.assign({backgroundFill:l?l[u%(l==null?void 0:l.length)]:void 0,opacity:a},d),this.getBadgeStyle(h))}),s}getBadgeStyle(t){const e=this.getShape("key"),{placement:n="top",offsetX:s,offsetY:o}=t,r=ze(t,["placement","offsetX","offsetY"]),a=wi(e.getLocalBounds(),n,s,o,!0);return Object.assign(Object.assign({},a),r)}getPortsStyle(t){var e;const n=this.getPorts(),s={};if(Object.keys(n).forEach(a=>{s[a]=!1}),t.port===!1||!(!((e=t.ports)===null||e===void 0)&&e.length))return s;const o=F(this.getGraphicStyle(t),"port"),{ports:r=[]}=t;return r.forEach((a,c)=>{const l=a.key||c,d=Object.assign(Object.assign({},o),a);if(or(d))s[l]=!1;else{const[h,u]=this.getPortXY(t,a);s[l]=Object.assign({transform:[["translate",h,u]]},d)}}),s}getPortXY(t,e){const{placement:n="left"}=e,s=this.getShape("key");return Ys(Za(this.context,s),n)}getPorts(){return Os(this.shapeMap,"port-")}getCenter(){return this.getShape("key").getBounds().center}getIntersectPoint(t,e=!1){const n=this.getShape("key").getBounds();return Aa(t,n,e)}drawHaloShape(t,e){const n=this.getHaloStyle(t),s=this.getShape("key");this.upsert("halo",s.constructor,n,e)}drawIconShape(t,e){const n=this.getIconStyle(t);this.upsert("icon",Xo,n,e),Ws(this)}drawBadgeShapes(t,e){const n=this.getBadgesStyle(t);Object.keys(n).forEach(s=>{const o=n[s];this.upsert(`badge-${s}`,ue,o,e)})}drawPortShapes(t,e){const n=this.getPortsStyle(t);Object.keys(n).forEach(s=>{const o=n[s],r=`port-${s}`;this.upsert(r,an,o,e)})}drawLabelShape(t,e){const n=this.getLabelStyle(t);this.upsert("label",Ft,n,e)}_drawKeyShape(t,e){return this.drawKeyShape(t,e)}render(t=this.parsedAttributes,e=this){this._drawKeyShape(t,e),this.getShape("key")&&(this.drawHaloShape(t,e),this.drawIconShape(t,e),this.drawBadgeShapes(t,e),this.drawLabelShape(t,e),this.drawPortShapes(t,e))}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&Vs(this)}onframe(){this.drawBadgeShapes(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this)}}ft.defaultStyleProps={x:0,y:0,size:32,droppable:!0,draggable:!0,port:!0,ports:[],portZIndex:2,portLinkToCenter:!1,badge:!0,badges:[],badgeZIndex:3,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloStrokeOpacity:.25,haloPointerEvents:"none",haloZIndex:-1,icon:!0,iconZIndex:1,label:!0,labelIsBillboard:!0,labelMaxWidth:"200%",labelPlacement:"bottom",labelWordWrap:!1,labelZIndex:0};function Za(i,t){if(!i)return t.getLocalBounds();const e=i.canvas.getLayer(),n=t.cloneNode();Zt(n,"hidden"),e.appendChild(n);const s=n.getLocalBounds();return n.destroy(),s}class Jt extends ft{constructor(t){super(Y({style:Jt.defaultStyleProps},t))}drawKeyShape(t,e){return this.upsert("key",an,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t);return Object.assign(Object.assign({},e),{r:Math.min(...this.getSize(t))/2})}getIconStyle(t){const e=super.getIconStyle(t),{r:n}=this.getShape("key").attributes,s=n*2*Ct;return e?Object.assign({width:s,height:s},e):!1}getIntersectPoint(t,e=!1){const n=this.getShape("key").getBounds();return hn(t,n,e)}}Jt.defaultStyleProps={size:32};class fn extends ft{constructor(t){super(t)}get parsedAttributes(){return this.attributes}drawKeyShape(t,e){return this.upsert("key",yo,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t);return Object.assign(Object.assign({},e),{points:this.getPoints(t)})}getIntersectPoint(t,e=!1){var n,s;const{points:o}=this.getShape("key").attributes,r=[+(((n=this.attributes)===null||n===void 0?void 0:n.x)||0),+(((s=this.attributes)===null||s===void 0?void 0:s.y)||0)];return Fo(t,r,o,!0,e).point}}class qa extends fn{constructor(t){super(t)}getPoints(t){const[e,n]=this.getSize(t);return Yc(e,n)}}var Qa=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class gn extends Jt{constructor(t){super(Y({style:gn.defaultStyleProps},t))}parseOuterR(){const{size:t}=this.parsedAttributes;return Math.min(...nt(t))/2}parseInnerR(){const{innerR:t}=this.parsedAttributes;return le(t)?parseInt(t)/100*this.parseOuterR():t}drawDonutShape(t,e){const{donuts:n}=t;if(!(n!=null&&n.length))return;const s=n.map(h=>U(h)?{value:h}:h),o=F(this.getGraphicStyle(t),"donut"),r=Ho(t.donutPalette);if(!r)return;const a=s.reduce((h,u)=>{var f;return h+((f=u.value)!==null&&f!==void 0?f:0)},0),c=this.parseOuterR(),l=this.parseInnerR();let d=0;s.forEach((h,u)=>{const{value:f=0,color:g=r[u%r.length]}=h,p=Qa(h,["value","color"]),y=(a===0?1/s.length:f/a)*360;this.upsert(`round${u}`,Rt,Object.assign(Object.assign(Object.assign({},o),{d:ec(c,l,d,d+y),fill:g}),p),e),d+=y})}render(t,e=this){super.render(t,e),this.drawDonutShape(t,e)}}gn.defaultStyleProps={innerR:"50%",donuts:[],donutPalette:"tableau"};const Fe=(i,t,e,n)=>[i+Math.sin(n)*e,t-Math.cos(n)*e],Ja=(i,t,e,n)=>n<=0||e<=n?[["M",i-e,t],["A",e,e,0,1,1,i+e,t],["A",e,e,0,1,1,i-e,t],["Z"]]:[["M",i-e,t],["A",e,e,0,1,1,i+e,t],["A",e,e,0,1,1,i-e,t],["Z"],["M",i+n,t],["A",n,n,0,1,0,i-n,t],["A",n,n,0,1,0,i+n,t],["Z"]],tc=(i,t,e,n,s,o)=>{const[r,a]=[s/360*2*Math.PI,o/360*2*Math.PI],c=[Fe(i,t,n,r),Fe(i,t,e,r),Fe(i,t,e,a),Fe(i,t,n,a)],l=a-r>Math.PI?1:0;return[["M",c[0][0],c[0][1]],["L",c[1][0],c[1][1]],["A",e,e,0,l,1,c[2][0],c[2][1]],["L",c[3][0],c[3][1]],["A",n,n,0,l,0,c[0][0],c[0][1]],["Z"]]},ec=(i=0,t=0,e,n)=>{const[s,o]=[0,0];return Math.abs(e-n)%360<1e-6?Ja(s,o,i,t):tc(s,o,i,t,e,n)};class pn extends ft{constructor(t){super(Y({style:pn.defaultStyleProps},t))}drawKeyShape(t,e){return this.upsert("key",mo,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t),[n,s]=this.getSize(t);return Object.assign(Object.assign({},e),{rx:n/2,ry:s/2})}getIconStyle(t){const e=super.getIconStyle(t),{rx:n,ry:s}=this.getShape("key").attributes,o=Math.min(+n,+s)*2*Ct;return e?Object.assign({width:o,height:o},e):!1}getIntersectPoint(t,e=!1){const n=this.getShape("key").getBounds();return hn(t,n,e)}}pn.defaultStyleProps={size:[45,35]};class nc extends fn{constructor(t){super(t)}getOuterR(t){return t.outerR||Math.min(...this.getSize(t))/2}getPoints(t){return Gc(this.getOuterR(t))}getIconStyle(t){const e=super.getIconStyle(t),n=this.getOuterR(t)*Ct;return e?Object.assign({width:n,height:n},e):!1}}var sc=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class yn extends ft{constructor(t){super(Object.assign(Object.assign({},t),{style:Object.assign({},yn.defaultStyleProps,t.style)})),this.rootPointerEvent=new vr(null),this.forwardEvents=e=>{const n=this.context.canvas,s=n.context.renderingContext.root.ownerDocument.defaultView;this.normalizeToPointerEvent(e,s).forEach(r=>{const a=this.bootstrapEvent(this.rootPointerEvent,r,s,e);Qe(n.context.eventService,"mappingTable.pointerupoutside",[]),n.context.eventService.mapEvent(a)})}}get eventService(){return this.context.canvas.context.eventService}get events(){return[x.CLICK,x.POINTER_DOWN,x.POINTER_MOVE,x.POINTER_UP,x.POINTER_OVER,x.POINTER_LEAVE]}getDomElement(){return this.getShape("key").getDomElement()}render(t=this.parsedAttributes,e=this){this.drawKeyShape(t,e),this.drawPortShapes(t,e)}getKeyStyle(t){const e=Te(t,["dx","dy","innerHTML","pointerEvents","cursor"]),{dx:n=0,dy:s=0}=e,o=sc(e,["dx","dy"]),[r,a]=this.getSize(t);return Object.assign(Object.assign({x:n,y:s},o),{width:r,height:a})}drawKeyShape(t,e){const n=this.getKeyStyle(t),{x:s,y:o,width:r=0,height:a=0}=n,c=this.upsert("key-container",_t,{x:s,y:o,width:r,height:a,opacity:0},e);return this.upsert("key",vo,n,c)}connectedCallback(){if(!(this.context.canvas.getRenderer("main")instanceof xe))return;const n=this.getDomElement();this.events.forEach(s=>{n.addEventListener(s,this.forwardEvents)})}attributeChangedCallback(t,e,n){t==="zIndex"&&e!==n&&(this.getDomElement().style.zIndex=n)}destroy(){const t=this.getDomElement();this.events.forEach(e=>{t.removeEventListener(e,this.forwardEvents)}),super.destroy()}normalizeToPointerEvent(t,e){const n=[];if(e.isTouchEvent(t))for(let s=0;s<t.changedTouches.length;s++){const o=t.changedTouches[s];B(o.button)&&(o.button=0),B(o.buttons)&&(o.buttons=1),B(o.isPrimary)&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),B(o.width)&&(o.width=o.radiusX||1),B(o.height)&&(o.height=o.radiusY||1),B(o.tiltX)&&(o.tiltX=0),B(o.tiltY)&&(o.tiltY=0),B(o.pointerType)&&(o.pointerType="touch"),B(o.pointerId)&&(o.pointerId=o.identifier||0),B(o.pressure)&&(o.pressure=o.force||.5),B(o.twist)&&(o.twist=0),B(o.tangentialPressure)&&(o.tangentialPressure=0),o.isNormalized=!0,o.type=t.type,n.push(o)}else if(e.isMouseEvent(t)){const s=t;B(s.isPrimary)&&(s.isPrimary=!0),B(s.width)&&(s.width=1),B(s.height)&&(s.height=1),B(s.tiltX)&&(s.tiltX=0),B(s.tiltY)&&(s.tiltY=0),B(s.pointerType)&&(s.pointerType="mouse"),B(s.pointerId)&&(s.pointerId=1),B(s.pressure)&&(s.pressure=.5),B(s.twist)&&(s.twist=0),B(s.tangentialPressure)&&(s.tangentialPressure=0),s.isNormalized=!0,n.push(s)}else n.push(t);return n}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.ctrlKey=e.ctrlKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null}bootstrapEvent(t,e,n,s){t.view=n,t.originalEvent=null,t.nativeEvent=s,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:o,y:r}=this.getViewportXY(e);t.viewport.x=o,t.viewport.y=r;const[a,c]=this.context.canvas.getCanvasByViewport([o,r]);return t.canvas.x=a,t.canvas.y=c,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=s.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t}getViewportXY(t){let e,n;const{offsetX:s,offsetY:o,clientX:r,clientY:a}=t;if(!Ze(s)&&!Ze(o))e=s,n=o;else{const c=this.eventService.client2Viewport({x:r,y:a});e=c.x,n=c.y}return{x:e,y:n}}onframe(){super.onframe();const{opacity:t}=this.attributes;this.getDomElement().style.opacity=`${t}`}}yn.defaultStyleProps={size:[160,80],halo:!1,icon:!1,label:!1,pointerEvents:"auto"};var fi=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};let Zo=class qo extends ft{constructor(t){super(Y({style:qo.defaultStyleProps},t))}getKeyStyle(t){const[e,n]=this.getSize(t),s=super.getKeyStyle(t),{fillOpacity:o,opacity:r=o}=s,a=fi(s,["fillOpacity","opacity"]);return Object.assign(Object.assign({opacity:r},a),{width:e,height:n,x:-e/2,y:-n/2})}getHaloStyle(t){if(t.halo===!1)return!1;const e=this.getShape("key").attributes,{fill:n,stroke:s}=e;fi(e,["fill","stroke"]);const o=F(this.getGraphicStyle(t),"halo"),r=Number(o.lineWidth),[a,c]=T(this.getSize(t),[r,r]);return Object.assign(Object.assign({},o),{width:a,height:c,fill:"transparent",x:-a/2,y:-c/2})}getIconStyle(t){const e=super.getIconStyle(t),[n,s]=this.getSize(t);return e?Object.assign({width:n*Ct,height:s*Ct},e):!1}drawKeyShape(t,e){const n=this.upsert("key",$s,this.getKeyStyle(t),e);return Ws(this),n}drawHaloShape(t,e){this.upsert("halo",_t,this.getHaloStyle(t),e)}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&Vs(this)}};Zo.defaultStyleProps={size:32};class ic extends ft{constructor(t){super(t)}getKeyStyle(t){const[e,n]=this.getSize(t);return Object.assign(Object.assign({},super.getKeyStyle(t)),{width:e,height:n,x:-e/2,y:-n/2})}getIconStyle(t){const e=super.getIconStyle(t),{width:n,height:s}=this.getShape("key").attributes;return e?Object.assign({width:n*Ct,height:s*Ct},e):!1}drawKeyShape(t,e){return this.upsert("key",_t,this.getKeyStyle(t),e)}}class oc extends fn{constructor(t){super(t)}getInnerR(t){return t.innerR||this.getOuterR(t)*3/8}getOuterR(t){return Math.min(...this.getSize(t))/2}getPoints(t){return Wc(this.getOuterR(t),this.getInnerR(t))}getIconStyle(t){const e=super.getIconStyle(t),n=this.getInnerR(t)*2*Ct;return e?Object.assign({width:n,height:n},e):!1}getPortXY(t,e){const{placement:n="top"}=e,s=this.getShape("key").getLocalBounds(),o=Vc(this.getOuterR(t),this.getInnerR(t));return Ys(s,n,o,!1)}}class mn extends fn{constructor(t){super(Y({style:mn.defaultStyleProps},t))}getPoints(t){const{direction:e}=t,[n,s]=this.getSize(t);return Hc(n,s,e)}getPortXY(t,e){const{direction:n}=t,{placement:s="top"}=e,o=this.getShape("key").getLocalBounds(),[r,a]=this.getSize(t),c=Uc(r,a,n);return Ys(o,s,c,!1)}getIconStyle(t){const{icon:e,iconText:n,iconSrc:s,direction:o}=t;if(e===!1||gt(n||s))return!1;const r=F(this.getGraphicStyle(t),"icon"),a=this.getShape("key").getLocalBounds(),[c,l]=ua(a,o),d=fa(a,o)*2*Ct;return Object.assign({x:c,y:l,width:d,height:d},r)}}mn.defaultStyleProps={size:40,direction:"up"};var gi=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class fe extends ft{constructor(t){super(Y({style:fe.defaultStyleProps},t)),this.type="combo",this.updateComboPosition(this.parsedAttributes)}getKeySize(t){const{collapsed:e,childrenNode:n=[]}=t;return n.length===0?this.getEmptyKeySize(t):e?this.getCollapsedKeySize(t):this.getExpandedKeySize(t)}getEmptyKeySize(t){const{padding:e,collapsedSize:n}=t,[s,o,r,a]=mt(e);return T(nt(n),[a+o,s+r,0])}getCollapsedKeySize(t){return nt(t.collapsedSize)}getExpandedKeySize(t){const e=this.getContentBBox(t);return[vt(e),bt(e),0]}getContentBBox(t){const{childrenNode:e=[],padding:n}=t,s=e.map(r=>this.context.element.getElement(r)).filter(Boolean);if(s.length===0){const r=new Xt,{x:a=0,y:c=0,size:l}=t,[d,h]=nt(l);return r.setMinMax([a-d/2,c-h/2,0],[a+d/2,c+h/2,0]),r}const o=Ae(s.map(r=>r.getBounds()));return n?zt(o,n):o}drawCollapsedMarkerShape(t,e){const n=this.getCollapsedMarkerStyle(t);this.upsert("collapsed-marker",Xo,n,e),Ws(this)}getCollapsedMarkerStyle(t){if(!t.collapsed||!t.collapsedMarker)return!1;const e=F(this.getGraphicStyle(t),"collapsedMarker"),{type:n}=e,s=gi(e,["type"]),o=this.getShape("key"),[r,a]=xt(o.getLocalBounds(),"center"),c=Object.assign(Object.assign({},s),{x:r,y:a});if(n){const l=this.getCollapsedMarkerText(n,t);Object.assign(c,{text:l})}return c}getCollapsedMarkerText(t,e){const{childrenData:n=[]}=e,{model:s}=this.context;return t==="descendant-count"?s.getDescendantsData(this.id).length.toString():t==="child-count"?n.length.toString():t==="node-count"?s.getDescendantsData(this.id).filter(o=>s.getElementType(v(o))==="node").length.toString():A(t)?t(n):""}getComboPosition(t){const{x:e=0,y:n=0,collapsed:s,childrenData:o=[]}=t;if(o.length===0)return[+e,+n,0];if(s){const{model:r}=this.context,a=r.getDescendantsData(this.id).filter(c=>!r.isCombo(v(c)));if(a.length>0&&a.some(Da)){const c=a.reduce((l,d)=>T(l,V(d)),[0,0,0]);return ut(c,a.length)}return[+e,+n,0]}return this.getContentBBox(t).center}getComboStyle(t){const[e,n]=this.getComboPosition(t);return{x:e,y:n,transform:[["translate",e,n]]}}updateComboPosition(t){const e=this.getComboStyle(t);Object.assign(this.style,e);const{x:n,y:s}=e;this.context.model.syncNodeLikeDatum({id:this.id,style:{x:n,y:s}}),Vs(this)}render(t,e=this){super.render(t,e),this.drawCollapsedMarkerShape(t,e)}update(t={}){super.update(t),this.updateComboPosition(this.parsedAttributes)}onframe(){super.onframe(),this.attributes.collapsed||this.updateComboPosition(this.parsedAttributes),this.drawKeyShape(this.parsedAttributes,this)}animate(t,e){const n=super.animate(this.attributes.collapsed?t:t.map(s=>{var{x:o,y:r,z:a,transform:c}=s,l=gi(s,["x","y","z","transform"]);return l}),e);return n&&new Proxy(n,{set:(s,o,r)=>(o==="currentTime"&&Promise.resolve().then(()=>this.onframe()),Reflect.set(s,o,r))})}}fe.defaultStyleProps={childrenNode:[],droppable:!0,draggable:!0,collapsed:!1,collapsedSize:32,collapsedMarker:!0,collapsedMarkerZIndex:1,collapsedMarkerFontSize:12,collapsedMarkerTextAlign:"center",collapsedMarkerTextBaseline:"middle",collapsedMarkerType:"child-count"};class rc extends fe{constructor(t){super(t)}drawKeyShape(t,e){return this.upsert("key",an,this.getKeyStyle(t),e)}getKeyStyle(t){const{collapsed:e}=t,n=super.getKeyStyle(t),[s]=this.getKeySize(t);return Object.assign(Object.assign(Object.assign({},n),e&&F(n,"collapsed")),{r:s/2})}getCollapsedKeySize(t){const[e,n]=nt(t.collapsedSize),s=Math.max(e,n)/2;return[s*2,s*2,0]}getExpandedKeySize(t){const e=this.getContentBBox(t),[n,s]=jt(e),o=Math.sqrt(Math.pow(n,2)+Math.pow(s,2))/2;return[o*2,o*2,0]}getIntersectPoint(t,e=!1){const n=this.getShape("key").getBounds();return hn(t,n,e)}}class ac extends fe{constructor(t){super(t)}drawKeyShape(t,e){return this.upsert("key",_t,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t),[n,s]=this.getKeySize(t);return Object.assign(Object.assign(Object.assign({},e),t.collapsed&&F(e,"collapsed")),{width:n,height:s,x:-n/2,y:-s/2})}}const cc={padding:10};function pi(i,t,e,n,s,o){const{padding:r}=Object.assign(cc,o),a=Lt(e,r),c=Lt(n,r),l=[i,...s,t];let d=null;const h=[];for(let u=0,f=l.length;u<f-1;u++){const g=u+1,p=l[u],y=l[g],m=_a(p,y);let E=null;if(u===0)if(g===f-1)if(a.intersects(c))E=ds(p,y,a,c);else if(!tn(p,a)&&!tn(y,c)){const b=Yt(p,a),S=Yt(y,c);E=mi(b,S,Z(b,S)),E.points.unshift(b),E.points.push(S)}else m||(E=dc(p,y,a,c));else ht(y,a)?E=ds(p,y,a,Lt(y,r),d):m||(E=Ye(p,y,a));else g===f-1?ht(p,c)?E=ds(p,y,Lt(p,r),c,d):m||(E=Qo(p,y,c,d)):m||(E=mi(p,y,d));E?(h.push(...E.points),d=E.direction):d=Z(p,y),g<f-1&&h.push(y)}return h.map(qt)}const lc={N:"S",S:"N",W:"E",E:"W"},yi={N:-Math.PI/2,S:Math.PI/2,E:0,W:Math.PI};function Z(i,t){const[e,n]=i,[s,o]=t;return e===s?n>o?"N":"S":n===o?e>s?"W":"E":null}function ws(i,t){return t==="N"||t==="S"?bt(i):vt(i)}function mi(i,t,e){const n=[i[0],t[1]],s=[t[0],i[1]],o=Z(i,n),r=Z(i,s),a=e?lc[e]:null,c=o===e||o!==a&&r!==e?n:s;return{points:[c],direction:Z(c,t)}}function Ye(i,t,e){if(tn(i,e)){const n=we(i,t,e);return{points:[n],direction:Z(n,t)}}else{const n=Yt(i,e),o=["left","right"].includes(be(i,e))?[t[0],n[1]]:[n[0],t[1]];return{points:[o],direction:Z(o,t)}}}function Qo(i,t,e,n){const s=tn(t,e)?t:Yt(t,e),o=[[s[0],i[1]],[i[0],s[1]]],r=o.filter(c=>ha(c,e)&&!Mo(c,e,!0)),a=r.filter(c=>Z(c,i)!==n);if(a.length>0){const c=a.find(l=>Z(i,l)===n)||a[0];return{points:[c],direction:Z(c,t)}}else{const c=br(o,r)[0],l=kt(t,c,ws(e,n)/2);return{points:[we(l,i,e),l],direction:Z(l,t)}}}function dc(i,t,e,n){let s=Ye(i,t,e);const o=De(s.points[0]);if(ht(o,n)){s=Ye(t,i,n);const r=De(s.points[0]);if(ht(r,e)){const a=kt(i,o,ws(e,Z(i,o))/2),c=kt(t,r,ws(n,Z(t,r))/2),l=[(a[0]+c[0])/2,(a[1]+c[1])/2],d=Ye(i,l,e),h=Qo(l,t,n,d.direction);s.points=[d.points[0],h.points[0]],s.direction=h.direction}}return s}function ds(i,t,e,n,s){const r=Ae([e,n]),a=N(t,r.center)>N(i,r.center),[c,l]=a?[t,i]:[i,t],d=bt(r)+vt(r);let h;if(s){const g=[c[0]+d*Math.cos(yi[s]),c[1]+d*Math.sin(yi[s])];h=kt(Yt(g,r),g,.01)}else h=kt(Yt(c,r),c,-.01);let u=we(h,l,r),f=[pe(h,2),pe(u,2)];if($(pe(h),pe(u))){const g=js(P(h,c),[1,0,0])+Math.PI/2;u=[l[0]+d*Math.cos(g),l[1]+d*Math.sin(g),0],u=pe(kt(Yt(u,r),l,-.01),2);const p=we(h,u,r);f=[h,p,u]}return{points:a?f.reverse():f,direction:Z(a?h:u,t)}}function we(i,t,e){let n=[i[0],t[1]];return ht(n,e)&&(n=[t[0],i[1]]),n}function Jo(i,t,e,n,s){let c=typeof t=="number"?t:.5;t==="start"&&(c=0),t==="end"&&(c=.99);const l=K(i.getPoint(c)),d=K(i.getPoint(c+.01));let h=t==="start"?"left":t==="end"?"right":"center";if(Bo(l,d)||!e){const[m,E]=vi(i,c,n,s);return{transform:[["translate",m,E]],textAlign:h}}let u=Math.atan2(d[1]-l[1],d[0]-l[0]);d[0]<l[0]&&(h=h==="center"?h:h==="left"?"right":"left",n*=-1,u+=Math.PI);const[g,p]=vi(i,c,n,s,u),y=[["translate",g,p],["rotate",u/Math.PI*180]];return{textAlign:h,transform:y}}function hc(i,t,e,n,s){var o,r;const a=((o=i.badge)===null||o===void 0?void 0:o.getGeometryBounds().halfExtents[0])*2||0,c=((r=i.label)===null||r===void 0?void 0:r.getGeometryBounds().halfExtents[0])*2||0;return Jo(i.key,e,!0,(c?(c/2+a/2)*(t==="suffix"?1:-1):0)+n,s)}function vi(i,t,e,n,s){const[o,r]=K(i.getPoint(t));let a=e,c=n;return s&&(a=e*Math.cos(s)-n*Math.sin(s),c=e*Math.sin(s)+n*Math.cos(s)),[o+a,r+c]}function Cs(i,t,e,n){if($(i,t))return i;const s=P(t,i),o=[i[0]+e*s[0],i[1]+e*s[1]],r=Ot(dn(s,!1));return o[0]+=n*r[0],o[1]+=n*r[1],o}function uc(i){return U(i)?[i,-i]:i}function fc(i){return U(i)?[i,1-i]:i}function gc(i,t,e){return[["M",i[0],i[1]],["Q",e[0],e[1],t[0],t[1]]]}function tr(i,t,e){return[["M",i[0],i[1]],["C",e[0][0],e[0][1],e[1][0],e[1][1],t[0],t[1]]]}function Hs(i,t=0,e=!1){const n=i.length-1,s=i[0],o=i[n],r=i.slice(1,n),a=[["M",s[0],s[1]]];return r.forEach((c,l)=>{const d=r[l-1]||s,h=r[l+1]||o;if(!jo(d,c,h)&&t){const[u,f]=pc(d,c,h,t);a.push(["L",u[0],u[1]],["Q",c[0],c[1],f[0],f[1]],["L",f[0],f[1]])}else a.push(["L",c[0],c[1]])}),a.push(["L",o[0],o[1]]),e&&a.push(["Z"]),a}function pc(i,t,e,n){const s=en(i,t),o=en(e,t),r=Math.min(n,Math.min(s,o)/2),a=[t[0]-r/s*(t[0]-i[0]),t[1]-r/s*(t[1]-i[1])],c=[t[0]-r/o*(t[0]-e[0]),t[1]-r/o*(t[1]-e[1])];return[a,c]}const yc=i=>{const t=Math.PI/2,e=bt(i)/2,n=vt(i)/2,s=Math.atan2(e,n)/2,o=Math.atan2(n,e)/2;return{top:[-t-o,-t+o],"top-right":[-t+o,-s],"right-top":[-t+o,-s],right:[-s,s],"bottom-right":[s,t-o],"right-bottom":[s,t-o],bottom:[t-o,t+o],"bottom-left":[t+o,Math.PI-s],"left-bottom":[t+o,Math.PI-s],left:[Math.PI-s,Math.PI+s],"top-left":[Math.PI+s,-t-o],"left-top":[Math.PI+s,-t-o]}};function er(i,t,e,n,s){const o=Lt(i),r=i.getCenter();let a=n&&Bt(n),c=s&&Bt(s);if(!a||!c){const l=yc(o),d=l[t][0],h=l[t][1],[u,f]=jt(o),g=Math.max(u,f),p=T(r,[g*Math.cos(d),g*Math.sin(d),0]),y=T(r,[g*Math.cos(h),g*Math.sin(h),0]);a=Ts(i,p),c=Ts(i,y),e||([a,c]=[c,a])}return[a,c]}function mc(i,t,e,n,s,o){const r=i.getPorts()[s||o],a=i.getPorts()[o||s];let[c,l]=er(i,t,e,r,a);const d=vc(i,c,l,n);return r&&(c=Ce(r,d[0])),a&&(l=Ce(a,d.at(-1))),tr(c,l,d)}function vc(i,t,e,n){const s=i.getCenter();if($(t,e)){const o=P(t,s),r=[n*Math.sign(o[0])||n/2,n*Math.sign(o[1])||-n/2,0];return[T(t,r),T(e,lt(r,[1,-1,1]))]}return[kt(s,t,N(s,t)+n),kt(s,e,N(s,e)+n)]}function bc(i,t,e,n,s,o,r){const a=Ks(i),c=a[o||r],l=a[r||o];let[d,h]=er(i,e,n,c,l);const u=Ec(i,d,h,s);return c&&(d=Ce(c,u[0])),l&&(h=Ce(l,u.at(-1))),Hs([d,...u,h],t)}function Ec(i,t,e,n){const s=[],o=Lt(i);if($(t,e))switch(be(t,o)){case"left":s.push([t[0]-n,t[1]]),s.push([t[0]-n,t[1]+n]),s.push([t[0],t[1]+n]);break;case"right":s.push([t[0]+n,t[1]]),s.push([t[0]+n,t[1]+n]),s.push([t[0],t[1]+n]);break;case"top":s.push([t[0],t[1]-n]),s.push([t[0]+n,t[1]-n]),s.push([t[0]+n,t[1]]);break;case"bottom":s.push([t[0],t[1]+n]),s.push([t[0]+n,t[1]+n]),s.push([t[0]+n,t[1]]);break}else{const r=be(t,o),a=be(e,o);if(r===a){const c=r;let l,d;switch(c){case"left":l=Math.min(t[0],e[0])-n,s.push([l,t[1]]),s.push([l,e[1]]);break;case"right":l=Math.max(t[0],e[0])+n,s.push([l,t[1]]),s.push([l,e[1]]);break;case"top":d=Math.min(t[1],e[1])-n,s.push([t[0],d]),s.push([e[0],d]);break;case"bottom":d=Math.max(t[1],e[1])+n,s.push([t[0],d]),s.push([e[0],d]);break}}else{const c=(u,f)=>({left:[f[0]-n,f[1]],right:[f[0]+n,f[1]],top:[f[0],f[1]-n],bottom:[f[0],f[1]+n]})[u],l=c(r,t),d=c(a,e),h=we(l,d,o);s.push(l,h,d)}}return s}function _s(i,t){const e=new Set,n=new Set,s=new Set;return i.forEach(o=>{t(o).forEach(a=>{e.add(a),i.includes(a.source)&&i.includes(a.target)?n.add(a):s.add(a)})}),{edges:Array.from(e),internal:Array.from(n),external:Array.from(s)}}function bi(i,t){const e=[];let n=i;for(;n;){e.push(n);const s=t(v(n));if(s)n=s;else break}if(e.some(s=>{var o;return(o=s.style)===null||o===void 0?void 0:o.collapsed})){const s=e.reverse().findIndex(Q);return e[s]||e.at(-1)}return i}function xc(i,t){return t||(i<4?10:i===4?12:i*2.5)}const Sc=(i,t)=>{const e=Math.max(i,t)/2;return[["M",-i/2,0],["A",e,e,0,1,0,2*e-i/2,0],["A",e,e,0,1,0,-i/2,0],["Z"]]},nr=(i,t)=>[["M",-i/2,0],["L",i/2,-t/2],["L",i/2,t/2],["Z"]],Oc=(i,t)=>[["M",-i/2,0],["L",0,-t/2],["L",i/2,0],["L",0,t/2],["Z"]],Dc=(i,t)=>[["M",-i/2,0],["L",i/2,-t/2],["L",4*i/5-i/2,0],["L",i/2,t/2],["Z"]],wc=(i,t)=>[["M",-i/2,-t/2],["L",i/2,-t/2],["L",i/2,t/2],["L",-i/2,t/2],["Z"]],Cc=(i,t)=>{const e=i/2,n=i/7,s=i-n;return[["M",-e,0],["L",0,-t/2],["L",0,t/2],["Z"],["M",s-e,-t/2],["L",s+n-e,-t/2],["L",s+n-e,t/2],["L",s-e,t/2],["Z"]]},_c=(i,t)=>[["M",i/2,-t/2],["L",-i/2,0],["L",i/2,0],["L",-i/2,0],["L",i/2,t/2]],Tc=Object.freeze(Object.defineProperty({__proto__:null,circle:Sc,diamond:Oc,rect:wc,simple:_c,triangle:nr,triangleRect:Cc,vee:Dc},Symbol.toStringTag,{value:"Module"}));var $e=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class $t extends Go{constructor(t){super(Y({style:$t.defaultStyleProps},t)),this.type="edge"}get sourceNode(){const{sourceNode:t}=this.parsedAttributes;return this.context.element.getElement(t)}get targetNode(){const{targetNode:t}=this.parsedAttributes;return this.context.element.getElement(t)}getKeyStyle(t){const e=this.getGraphicStyle(t),{loop:n}=e,s=$e(e,["loop"]),{sourceNode:o,targetNode:r}=this,c={d:n&&jc(o,r)?this.getLoopPath(t):this.getKeyPath(t)};return Rt.PARSED_STYLE_LIST.forEach(l=>{l in s&&(c[l]=s[l])}),c}getLoopPath(t){const{sourcePort:e,targetPort:n}=t,s=this.sourceNode,o=Lt(s),r=Math.max(vt(o),bt(o)),{placement:a,clockwise:c,dist:l=r}=F(this.getGraphicStyle(t),"loop");return mc(s,a,c,l,e,n)}getEndpoints(t,e=!0,n=[]){const{sourcePort:s,targetPort:o}=t,{sourceNode:r,targetNode:a}=this,[c,l]=Fc(r,a,s,o);if(!e){const f=c?Bt(c):r.getCenter(),g=l?Bt(l):a.getCenter();return[f,g]}const d=typeof n=="function"?n():n,h=Di(c||r,d[0]||l||a),u=Di(l||a,d[d.length-1]||c||r);return[h,u]}getHaloStyle(t){if(t.halo===!1)return!1;const e=this.getKeyStyle(t),n=F(this.getGraphicStyle(t),"halo");return Object.assign(Object.assign({},e),n)}getLabelStyle(t){if(t.label===!1||!t.labelText)return!1;const e=F(this.getGraphicStyle(t),"label"),{placement:n,offsetX:s,offsetY:o,autoRotate:r,maxWidth:a}=e,c=$e(e,["placement","offsetX","offsetY","autoRotate","maxWidth"]),l=Jo(this.shapeMap.key,n,r,s,o),d=this.shapeMap.key.getLocalBounds(),h=$a([d.min,d.max],a);return Object.assign({wordWrapWidth:h},l,c)}getBadgeStyle(t){if(t.badge===!1||!t.badgeText)return!1;const e=F(t,"badge"),{offsetX:n,offsetY:s,placement:o}=e,r=$e(e,["offsetX","offsetY","placement"]);return Object.assign(r,hc(this.shapeMap,o,t.labelPlacement,n,s))}drawArrow(t,e){var n;const s=e==="start",r=t[e==="start"?"startArrow":"endArrow"],a=this.shapeMap.key;if(r){const c=this.getArrowStyle(t,s),[l,d,h]=s?["markerStart","markerStartOffset","startArrowOffset"]:["markerEnd","markerEndOffset","endArrowOffset"],u=a.parsedStyle[l];if(u)u.attr(c);else{const f=c.src?po:Rt,g=new f({style:c});a.style[l]=g}a.style[d]=t[h]||c.width/2+ +c.lineWidth}else{const c=s?"markerStart":"markerEnd";(n=a.style[c])===null||n===void 0||n.destroy(),a.style[c]=null}}getArrowStyle(t,e){const n=this.getShape("key").attributes,s=e?"startArrow":"endArrow",o=F(this.getGraphicStyle(t),s),{size:r,type:a}=o,c=$e(o,["size","type"]),[l,d]=nt(xc(n.lineWidth,r)),u=(A(a)?a:Tc[a]||nr)(l,d);return Object.assign(Te(n,["stroke","strokeOpacity","fillOpacity"]),{width:l,height:d},Object.assign({},u&&{d:u,fill:a==="simple"?"":n.stroke}),c)}drawLabelShape(t,e){const n=this.getLabelStyle(t);this.upsert("label",Ft,n,e)}drawHaloShape(t,e){const n=this.getHaloStyle(t);this.upsert("halo",Rt,n,e)}drawBadgeShape(t,e){const n=this.getBadgeStyle(t);this.upsert("badge",ue,n,e)}drawSourceArrow(t){this.drawArrow(t,"start")}drawTargetArrow(t){this.drawArrow(t,"end")}drawKeyShape(t,e){const n=this.getKeyStyle(t);return this.upsert("key",Rt,n,e)}render(t=this.parsedAttributes,e=this){this.drawKeyShape(t,e),this.getShape("key")&&(this.drawSourceArrow(t),this.drawTargetArrow(t),this.drawLabelShape(t,e),this.drawHaloShape(t,e),this.drawBadgeShape(t,e))}onframe(){this.drawKeyShape(this.parsedAttributes,this),this.drawSourceArrow(this.parsedAttributes),this.drawTargetArrow(this.parsedAttributes),this.drawHaloShape(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this),this.drawBadgeShape(this.parsedAttributes,this)}animate(t,e){const n=super.animate(t,e);return n&&new Proxy(n,{set:(s,o,r)=>(o==="currentTime"&&Promise.resolve().then(()=>this.onframe()),Reflect.set(s,o,r))})}}$t.defaultStyleProps={badge:!0,badgeOffsetX:0,badgeOffsetY:0,badgePlacement:"suffix",isBillboard:!0,label:!0,labelAutoRotate:!0,labelIsBillboard:!0,labelMaxWidth:"80%",labelOffsetX:4,labelOffsetY:0,labelPlacement:"center",labelTextBaseline:"middle",labelWordWrap:!1,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloPointerEvents:"none",haloStrokeOpacity:.25,haloZIndex:-1,loop:!0,startArrow:!1,startArrowLineDash:0,startArrowLineJoin:"round",startArrowLineWidth:1,startArrowTransformOrigin:"center",startArrowType:"vee",endArrow:!1,endArrowLineDash:0,endArrowLineJoin:"round",endArrowLineWidth:1,endArrowTransformOrigin:"center",endArrowType:"vee",loopPlacement:"top",loopClockwise:!0};class te extends $t{constructor(t){super(Y({style:te.defaultStyleProps},t))}getKeyPath(t){const[e,n]=this.getEndpoints(t),{controlPoints:s,curvePosition:o,curveOffset:r}=t,a=this.getControlPoints(e,n,fc(o),uc(r),s);return tr(e,n,a)}getControlPoints(t,e,n,s,o){return(o==null?void 0:o.length)===2?o:[Cs(t,e,n[0],s[0]),Cs(t,e,n[1],s[1])]}}te.defaultStyleProps={curvePosition:.5,curveOffset:20};class vn extends te{constructor(t){super(Y({style:vn.defaultStyleProps},t))}getControlPoints(t,e,n,s){const o=e[0]-t[0];return[[t[0]+o*n[0]+s[0],t[1]],[e[0]-o*n[1]+s[1],e[1]]]}}vn.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class bn extends te{constructor(t){super(Y({style:bn.defaultStyleProps},t))}get ref(){return this.context.model.getRootsData()[0]}getEndpoints(t){if(this.sourceNode.id===this.ref.id)return super.getEndpoints(t);const e=V(this.ref),n=this.sourceNode.getIntersectPoint(e,!0),s=this.targetNode.getIntersectPoint(e);return[n,s]}toRadialCoordinate(t){const e=V(this.ref),n=N(t,e),s=No(P(t,e));return[n,s]}getControlPoints(t,e,n,s){const[o,r]=this.toRadialCoordinate(t),[a]=this.toRadialCoordinate(e),c=a-o;return[[t[0]+(c*n[0]+s[0])*Math.cos(r),t[1]+(c*n[0]+s[0])*Math.sin(r)],[e[0]-(c*n[1]-s[0])*Math.cos(r),e[1]-(c*n[1]-s[0])*Math.sin(r)]]}}bn.defaultStyleProps={curvePosition:.5,curveOffset:20};class En extends te{constructor(t){super(Y({style:En.defaultStyleProps},t))}getControlPoints(t,e,n,s){const o=e[1]-t[1];return[[t[0],t[1]+o*n[0]+s[0]],[e[0],e[1]-o*n[1]+s[1]]]}}En.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class xn extends $t{constructor(t){super(Y({style:xn.defaultStyleProps},t))}getKeyPath(t){const[e,n]=this.getEndpoints(t);return[["M",e[0],e[1]],["L",n[0],n[1]]]}}xn.defaultStyleProps={};const Ac={enableObstacleAvoidance:!1,offset:10,maxAllowedDirectionChange:Math.PI/2,maximumLoops:3e3,gridSize:5,startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{right:{stepX:1,stepY:0},left:{stepX:-1,stepY:0},bottom:{stepX:0,stepY:1},top:{stepX:0,stepY:-1}},penalties:{0:0,90:0},distFunc:en},Et=i=>`${Math.round(i[0])}|||${Math.round(i[1])}`;function Ut(i,t){const e=n=>Math.round(n/t);return U(i)?e(i):i.map(e)}function Mc(i,t){const e=Math.abs(i-t);return e>Math.PI?2*Math.PI-e:e}function Ei(i,t){const e=t[0]-i[0],n=t[1]-i[1];return!e&&!n?0:Math.atan2(n,e)}function sr(i,t,e,n){const s=Ei(i,t),o=e[Et(i)],a=Ei(o||n,i);return Mc(a,s)}const Pc=(i,t)=>{const{offset:e,gridSize:n}=t,s={};return i.forEach(o=>{if(!o||o.destroyed||!o.isVisible())return;const r=zt(o.getRenderBounds(),e);for(let a=Ut(r.min[0],n);a<=Ut(r.max[0],n);a+=1)for(let c=Ut(r.min[1],n);c<=Ut(r.max[1],n);c+=1)s[`${a}|||${c}`]=!0}),s};function xi(i,t,e){return Math.min(...t.map(n=>e(i,n)))}function Rc(i,t,e){let n=i[0],s=e(i[0],t);for(let o=0;o<i.length;o++){const r=i[o],a=e(r,t);a<s&&(n=r,s=a)}return n}const Si=(i,t,e,n)=>{if(!t)return[i];const{directionMap:s,offset:o}=n,r=zt(t.getRenderBounds(),o),a=Object.keys(s).reduce((c,l)=>{if(e.includes(l)){const d=s[l],[h,u]=jt(r),f=[i[0]+d.stepX*h,i[1]+d.stepY*u],g=ga(r);for(let p=0;p<g.length;p++){const y=zs([i,f],g[p]);y&&Mo(y,r)&&c.push(y)}}return c},[]);return ht(i,r)||a.push(i),a.map(c=>Ut(c,n.gridSize))},Lc=(i,t,e,n,s,o,r)=>{const a=[];let c=[o[0]===n[0]?n[0]:i[0]*r,o[1]===n[1]?n[1]:i[1]*r];a.unshift(c);let l=i,d=t[Et(l)];for(;d;){const f=d,g=l;sr(f,g,t,e)&&(c=[f[0]===g[0]?c[0]:f[0]*r,f[1]===g[1]?c[1]:f[1]*r],a.unshift(c)),d=t[Et(f)],l=f}const h=s.map(f=>[f[0]*r,f[1]*r]),u=Rc(h,c,en);return a.unshift(u),a};function Nc(i,t,e,n){const s=qt(i.getCenter()),o=qt(t.getCenter()),r=Object.assign(Ac,n),{gridSize:a}=r,c=r.enableObstacleAvoidance?e:[i,t],l=Pc(c,r),d=Ut(s,a),h=Ut(o,a),u=Si(s,i,r.startDirections,r),f=Si(o,t,r.endDirections,r);u.forEach(_=>delete l[Et(_)]),f.forEach(_=>delete l[Et(_)]);const g={},p={},y={},m={},E={},b=new Ic;for(let _=0;_<u.length;_++){const M=u[_],k=Et(M);g[k]=M,m[k]=0,E[k]=xi(M,f,r.distFunc),b.add({id:k,value:E[k]})}const S=f.map(_=>Et(_));let D=r.maximumLoops,w,C=1/0;for(const[_,M]of Object.entries(g))E[_]<=C&&(C=E[_],w=M);for(;Object.keys(g).length>0&&D>0;){const _=b.minId(!1);if(_)w=g[_];else break;const M=Et(w);if(S.includes(M))return Lc(w,y,d,o,u,h,a);delete g[M],b.remove(M),p[M]=!0;for(const k of Object.values(r.directionMap)){const ct=T(w,[k.stepX,k.stepY]),it=Et(ct);if(p[it])continue;const Ie=sr(w,ct,y,d);if(Ie>r.maxAllowedDirectionChange||l[it])continue;g[it]||(g[it]=ct);const Js=r.penalties[Ie],fr=r.distFunc(w,ct)+(isNaN(Js)?a:Js),os=m[M]+fr,ti=m[it];ti&&os>=ti||(y[it]=w,m[it]=os,E[it]=os+xi(ct,f,r.distFunc),b.add({id:it,value:E[it]}))}D-=1}return[]}class Ic{constructor(){this.arr=[],this.map={},this.arr=[],this.map={}}_innerAdd(t,e){let n=0,s=e-1;for(;s-n>1;){const o=Math.floor((n+s)/2);if(this.arr[o].value>t.value)s=o;else if(this.arr[o].value<t.value)n=o;else{this.arr.splice(o,0,t),this.map[t.id]=!0;return}}this.arr.splice(s,0,t),this.map[t.id]=!0}add(t){delete this.map[t.id];const e=this.arr.length;if(!e||this.arr[e-1].value<t.value){this.arr.push(t),this.map[t.id]=!0;return}this._innerAdd(t,e)}remove(t){this.map[t]&&delete this.map[t]}_clearAndGetMinId(){let t;for(let e=this.arr.length-1;e>=0;e--)this.map[this.arr[e].id]?t=this.arr[e].id:this.arr.splice(e,1);return t}_findFirstId(){for(;this.arr.length;){const t=this.arr.shift();if(this.map[t.id])return t.id}}minId(t){return t?this._clearAndGetMinId():this._findFirstId()}}class Sn extends $t{constructor(t){super(Y({style:Sn.defaultStyleProps},t))}getControlPoints(t){const{router:e}=t,{sourceNode:n,targetNode:s}=this,[o,r]=this.getEndpoints(t,!1);let a=[];if(!e)a=t.controlPoints;else if(e.type==="shortest-path"){const c=this.context.element.getNodes();a=Nc(n,s,c,e),a.length||(a=pi(o,r,n,s,t.controlPoints,{padding:e.offset}))}else e.type==="orth"&&(a=pi(o,r,n,s,t.controlPoints,e));return a}getPoints(t){const e=this.getControlPoints(t),[n,s]=this.getEndpoints(t,!0,e);return[n,...e,s]}getKeyPath(t){const e=this.getPoints(t);return Hs(e,t.radius)}getLoopPath(t){const{sourcePort:e,targetPort:n,radius:s}=t,o=this.sourceNode,r=Lt(o),a=Math.max(vt(r),bt(r))/4,{placement:c,clockwise:l,dist:d=a}=F(this.getGraphicStyle(t),"loop");return bc(o,s,c,l,d,e,n)}}Sn.defaultStyleProps={radius:0,controlPoints:[],router:!1};class On extends $t{constructor(t){super(Y({style:On.defaultStyleProps},t))}getKeyPath(t){const{curvePosition:e,curveOffset:n}=t,[s,o]=this.getEndpoints(t),r=t.controlPoint||Cs(s,o,e,n);return gc(s,o,r)}}On.defaultStyleProps={curvePosition:.5,curveOffset:30};var kc=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};function Le(i){return i instanceof ft&&i.type==="node"}function ir(i){return i instanceof $t}function Us(i){return i instanceof fe}function Bc(i){return Le(i)||ir(i)||Us(i)}function jc(i,t){return!i||!t?!1:i===t}const zc={top:[.5,0],right:[1,.5],bottom:[.5,1],left:[0,.5],"left-top":[0,0],"top-left":[0,0],"left-bottom":[0,1],"bottom-left":[0,1],"right-top":[1,0],"top-right":[1,0],"right-bottom":[1,1],"bottom-right":[1,1],default:[.5,.5]};function Ys(i,t,e=zc,n=!0){const s=[.5,.5],o=le(t)?tt(e,t.toLocaleLowerCase(),s):t;if(!n&&le(t))return o;const[r,a]=o||s;return[i.min[0]+vt(i)*r,i.min[1]+bt(i)*a]}function Ks(i){if(!i)return{};const t=i.getPorts();return(i.attributes.ports||[]).forEach((n,s)=>{var o;const{key:r,placement:a}=n;or(n)&&(t[o=r||s]||(t[o]=xt(i.getShape("key").getBounds(),a)))}),t}function or(i){const{r:t}=i;return!t||Number(t)===0}function Bt(i){return de(i)?i:i.getPosition()}function Fc(i,t,e,n){const s=Oi(i,t,e,n),o=Oi(t,i,n,e);return[s,o]}function Oi(i,t,e,n){const s=Ks(i);if(e)return s[e];const o=Object.values(s);if(o.length===0)return;const r=o.map(l=>Bt(l)),a=$c(t,n),[c]=Ma(r,a);return o.find(l=>Bt(l)===c)}function $c(i,t){const e=Ks(i);if(t)return[Bt(e[t])];const n=Object.values(e);return n.length>0?n.map(s=>Bt(s)):[i.getCenter()]}function Di(i,t){return Us(i)||Le(i)?Ts(i,t):Ce(i,t)}function Ce(i,t){if(!i||!t)return[0,0,0];if(de(i))return i;if(i.attributes.linkToCenter)return i.getPosition();const e=de(t)?t:Le(t)?t.getCenter():t.getPosition();return hn(e,i.getBounds())}function Ts(i,t){if(!i||!t)return[0,0,0];const e=de(t)?t:Le(t)?t.getCenter():t.getPosition();return i.getIntersectPoint(e)||i.getCenter()}function wi(i,t="bottom",e=0,n=0,s=!1){const o=t.split("-"),[r,a]=xt(i,t),[c,l]=s?["bottom","top"]:["top","bottom"],d=o.includes("top")?l:o.includes("bottom")?c:"middle",h=o.includes("left")?"right":o.includes("right")?"left":"center";return{transform:[["translate",r+e,a+n]],textBaseline:d,textAlign:h}}function Wc(i,t){return[[0,-i],[t*Math.cos(3*Math.PI/10),-t*Math.sin(3*Math.PI/10)],[i*Math.cos(Math.PI/10),-i*Math.sin(Math.PI/10)],[t*Math.cos(Math.PI/10),t*Math.sin(Math.PI/10)],[i*Math.cos(3*Math.PI/10),i*Math.sin(3*Math.PI/10)],[0,t],[-i*Math.cos(3*Math.PI/10),i*Math.sin(3*Math.PI/10)],[-t*Math.cos(Math.PI/10),t*Math.sin(Math.PI/10)],[-i*Math.cos(Math.PI/10),-i*Math.sin(Math.PI/10)],[-t*Math.cos(3*Math.PI/10),-t*Math.sin(3*Math.PI/10)]]}function Vc(i,t){const e={};return e.top=[0,-i],e.left=[-i*Math.cos(Math.PI/10),-i*Math.sin(Math.PI/10)],e["left-bottom"]=[-i*Math.cos(3*Math.PI/10),i*Math.sin(3*Math.PI/10)],e.bottom=[0,t],e["right-bottom"]=[i*Math.cos(3*Math.PI/10),i*Math.sin(3*Math.PI/10)],e.right=e.default=[i*Math.cos(Math.PI/10),-i*Math.sin(Math.PI/10)],e}function Hc(i,t,e){const n=t/2,s=i/2,o={up:[[-s,n],[s,n],[0,-n]],left:[[-s,0],[s,n],[s,-n]],right:[[-s,n],[-s,-n],[s,0]],down:[[-s,-n],[s,-n],[0,n]]};return o[e]||o.up}function Uc(i,t,e){const n=t/2,s=i/2,o={};return e==="down"?(o.bottom=o.default=[0,n],o.right=[s,-n],o.left=[-s,-n]):e==="left"?(o.top=[s,-n],o.bottom=[s,n],o.left=o.default=[-s,0]):e==="right"?(o.top=[-s,-n],o.bottom=[-s,n],o.right=o.default=[s,0]):(o.left=[-s,n],o.top=o.default=[0,-n],o.right=[s,n]),o}function Yc(i,t){return[[0,-t/2],[i/2,0],[0,t/2],[-i/2,0]]}function Kc(i){return tt(i,["style","visibility"])!=="hidden"}function Xc(i,t){const{zIndex:e,transform:n,transformOrigin:s,visibility:o,cursor:r,clipPath:a,component:c}=t,l=kc(t,["zIndex","transform","transformOrigin","visibility","cursor","clipPath","component"]);Object.assign(i.attributes,l),n&&i.setAttribute("transform",n),U(e)&&i.setAttribute("zIndex",e),s&&i.setAttribute("transformOrigin",s),o&&i.setAttribute("visibility",o),r&&i.setAttribute("cursor",r),a&&i.setAttribute("clipPath",a),c&&i.setAttribute("component",c)}function As(i,t){"update"in i?i.update(t):i.attr(t)}function Gc(i){return[[0,i],[i*Math.sqrt(3)/2,i/2],[i*Math.sqrt(3)/2,-i/2],[0,-i],[-i*Math.sqrt(3)/2,-i/2],[-i*Math.sqrt(3)/2,i/2]]}function Zc(i){Qe(i,"__to_be_destroyed__",!0)}function Dn(i){return tt(i,"__to_be_destroyed__",!1)}var qc=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class wn extends st{constructor(t,e){super(t,Object.assign({},wn.defaultOptions,e)),this.onCollapseExpand=n=>qc(this,void 0,void 0,function*(){if(!this.validate(n))return;const{target:s}=n;if(!Bc(s))return;const o=s.id,{model:r,graph:a}=this.context,c=r.getElementDataById(o);if(!c)return!1;const{onCollapse:l,onExpand:d,animation:h,align:u}=this.options;Q(c)?(yield a.expandElement(o,{animation:h,align:u}),d==null||d(o)):(yield a.collapseElement(o,{animation:h,align:u}),l==null||l(o))}),this.bindEvents()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.on(`node:${e}`,this.onCollapseExpand),t.on(`combo:${e}`,this.onCollapseExpand)}unbindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.off(`node:${e}`,this.onCollapseExpand),t.off(`combo:${e}`,this.onCollapseExpand)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}}wn.defaultOptions={enable:!0,animation:!0,trigger:x.DBLCLICK,align:!0};var We=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};const Qc="g6-create-edge-assist-edge-id",Ve="g6-create-edge-assist-node-id";class Cn extends st{constructor(t,e){super(t,Object.assign({},Cn.defaultOptions,e)),this.drop=n=>We(this,void 0,void 0,function*(){const{targetType:s}=n;["combo","node"].includes(s)&&this.source?yield this.handleCreateEdge(n):yield this.cancelEdge()}),this.handleCreateEdge=n=>We(this,void 0,void 0,function*(){var s,o,r;if(!this.validate(n))return;const{graph:a,canvas:c,batch:l,element:d}=this.context,{style:h}=this.options;if(this.source){this.createEdge(n),yield this.cancelEdge();return}l.startBatch(),c.setCursor("crosshair"),this.source=this.getSelectedNodeIDs([n.target.id])[0];const u=a.getElementData(this.source);a.addNodeData([{id:Ve,style:{visibility:"hidden",ports:[{key:"port-1",placement:[.5,.5]}],x:(s=u.style)===null||s===void 0?void 0:s.x,y:(o=u.style)===null||o===void 0?void 0:o.y}}]),a.addEdgeData([{id:Qc,source:this.source,target:Ve,style:Object.assign({pointerEvents:"none"},h)}]),yield(r=d.draw({animation:!1}))===null||r===void 0?void 0:r.finished}),this.updateAssistEdge=n=>We(this,void 0,void 0,function*(){var s;if(!this.source)return;const{model:o,element:r}=this.context;o.translateNodeTo(Ve,[n.canvas.x,n.canvas.y]),yield(s=r.draw({animation:!1,silence:!0}))===null||s===void 0?void 0:s.finished}),this.createEdge=n=>{var s,o;const{graph:r}=this.context,{style:a,onFinish:c,onCreate:l}=this.options;if(((s=n.target)===null||s===void 0?void 0:s.id)===void 0||this.source===void 0)return;const h=(o=this.getSelectedNodeIDs([n.target.id]))===null||o===void 0?void 0:o[0],u=`${this.source}-${h}-${Er()}`,f=l({id:u,source:this.source,target:h,style:a});r.addEdgeData([f]),c(f)},this.cancelEdge=()=>We(this,void 0,void 0,function*(){var n;if(!this.source)return;const{graph:s,element:o,batch:r}=this.context;s.removeNodeData([Ve]),this.source=void 0,yield(n=o.draw({animation:!1}))===null||n===void 0?void 0:n.finished,r.endBatch()}),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;this.unbindEvents(),e==="click"?(t.on(rt.CLICK,this.handleCreateEdge),t.on(Ht.CLICK,this.handleCreateEdge),t.on(Dt.CLICK,this.cancelEdge),t.on(Je.CLICK,this.cancelEdge)):(t.on(rt.DRAG_START,this.handleCreateEdge),t.on(Ht.DRAG_START,this.handleCreateEdge),t.on(x.POINTER_UP,this.drop)),t.on(x.POINTER_MOVE,this.updateAssistEdge)}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map(e=>e.id).concat(t)))}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;t.off(rt.CLICK,this.handleCreateEdge),t.off(Ht.CLICK,this.handleCreateEdge),t.off(Dt.CLICK,this.cancelEdge),t.off(Je.CLICK,this.cancelEdge),t.off(rt.DRAG_START,this.handleCreateEdge),t.off(Ht.DRAG_START,this.handleCreateEdge),t.off(x.POINTER_UP,this.drop),t.off(x.POINTER_MOVE,this.updateAssistEdge)}destroy(){this.unbindEvents(),super.destroy()}}Cn.defaultOptions={animation:!0,enable:!0,style:{},trigger:"drag",onCreate:i=>i,onFinish:()=>{}};var Ci=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class _n extends st{constructor(t,e){super(t,Object.assign({},_n.defaultOptions,e)),this.isDragging=!1,this.onDragStart=n=>{this.validate(n)&&(this.isDragging=!0,this.context.canvas.setCursor("grabbing"))},this.onDrag=n=>{var s,o,r,a;if(!this.isDragging||j.isPinching)return;const c=(o=(s=n.movement)===null||s===void 0?void 0:s.x)!==null&&o!==void 0?o:n.dx,l=(a=(r=n.movement)===null||r===void 0?void 0:r.y)!==null&&a!==void 0?a:n.dy;(c|l)!==0&&this.translate([c,l],!1)},this.onDragEnd=()=>{var n,s;this.isDragging=!1,this.context.canvas.setCursor(this.defaultCursor),(s=(n=this.options).onFinish)===null||s===void 0||s.call(n)},this.invokeOnFinish=cn(()=>{var n,s;(s=(n=this.options).onFinish)===null||s===void 0||s.call(n)},300),this.shortcut=new he(t.graph),this.bindEvents(),this.defaultCursor=this.context.canvas.getConfig().cursor||"default"}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){const{trigger:t}=this.options;if(at(t)){const{up:e=[],down:n=[],left:s=[],right:o=[]}=t;this.shortcut.bind(e,r=>this.onTranslate([0,1],r)),this.shortcut.bind(n,r=>this.onTranslate([0,-1],r)),this.shortcut.bind(s,r=>this.onTranslate([1,0],r)),this.shortcut.bind(o,r=>this.onTranslate([-1,0],r))}else{const{graph:e}=this.context;e.on(x.DRAG_START,this.onDragStart),e.on(x.DRAG,this.onDrag),e.on(x.DRAG_END,this.onDragEnd)}}onTranslate(t,e){return Ci(this,void 0,void 0,function*(){if(!this.validate(e))return;const{sensitivity:n}=this.options,s=n*-1;yield this.translate(lt(t,s),this.options.animation),this.invokeOnFinish()})}translate(t,e){return Ci(this,void 0,void 0,function*(){t=this.clampByDirection(t),t=this.clampByRange(t),yield this.context.graph.translateBy(t,e)})}clampByDirection([t,e]){const{direction:n}=this.options;return n==="x"?e=0:n==="y"&&(t=0),[t,e]}clampByRange([t,e]){const{viewport:n,canvas:s}=this.context,[o,r]=s.getSize(),[a,c,l,d]=mt(this.options.range),h=[r*a,o*c,r*l,o*d],u=zt(Is(n.getCanvasCenter()),h),f=P(n.getViewportCenter(),[t,e,0]);if(!ht(f,u)){const{min:[g,p],max:[y,m]}=u;(f[0]<g&&t>0||f[0]>y&&t<0)&&(t=0),(f[1]<p&&e>0||f[1]>m&&e<0)&&(e=0)}return[t,e]}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return typeof e=="function"?e(t):!!e}unbindEvents(){this.shortcut.unbindAll();const{graph:t}=this.context;t.off(x.DRAG_START,this.onDragStart),t.off(x.DRAG,this.onDrag),t.off(x.DRAG_END,this.onDragEnd)}destroy(){this.shortcut.destroy(),this.unbindEvents(),this.context.canvas.setCursor(this.defaultCursor),super.destroy()}}_n.defaultOptions={enable:i=>"targetType"in i?i.targetType==="canvas":!0,sensitivity:10,direction:"both",range:1/0};var _i=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class Ne extends st{constructor(t,e){super(t,Object.assign({},Ne.defaultOptions,e)),this.enable=!1,this.enableElements=["node","combo"],this.target=[],this.shadowOrigin=[0,0],this.hiddenEdges=[],this.isDragging=!1,this.onDrop=n=>_i(this,void 0,void 0,function*(){var s;if(this.options.dropEffect!=="link")return;const{model:o,element:r}=this.context,a=n.target.id;this.target.forEach(c=>{const l=o.getParentData(c,R);l&&v(l)===a&&o.refreshComboData(a),o.setParent(c,a,R)}),yield(s=r==null?void 0:r.draw({animation:!0}))===null||s===void 0?void 0:s.finished}),this.setCursor=n=>{if(this.isDragging)return;const{type:s}=n,{canvas:o}=this.context,{cursor:r}=this.options;s===x.POINTER_ENTER?o.setCursor((r==null?void 0:r.grab)||"grab"):o.setCursor((r==null?void 0:r.default)||"default")},this.onDragStart=this.onDragStart.bind(this),this.onDrag=this.onDrag.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onDrop=this.onDrop.bind(this),this.bindEvents()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){const{graph:t,canvas:e}=this.context,n=e.getLayer().getContextService().$canvas;n&&(n.addEventListener("blur",this.onDragEnd),n.addEventListener("contextmenu",this.onDragEnd)),this.enableElements.forEach(s=>{t.on(`${s}:${x.DRAG_START}`,this.onDragStart),t.on(`${s}:${x.DRAG}`,this.onDrag),t.on(`${s}:${x.DRAG_END}`,this.onDragEnd),t.on(`${s}:${x.POINTER_ENTER}`,this.setCursor),t.on(`${s}:${x.POINTER_LEAVE}`,this.setCursor)}),["link"].includes(this.options.dropEffect)&&(t.on(Ht.DROP,this.onDrop),t.on(Dt.DROP,this.onDrop))}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map(e=>e.id).concat(t)))}getDelta(t){const e=this.context.graph.getZoom();return ut([t.dx,t.dy],e)}onDragStart(t){var e;if(this.enable=this.validate(t),!this.enable)return;const{batch:n,canvas:s,graph:o}=this.context;s.setCursor(((e=this.options.cursor)===null||e===void 0?void 0:e.grabbing)||"grabbing"),this.isDragging=!0,n.startBatch();const r=t.target.id;o.getElementState(r).includes(this.options.state)?this.target=this.getSelectedNodeIDs([r]):this.target=[r],this.hideEdge(),this.context.graph.frontElement(this.target),this.options.shadow&&this.createShadow(this.target)}onDrag(t){if(!this.enable)return;const e=this.getDelta(t);this.options.shadow?this.moveShadow(e):this.moveElement(this.target,e)}onDragEnd(){var t,e,n;if(this.enable=!1,this.options.shadow){if(!this.shadow)return;this.shadow.style.visibility="hidden";const{x:r=0,y:a=0}=this.shadow.attributes,[c,l]=P([+r,+a],this.shadowOrigin);this.moveElement(this.target,[c,l])}this.showEdges(),(e=(t=this.options).onFinish)===null||e===void 0||e.call(t,this.target);const{batch:s,canvas:o}=this.context;s.endBatch(),o.setCursor(((n=this.options.cursor)===null||n===void 0?void 0:n.grab)||"grab"),this.isDragging=!1,this.target=[]}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}moveElement(t,e){return _i(this,void 0,void 0,function*(){const{graph:n,model:s}=this.context,{dropEffect:o}=this.options;o==="move"&&t.forEach(r=>s.refreshComboData(r)),n.translateElementBy(Object.fromEntries(t.map(r=>[r,e])),!1)})}moveShadow(t){if(!this.shadow)return;const{x:e=0,y:n=0}=this.shadow.attributes,[s,o]=t;this.shadow.attr({x:+e+s,y:+n+o})}createShadow(t){const e=F(this.options,"shadow"),n=Ae(t.map(l=>this.context.element.getElement(l).getBounds())),[s,o]=n.min;this.shadowOrigin=[s,o];const[r,a]=jt(n),c={width:r,height:a,x:s,y:o};this.shadow?this.shadow.attr(Object.assign(Object.assign(Object.assign({},e),c),{visibility:"visible"})):(this.shadow=new _t({style:Object.assign(Object.assign(Object.assign({$layer:"transient"},e),c),{pointerEvents:"none"})}),this.context.canvas.appendChild(this.shadow))}showEdges(){this.options.shadow||this.hiddenEdges.length===0||(this.context.graph.showElement(this.hiddenEdges),this.hiddenEdges=[])}hideEdge(){const{hideEdge:t,shadow:e}=this.options;if(t==="none"||e)return;const{graph:n}=this.context;t==="all"?this.hiddenEdges=n.getEdgeData().map(v):this.hiddenEdges=Array.from(new Set(this.target.map(s=>n.getRelatedEdgesData(s,t).map(v)).flat())),n.hideElement(this.hiddenEdges)}unbindEvents(){const{graph:t,canvas:e}=this.context,n=e.getLayer().getContextService().$canvas;n&&(n.removeEventListener("blur",this.onDragEnd),n.removeEventListener("contextmenu",this.onDragEnd)),this.enableElements.forEach(s=>{t.off(`${s}:${x.DRAG_START}`,this.onDragStart),t.off(`${s}:${x.DRAG}`,this.onDrag),t.off(`${s}:${x.DRAG_END}`,this.onDragEnd),t.off(`${s}:${x.POINTER_ENTER}`,this.setCursor),t.off(`${s}:${x.POINTER_LEAVE}`,this.setCursor)}),t.off(`combo:${x.DROP}`,this.onDrop),t.off(`canvas:${x.DROP}`,this.onDrop)}destroy(){var t;this.unbindEvents(),(t=this.shadow)===null||t===void 0||t.destroy(),super.destroy()}}Ne.defaultOptions={animation:!0,enable:i=>["node","combo"].includes(i.targetType),dropEffect:"move",state:"selected",hideEdge:"none",shadow:!1,shadowZIndex:100,shadowFill:"#F3F9FF",shadowFillOpacity:.5,shadowStroke:"#1890FF",shadowStrokeOpacity:.9,shadowLineDash:[5,5],cursor:{default:"default",grab:"grab",grabbing:"grabbing"}};class Tn{constructor(t,e){this.context=t,this.options=e||{}}}var Jc=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})},tl=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};function el(i){const{type:t}=i;return["compact-box","mindmap","dendrogram","indented"].includes(t)}function nl(i){return!Array.isArray(i)&&(i==null?void 0:i.preLayout)}function Ke(i){const{nodes:t,edges:e}=i,n={nodes:[],edges:[],combos:[]};return t.forEach(s=>{const o=s.data._isCombo?n.combos:n.nodes,{x:r,y:a,z:c=0}=s.data;o==null||o.push({id:s.id,style:{x:r,y:a,z:c}})}),e.forEach(s=>{const{id:o,source:r,target:a,data:{points:c=[],controlPoints:l=c.slice(1,c.length-1)}}=s;n.edges.push({id:o,source:r,target:a,style:Object.assign({},l!=null&&l.length?{controlPoints:l.map(K)}:{})})}),n}function sl(i,t){class e extends Tn{constructor(s,o){if(super(s,o),this.instance=new i({}),this.id=this.instance.id,"stop"in this.instance&&"tick"in this.instance){const r=this.instance;this.stop=r.stop.bind(r),this.tick=a=>{const c=r.tick(a);return Ke(c)}}}execute(s,o){return Jc(this,void 0,void 0,function*(){return Ke(yield this.instance.execute(this.graphData2LayoutModel(s),this.transformOptions(Gt({},this.options,o))))})}transformOptions(s){const{onTick:o}=s;return o&&(s.onTick=r=>o(Ke(r))),s}graphData2LayoutModel(s){const{nodes:o=[],edges:r=[],combos:a=[]}=s,c=o.map(f=>{const g=v(f),{data:p,style:y,combo:m}=f,E=tl(f,["data","style","combo"]),b={id:g,data:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},p),{data:p}),m?{parentId:m}:{}),{style:y}),E)};return y!=null&&y.x&&Object.assign(b.data,{x:y.x}),y!=null&&y.y&&Object.assign(b.data,{y:y.y}),y!=null&&y.z&&Object.assign(b.data,{z:y.z}),b}),l=new Map(c.map(f=>[f.id,f])),d=r.filter(f=>{const{source:g,target:p}=f;return l.has(g)&&l.has(p)}).map(f=>{const{source:g,target:p,data:y,style:m}=f;return{id:v(f),source:g,target:p,data:Object.assign({},y),style:Object.assign({},m)}}),h=a.map(f=>({id:v(f),data:Object.assign({_isCombo:!0},f.data),style:Object.assign({},f.style)})),u=new Ls({nodes:[...c,...h],edges:d});return t.model.model.hasTreeStructure(R)&&(u.attachTreeStructure(R),c.forEach(f=>{const g=t.model.model.getParent(f.id,R);g&&u.hasNode(g.id)&&u.setParent(f.id,g.id,R)})),u}}return e}function hs(i,t,...e){if(t in i)return i[t](...e);if("instance"in i){const n=i.instance;if(t in n)return n[t](...e)}return null}function Ti(i,t){if(t in i)return i[t];if("instance"in i){const e=i.instance;if(t in e)return e[t]}return null}var il=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class ol extends Ne{get forceLayoutInstance(){return this.context.layout.getLayoutInstance().find(t=>["d3-force","d3-force-3d"].includes(t==null?void 0:t.id))}validate(t){return this.context.layout?this.forceLayoutInstance?super.validate(t):(yt.warn("DragElementForce only works with d3-force or d3-force-3d layout"),!1):!1}moveElement(t,e){return il(this,void 0,void 0,function*(){const n=this.forceLayoutInstance;this.context.graph.getNodeData(t).forEach((s,o)=>{const{x:r=0,y:a=0}=s.style||{};n&&hs(n,"setFixedPosition",t[o],[...T([+r,+a],e)])})})}onDragStart(t){if(this.enable=this.validate(t),!this.enable)return;this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target);const e=this.forceLayoutInstance;e&&Ti(e,"simulation").alphaTarget(.3).restart(),this.context.graph.getNodeData(this.target).forEach(n=>{const{x:s=0,y:o=0}=n.style||{};e&&hs(e,"setFixedPosition",v(n),[+s,+o])})}onDrag(t){if(!this.enable)return;const e=this.getDelta(t);this.moveElement(this.target,e)}onDragEnd(){const t=this.forceLayoutInstance;t&&Ti(t,"simulation").alphaTarget(0),!this.options.fixed&&this.context.graph.getNodeData(this.target).forEach(e=>{t&&hs(t,"setFixedPosition",v(e),[null,null,null])})}}var Ai=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class An extends st{constructor(t,e){super(t,Object.assign({},An.defaultOptions,e)),this.isZoomEvent=n=>!!(n.data&&"scale"in n.data),this.relatedEdgeToUpdate=new Set,this.zoom=this.context.graph.getZoom(),this.fixElementSize=n=>Ai(this,void 0,void 0,function*(){if(!this.validate(n))return;const{graph:s}=this.context,{state:o,nodeFilter:r,edgeFilter:a,comboFilter:c}=this.options,l=(o?s.getElementDataByState("node",o):s.getNodeData()).filter(r),d=(o?s.getElementDataByState("edge",o):s.getEdgeData()).filter(a),h=(o?s.getElementDataByState("combo",o):s.getComboData()).filter(c),u=this.isZoomEvent(n)?this.zoom=Math.max(.01,Math.min(n.data.scale,10)):this.zoom,f=[...l,...h];f.length>0&&f.forEach(g=>this.fixNodeLike(g,u)),this.updateRelatedEdges(),d.length>0&&d.forEach(g=>this.fixEdge(g,u))}),this.cachedStyles=new Map,this.getOriginalFieldValue=(n,s,o)=>{var r;const a=this.cachedStyles.get(n)||[],c=((r=a.find(l=>l.shape===s))===null||r===void 0?void 0:r.style)||{};return o in c||(c[o]=s.attributes[o],this.cachedStyles.set(n,[...a.filter(l=>l.shape!==s),{shape:s,style:c}])),c[o]},this.scaleEntireElement=(n,s,o)=>{s.setLocalScale(1/o);const r=this.cachedStyles.get(n)||[];r.push({shape:s}),this.cachedStyles.set(n,r)},this.scaleSpecificShapes=(n,s,o)=>{const r=Xa(n);(Array.isArray(o)?o:[o]).forEach(c=>{const{shape:l,fields:d}=c,h=typeof l=="function"?l(r):n.getShape(l);if(h){if(!d){this.scaleEntireElement(n.id,h,s);return}d.forEach(u=>{const f=this.getOriginalFieldValue(n.id,h,u);U(f)&&(h.style[u]=f/s)})}})},this.skipIfExceedViewport=n=>{const{viewport:s}=this.context;return!(s!=null&&s.isInViewport(n.getRenderBounds(),!1,30))},this.fixNodeLike=(n,s)=>{const o=v(n),{element:r,model:a}=this.context,c=r.getElement(o);if(!c||this.skipIfExceedViewport(c))return;a.getRelatedEdgesData(o).forEach(h=>this.relatedEdgeToUpdate.add(v(h)));const d=this.options[c.type];if(!d){this.scaleEntireElement(o,c,s);return}this.scaleSpecificShapes(c,s,d)},this.fixEdge=(n,s)=>{const o=v(n),r=this.context.element.getElement(o);if(!r||this.skipIfExceedViewport(r))return;const a=this.options.edge;if(!a){r.style.transformOrigin="center",this.scaleEntireElement(o,r,s);return}this.scaleSpecificShapes(r,s,a)},this.updateRelatedEdges=()=>{const{element:n}=this.context;this.relatedEdgeToUpdate.size>0&&this.relatedEdgeToUpdate.forEach(s=>{const o=n.getElement(s);o==null||o.update({})}),this.relatedEdgeToUpdate.clear()},this.resetTransform=n=>Ai(this,void 0,void 0,function*(){var s;!((s=n.data)===null||s===void 0)&&s.firstRender||(this.options.reset?this.restoreCachedStyles():this.fixElementSize({data:{scale:this.zoom}}))}),this.bindEvents()}restoreCachedStyles(){if(this.cachedStyles.size>0){this.cachedStyles.forEach(s=>{s.forEach(({shape:o,style:r})=>{if(gt(r))o.setLocalScale(1);else{if(this.options.state)return;Object.entries(r).forEach(([a,c])=>o.style[a]=c)}})});const{graph:t,element:e}=this.context,n=Object.keys(Object.fromEntries(this.cachedStyles)).filter(s=>s&&t.getElementType(s)==="node");if(n.length>0){const s=new Set;n.forEach(o=>{t.getRelatedEdgesData(o).forEach(r=>s.add(v(r)))}),s.forEach(o=>{const r=e==null?void 0:e.getElement(o);r==null||r.update({})})}}}bindEvents(){const{graph:t}=this.context;t.on(O.AFTER_DRAW,this.resetTransform),t.on(O.AFTER_TRANSFORM,this.fixElementSize)}unbindEvents(){const{graph:t}=this.context;t.off(O.AFTER_DRAW,this.resetTransform),t.off(O.AFTER_TRANSFORM,this.fixElementSize)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}}An.defaultOptions={enable:i=>i.data.scale<1,nodeFilter:()=>!0,edgeFilter:()=>!0,comboFilter:()=>!0,edge:[{shape:"key",fields:["lineWidth"]},{shape:"halo",fields:["lineWidth"]},{shape:"label"}],reset:!1};var rl=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class Mn extends st{constructor(t,e){super(t,Object.assign({},Mn.defaultOptions,e)),this.focus=n=>rl(this,void 0,void 0,function*(){if(!this.validate(n))return;const{graph:s}=this.context;yield s.focusElement(n.target.id,this.options.animation)}),this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),Qt.forEach(e=>{t.on(`${e}:${x.CLICK}`,this.focus)})}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;Qt.forEach(e=>{t.off(`${e}:${x.CLICK}`,this.focus)})}destroy(){this.unbindEvents(),super.destroy()}}Mn.defaultOptions={animation:{easing:"ease-in",duration:500},enable:!0};class Pn extends st{constructor(t,e){super(t,Object.assign({},Pn.defaultOptions,e)),this.isFrozen=!1,this.toggleFrozen=n=>{this.isFrozen=n.type==="dragstart"},this.hoverElement=n=>{if(!this.validate(n))return;const s=n.type===x.POINTER_ENTER;this.updateElementsState(n,s);const{onHover:o,onHoverEnd:r}=this.options;s?o==null||o(n):r==null||r(n)},this.updateElementsState=(n,s)=>{if(!this.options.state&&!this.options.inactiveState)return;const{graph:o}=this.context,{state:r,animation:a,inactiveState:c}=this.options,l=this.getActiveIds(n),d={};if(r&&Object.assign(d,this.getElementsState(l,r,s)),c){const h=Po(o.getData(),!0).filter(u=>!l.includes(u));Object.assign(d,this.getElementsState(h,c,s))}o.setElementState(d,a)},this.getElementsState=(n,s,o)=>{const{graph:r}=this.context,a={};return n.forEach(c=>{const l=r.getElementState(c);o?a[c]=l.includes(s)?l:[...l,s]:a[c]=l.filter(d=>d!==s)}),a},this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),Qt.forEach(n=>{t.on(`${n}:${x.POINTER_ENTER}`,this.hoverElement),t.on(`${n}:${x.POINTER_LEAVE}`,this.hoverElement)});const e=this.context.canvas.document;e.addEventListener(`${x.DRAG_START}`,this.toggleFrozen),e.addEventListener(`${x.DRAG_END}`,this.toggleFrozen)}getActiveIds(t){const{graph:e}=this.context,{degree:n,direction:s}=this.options,o=t.target.id;return n?Wo(e,t.targetType,o,typeof n=="function"?n(t):n,s):[o]}validate(t){if(this.destroyed||this.isFrozen||Dn(t.target)||this.context.graph.isCollapsingExpanding)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;Qt.forEach(n=>{t.off(`${n}:${x.POINTER_ENTER}`,this.hoverElement),t.off(`${n}:${x.POINTER_LEAVE}`,this.hoverElement)});const e=this.context.canvas.document;e.removeEventListener(`${x.DRAG_START}`,this.toggleFrozen),e.removeEventListener(`${x.DRAG_END}`,this.toggleFrozen)}destroy(){this.unbindEvents(),super.destroy()}}Pn.defaultOptions={animation:!1,enable:!0,degree:0,direction:"both",state:"active",inactiveState:void 0};class al extends Me{onPointerDown(t){if(!super.validate(t)||!super.isKeydown()||this.points)return;const{canvas:e}=this.context;this.pathShape=new Rt({id:"g6-lasso-select",style:this.options.style}),e.appendChild(this.pathShape),this.points=[nn(t)]}onPointerMove(t){var e;if(!this.points)return;const{immediately:n,mode:s}=this.options;this.points.push(nn(t)),(e=this.pathShape)===null||e===void 0||e.setAttribute("d",Va(this.points)),n&&s==="default"&&this.points.length>2&&super.updateElementsStates(this.points)}onPointerUp(){if(this.points){if(this.points.length<2){this.clearLasso();return}super.updateElementsStates(this.points),this.clearLasso()}}clearLasso(){var t;(t=this.pathShape)===null||t===void 0||t.remove(),this.pathShape=void 0,this.points=void 0}}class Rn extends st{constructor(t,e){super(t,Object.assign({},Rn.defaultOptions,e)),this.hiddenShapes=[],this.isVisible=!0,this.setElementsVisibility=(n,s,o)=>{n.filter(Boolean).forEach(r=>{s==="hidden"&&!r.isVisible()?this.hiddenShapes.push(r):s==="visible"&&this.hiddenShapes.includes(r)?this.hiddenShapes.splice(this.hiddenShapes.indexOf(r),1):Zt(r,s,o)})},this.filterShapes=(n,s)=>{if(A(s))return r=>!s(n,r);const o=s==null?void 0:s[n];return r=>r.className?!(o!=null&&o.includes(r.className)):!0},this.hideShapes=n=>{if(!this.validate(n)||!this.isVisible)return;const{element:s}=this.context,{shapes:o={}}=this.options;this.setElementsVisibility(s.getNodes(),"hidden",this.filterShapes("node",o)),this.setElementsVisibility(s.getEdges(),"hidden",this.filterShapes("edge",o)),this.setElementsVisibility(s.getCombos(),"hidden",this.filterShapes("combo",o)),this.isVisible=!1},this.showShapes=cn(n=>{if(!this.validate(n)||this.isVisible)return;const{element:s}=this.context;this.setElementsVisibility(s.getNodes(),"visible"),this.setElementsVisibility(s.getEdges(),"visible"),this.setElementsVisibility(s.getCombos(),"visible"),this.isVisible=!0},this.options.debounce),this.bindEvents()}bindEvents(){const{graph:t}=this.context;t.on(O.BEFORE_TRANSFORM,this.hideShapes),t.on(O.AFTER_TRANSFORM,this.showShapes)}unbindEvents(){const{graph:t}=this.context;t.off(O.BEFORE_TRANSFORM,this.hideShapes),t.off(O.AFTER_TRANSFORM,this.showShapes)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy()}}Rn.defaultOptions={enable:!0,debounce:200,shapes:i=>i==="node"};var Mi=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class Ln extends st{constructor(t,e){super(t,Object.assign({},Ln.defaultOptions,e)),this.onWheel=n=>Mi(this,void 0,void 0,function*(){this.options.preventDefault&&n.preventDefault();const s=n.deltaX,o=n.deltaY;yield this.scroll([-s,-o],n)}),this.shortcut=new he(t.graph),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){var t,e;const{trigger:n}=this.options;if(this.shortcut.unbindAll(),at(n)){(t=this.graphDom)===null||t===void 0||t.removeEventListener(x.WHEEL,this.onWheel);const{up:s=[],down:o=[],left:r=[],right:a=[]}=n;this.shortcut.bind(s,c=>this.scroll([0,-10],c)),this.shortcut.bind(o,c=>this.scroll([0,10],c)),this.shortcut.bind(r,c=>this.scroll([-10,0],c)),this.shortcut.bind(a,c=>this.scroll([10,0],c))}else(e=this.graphDom)===null||e===void 0||e.addEventListener(x.WHEEL,this.onWheel,{passive:!1})}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}formatDisplacement(t){const{sensitivity:e}=this.options;return t=lt(t,e),t=this.clampByDirection(t),t=this.clampByRange(t),t}clampByDirection([t,e]){const{direction:n}=this.options;return n==="x"?e=0:n==="y"&&(t=0),[t,e]}clampByRange([t,e]){const{viewport:n,canvas:s}=this.context,[o,r]=s.getSize(),[a,c,l,d]=mt(this.options.range),h=[r*a,o*c,r*l,o*d],u=zt(Is(n.getCanvasCenter()),h),f=P(n.getViewportCenter(),[t,e,0]);if(!ht(f,u)){const{min:[g,p],max:[y,m]}=u;(f[0]<g&&t>0||f[0]>y&&t<0)&&(t=0),(f[1]<p&&e>0||f[1]>m&&e<0)&&(e=0)}return[t,e]}scroll(t,e){return Mi(this,void 0,void 0,function*(){if(!this.validate(e))return;const{onFinish:n}=this.options,s=this.context.graph,o=this.formatDisplacement(t);yield s.translateBy(o,!1),n==null||n()})}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),(t=this.graphDom)===null||t===void 0||t.removeEventListener(x.WHEEL,this.onWheel),super.destroy()}}Ln.defaultOptions={enable:!0,sensitivity:1,preventDefault:!0,range:1/0};var Pi=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class Nn extends st{constructor(t,e){super(t,Object.assign({},Nn.defaultOptions,e)),this.zoom=(n,s,o)=>Pi(this,void 0,void 0,function*(){if(!this.validate(s))return;const{graph:r}=this.context;let a;"viewport"in s&&(a=K(s.viewport));const{sensitivity:c,onFinish:l}=this.options,d=1+bo(n,-50,50)*c/100,h=r.getZoom();yield r.zoomTo(h*d,o,a),l==null||l()}),this.onReset=()=>Pi(this,void 0,void 0,function*(){yield this.context.graph.zoomTo(1,this.options.animation)}),this.preventDefault=n=>{this.options.preventDefault&&n.preventDefault()},this.shortcut=new he(t.graph),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){const{trigger:t}=this.options;if(this.shortcut.unbindAll(),Array.isArray(t))if(t.includes(x.PINCH))this.shortcut.bind([x.PINCH],e=>{this.zoom(e.scale,e,!1)});else{const e=this.context.canvas.getContainer();e==null||e.addEventListener(x.WHEEL,this.preventDefault),this.shortcut.bind([...t,x.WHEEL],n=>{const{deltaX:s,deltaY:o}=n;this.zoom(-(o??s),n,!1)})}if(typeof t=="object"){const{zoomIn:e=[],zoomOut:n=[],reset:s=[]}=t;this.shortcut.bind(e,o=>this.zoom(10,o,this.options.animation)),this.shortcut.bind(n,o=>this.zoom(-10,o,this.options.animation)),this.shortcut.bind(s,this.onReset)}}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return A(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),(t=this.context.canvas.getContainer())===null||t===void 0||t.removeEventListener(x.WHEEL,this.preventDefault),super.destroy()}}Nn.defaultOptions={animation:{duration:200},enable:!0,sensitivity:1,trigger:[],preventDefault:!0};var cl=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class In extends Tn{constructor(){super(...arguments),this.id="fishbone"}getRoot(){const t=this.context.model.getRootsData();if(!(gt(t)||t.length>2))return t[0]}formatSize(t){const e=typeof t=="function"?t:()=>t;return n=>nt(e(n))}doLayout(t,e){const{hGap:n,getRibSep:s,vGap:o,nodeSize:r,height:a}=e,{model:c}=this.context,l=this.formatSize(r);let d=l(t)[0]+s(t);const h=(b,S=0)=>{var D;return S+=n*((b.children||[]).length+1),(D=b.children)===null||D===void 0||D.forEach(w=>{var C;(C=c.getNodeLikeDatum(w).children)===null||C===void 0||C.forEach(M=>{const k=c.getNodeLikeDatum(M);S=h(k,S)})}),S},u=b=>{if(b.depth===1)return d;const S=c.getParentData(b.id,"tree");if(ee(b)){const D=c.getParentData(S.id,"tree"),w=p(b)-p(D);return u(S)+w*n/o}else{const D=(S.children||[]).indexOf(b.id),w=c.getNodeData((S.children||[]).slice(D));return f(S)-w.reduce((C,_)=>C+h(_),0)-l(S)[0]/2}},f=ni(b=>{if(us(b))return l(b)[0]/2;const S=c.getParentData(b.id,"tree");if(ee(b))return u(b)+h(b)+l(b)[0]/2;{const D=p(b)-p(S),w=n/o;return u(b)+D*w}},b=>b.id),g=b=>p(c.getParentData(b,"tree")),p=ni(b=>{if(us(b))return a/2;if(ee(b)){const S=c.getParentData(b.id,"tree"),D=S.children.indexOf(b.id);if(D===0)return g(S.id)+o;const w=c.getNodeLikeDatum(S.children[D-1]);if(gt(w.children))return p(w)+o;const C=c.getDescendantsData(w.id);return Math.max(...C.map(_=>ee(_)?g(_.id):p(_)))+o}else{if(gt(b.children))return g(b.id)+o;const S=c.getNodeLikeDatum(b.children.slice(-1)[0]);if(gt(S.children))return p(S)+o;const D=c.getDescendantsData(b.id).slice(-1)[0];return(ee(D)?g(D.id):p(D))+o}},b=>b.id);let y=0;const m={nodes:[],edges:[]},E=b=>{var S;(S=b.children)===null||S===void 0||S.forEach(M=>E(c.getNodeLikeDatum(M)));const D=p(b),w=f(b);if(m.nodes.push({id:b.id,x:w,y:D}),us(b))return;const C=c.getRelatedEdgesData(b.id,"in")[0],_=[u(b),ee(b)?D:g(b.id)];m.edges.push({id:v(C),controlPoints:[_],relatedNodeId:b.id}),y=Math.max(y,w+s(b)),b.depth===1&&(d=y)};return E(t),m}placeAlterative(t,e){const n=(e.children||[]).filter((a,c)=>c%2!==0);if(n.length===0)return t;const{model:s}=this.context,o=t.nodes.find(a=>a.id===e.id).y,r=a=>{const c=s.getAncestorsData(a,"tree");if(gt(c))return!1;const l=c.length===1?a:c[c.length-2].id;return n.includes(l)};t.nodes.forEach(a=>{r(a.id)&&(a.y=2*o-a.y)}),t.edges.forEach(a=>{r(a.relatedNodeId)&&(a.controlPoints=a.controlPoints.map(c=>[c[0],2*o-c[1]]))})}rightToLeft(t,e){return t.nodes.forEach(n=>n.x=e.width-n.x),t.edges.forEach(n=>{n.controlPoints=n.controlPoints.map(s=>[e.width-s[0],s[1]])}),t}execute(t,e){return cl(this,void 0,void 0,function*(){const n=Object.assign(Object.assign(Object.assign({},In.defaultOptions),this.options),e),{direction:s,nodeSize:o}=n,r=this.getRoot();if(!r)return t;const a=this.formatSize(o);n.vGap||(n.vGap=Math.max(...(t.nodes||[]).map(u=>a(u)[1]))),n.hGap||(n.hGap=Math.max(...(t.nodes||[]).map(u=>a(u)[0])));let c=this.doLayout(r,n);this.placeAlterative(c,r),s==="RL"&&(c=this.rightToLeft(c,n));const{model:l}=this.context,d=[],h=[];return c.nodes.forEach(u=>{const{id:f,x:g,y:p}=u,y=l.getNodeLikeDatum(f);d.push(Ri(y,{x:g,y:p}))}),c.edges.forEach(u=>{const{id:f,controlPoints:g}=u,p=l.getEdgeDatum(f);h.push(Ri(p,{controlPoints:g}))}),{nodes:d,edges:h}})}}In.defaultOptions={direction:"RL",getRibSep:()=>60};const Ri=(i,t)=>Object.assign(Object.assign({},i),{style:Object.assign(Object.assign({},i.style||{}),t)}),us=i=>i.depth===0,ee=i=>(i.depth||(i.depth=0))%2===0;var ll=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class kn extends Tn{constructor(){super(...arguments),this.id="snake"}formatSize(t,e){const n=typeof e=="function"?e:()=>e;return t.reduce((s,o)=>{const[r,a]=nt(n(o))||[0,0];return[Math.max(s[0],r),Math.max(s[1],a)]},[0,0])}validate(t){const{nodes:e=[],edges:n=[]}=t,s={},o={},r={};e.forEach(u=>{s[u.id]=0,o[u.id]=0,r[u.id]=[]}),n.forEach(u=>{s[u.target]++,o[u.source]++,r[u.source].push(u.target)});const a=new Set,c=u=>{a.has(u)||(a.add(u),r[u].forEach(c))};if(c(e[0].id),a.size!==e.length)return!1;const l=e.filter(u=>s[u.id]===0),d=e.filter(u=>o[u.id]===0);return!(l.length!==1||d.length!==1||e.filter(u=>s[u.id]===1&&o[u.id]===1).length!==e.length-2)}execute(t,e){return ll(this,void 0,void 0,function*(){var n;if(!this.validate(t))return t;const{nodeSize:s,padding:o,sortBy:r,cols:a,colGap:c,rowGap:l,clockwise:d,width:h,height:u}=Object.assign({},kn.defaultOptions,this.options,e),[f,g,p,y]=mt(o),m=this.formatSize(t.nodes||[],s),E=Math.ceil((t.nodes||[]).length/a);let b=c||(h-y-g-a*m[0])/(a-1),S=l||(u-f-p-E*m[1])/(E-1);return(S===1/0||S<0)&&(S=0),(b===1/0||b<0)&&(b=0),{nodes:((r?(n=t.nodes)===null||n===void 0?void 0:n.sort(r):dl(t))||[]).map((C,_)=>{const M=Math.floor(_/a),k=_%a,ct=d?M%2===0?k:a-1-k:M%2===0?a-1-k:k,it=y+ct*(m[0]+b)+m[0]/2,Ie=f+M*(m[1]+S)+m[1]/2;return{id:C.id,style:{x:it,y:Ie}}})}})}}kn.defaultOptions={padding:0,cols:5,clockwise:!0};function dl(i){const{nodes:t=[],edges:e=[]}=i,n={},s={};t.forEach(a=>{n[a.id]=0,s[a.id]=[]}),e.forEach(a=>{n[a.target]++,s[a.source].push(a.target)});const o=[],r=[];for(t.forEach(a=>{n[a.id]===0&&o.push(a.id)});o.length>0;){const a=o.shift(),c=t.find(l=>l.id===a);r.push(c),s[a].forEach(l=>{n[l]--,n[l]===0&&o.push(l)})}return r}const hl=["rgb(158, 1, 66)","rgb(213, 62, 79)","rgb(244, 109, 67)","rgb(253, 174, 97)","rgb(254, 224, 139)","rgb(255, 255, 191)","rgb(230, 245, 152)","rgb(171, 221, 164)","rgb(102, 194, 165)","rgb(50, 136, 189)","rgb(94, 79, 162)"],ul=["rgb(78, 121, 167)","rgb(242, 142, 44)","rgb(225, 87, 89)","rgb(118, 183, 178)","rgb(89, 161, 79)","rgb(237, 201, 73)","rgb(175, 122, 161)","rgb(255, 157, 167)","rgb(156, 117, 95)","rgb(186, 176, 171)"],fl=["rgb(255, 245, 235)","rgb(254, 230, 206)","rgb(253, 208, 162)","rgb(253, 174, 107)","rgb(253, 141, 60)","rgb(241, 105, 19)","rgb(217, 72, 1)","rgb(166, 54, 3)","rgb(127, 39, 4)"],gl=["rgb(247, 252, 245)","rgb(229, 245, 224)","rgb(199, 233, 192)","rgb(161, 217, 155)","rgb(116, 196, 118)","rgb(65, 171, 93)","rgb(35, 139, 69)","rgb(0, 109, 44)","rgb(0, 68, 27)"],pl=["rgb(247, 251, 255)","rgb(222, 235, 247)","rgb(198, 219, 239)","rgb(158, 202, 225)","rgb(107, 174, 214)","rgb(66, 146, 198)","rgb(33, 113, 181)","rgb(8, 81, 156)","rgb(8, 48, 107)"];class X extends Bs{}function ge(i,t=!0,e){const n=document.createElement("div");return n.setAttribute("class",`g6-${i}`),Object.assign(n.style,{position:"absolute",display:"block"}),t&&Object.assign(n.style,{position:"unset",gridArea:"1 / 1 / 2 / 2",inset:"0px",height:"100%",width:"100%",overflow:"hidden",pointerEvents:"none"}),e&&Object.assign(n.style,e),n}function Ms(i,t="div",e={},n="",s=document.body){const o=document.getElementById(i);o&&o.remove();const r=document.createElement(t);return r.innerHTML=n,r.id=i,Object.assign(r.style,e),s.appendChild(r),r}var yl=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class Bn extends X{constructor(t,e){super(t,Object.assign({},Bn.defaultOptions,e)),this.$element=ge("background"),this.context.canvas.getContainer().prepend(this.$element),this.update(e)}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return yl(this,void 0,void 0,function*(){e.update.call(this,t),Object.assign(this.$element.style,Eo(this.options,["key","type"]))})}destroy(){super.destroy(),this.$element.remove()}}Bn.defaultOptions={transition:"background 0.5s",backgroundSize:"cover",zIndex:"-1"};var ml=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class jn extends X{constructor(t,e){super(t,Gt({},jn.defaultOptions,e)),this.members=new Map,this.avoidMembers=new Map,this.bubbleSetOptions={},this.drawBubbleSets=()=>{const{style:n,bubbleSetOptions:s}=this.parseOptions();$(this.bubbleSetOptions,s)||this.init(),this.bubbleSetOptions=Object.assign({},s);const o=Object.assign(Object.assign({},n),{d:this.getPath()});this.shape?this.shape.update(o):(this.shape=new Re({style:o}),this.context.canvas.appendChild(this.shape))},this.updateBubbleSetsPath=n=>{if(!this.shape)return;const s=v(n.data);[...this.options.members,...this.options.avoidMembers].includes(s)&&this.shape.update(Object.assign(Object.assign({},this.parseOptions().style),{d:this.getPath(s)}))},this.getPath=n=>{const{graph:s}=this.context,o=this.options.members,r=[...this.members.keys()],a=this.options.avoidMembers,c=[...this.avoidMembers.keys()];if(!n&&$(o,r)&&$(a,c))return this.path;const{enter:l=[],exit:d=[]}=It(r,o,y=>y),{enter:h=[],exit:u=[]}=It(c,a,y=>y);n&&(d.push(n),l.push(n));const f=(y,m,E)=>{y.forEach(b=>{const S=E?this.members:this.avoidMembers,D=E?"pushMember":"pushNonMember",w=E?"removeMember":"removeNonMember";if(m){let C;s.getElementType(b)==="edge"?([C]=bl(s,b),this.bubbleSets.pushEdge(C)):([C]=vl(s,b),this.bubbleSets[D](C)),S.set(b,C)}else{const C=S.get(b);C&&(s.getElementType(b)==="edge"?this.bubbleSets.removeEdge(C):this.bubbleSets[w](C),S.delete(b))}})};f(d,!1,!0),f(l,!0,!0),f(u,!1,!1),f(h,!0,!1);const p=this.bubbleSets.compute().sample(8).simplify(0).bSplines().simplify(0);return this.path=Ko(p.points.map(K)),this.path},this.bindEvents(),this.bubbleSets=new si(this.options)}bindEvents(){this.context.graph.on(O.AFTER_RENDER,this.drawBubbleSets),this.context.graph.on(O.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath)}init(){this.bubbleSets=new si(this.options),this.members=new Map,this.avoidMembers=new Map}parseOptions(){const t=this.options,{type:e,key:n,members:s,avoidMembers:o}=t,r=ml(t,["type","key","members","avoidMembers"]),a=Object.keys(r).reduce((c,l)=>(l in xo?c.bubbleSetOptions[l]=r[l]:c.style[l]=r[l],c),{style:{},bubbleSetOptions:{}});return Object.assign({type:e,key:n,members:s,avoidMembers:o},a)}addMember(t){const e=Array.isArray(t)?t:[t];e.some(n=>this.options.avoidMembers.includes(n))&&(this.options.avoidMembers=this.options.avoidMembers.filter(n=>!e.includes(n))),this.options.members=[...new Set([...this.options.members,...e])],this.drawBubbleSets()}removeMember(t){const e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter(n=>!e.includes(n)),this.drawBubbleSets()}updateMember(t){this.options.members=A(t)?t(this.options.members):t,this.drawBubbleSets()}getMember(){return this.options.members}addAvoidMember(t){const e=Array.isArray(t)?t:[t];e.some(n=>this.options.members.includes(n))&&(this.options.members=this.options.members.filter(n=>!e.includes(n))),this.options.avoidMembers=[...new Set([...this.options.avoidMembers,...e])],this.drawBubbleSets()}removeAvoidMember(t){const e=Array.isArray(t)?t:[t];this.options.avoidMembers.some(n=>e.includes(n))&&(this.options.avoidMembers=this.options.avoidMembers.filter(n=>!e.includes(n)),this.drawBubbleSets())}updateAvoidMember(t){this.options.avoidMembers=Array.isArray(t)?t:[t],this.drawBubbleSets()}getAvoidMember(){return this.options.avoidMembers}destroy(){this.context.graph.off(O.AFTER_RENDER,this.drawBubbleSets),this.context.graph.off(O.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath),this.shape.destroy(),super.destroy()}}jn.defaultOptions=Object.assign({members:[],avoidMembers:[],fill:"lightblue",fillOpacity:.2,stroke:"blue",strokeOpacity:.2},xo);const vl=(i,t)=>(Array.isArray(t)?t:[t]).map(n=>{const s=i.getElementRenderBounds(n);return new Sr(s.min[0],s.min[1],vt(s),bt(s))}),bl=(i,t)=>(Array.isArray(t)?t:[t]).map(n=>{const s=i.getEdgeData(n),o=i.getElementPosition(s.source),r=i.getElementPosition(s.target);return xr.from({x1:o[0],y1:o[1],x2:r[0],y2:r[1]})});function El(i){return`
    <ul class="g6-contextmenu-ul">
      ${i.map(t=>`<li  class="g6-contextmenu-li" value="${t.value}">${t.name}</li>`).join("")}
    </ul>
  `}const xl=`
  .g6-contextmenu {
    font-size: 12px;
    background-color: rgba(255, 255, 255, 0.96);
    border-radius: 4px;
    overflow: hidden;
    box-shadow: rgba(0, 0, 0, 0.12) 0px 6px 12px 0px;
    transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s;
  }

  .g6-contextmenu-ul {
    max-width: 256px;
    min-width: 96px;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .g6-contextmenu-li {
    padding: 8px 12px;
    cursor: pointer;
    user-select: none;
  }

  .g6-contextmenu-li:hover {
    background-color: #f5f5f5;
    cursor: pointer;
  }
`;var Li=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class zn extends X{constructor(t,e){super(t,Object.assign({},zn.defaultOptions,e)),this.targetElement=null,this.onTriggerEvent=n=>{var s;(s=n.preventDefault)===null||s===void 0||s.call(n),this.show(n)},this.onMenuItemClick=n=>{const{onClick:s,trigger:o}=this.options;if(n.target instanceof HTMLElement&&n.target.className.includes("g6-contextmenu-li")){const r=n.target.getAttribute("value");s==null||s(r,n.target,this.targetElement),this.hide()}o!=="click"&&this.hide()},this.initElement(),this.update(e)}initElement(){this.$element=ge("contextmenu",!1,{zIndex:"99"});const{className:t}=this.options;t&&this.$element.classList.add(t),this.context.canvas.getContainer().appendChild(this.$element),Ms("g6-contextmenu-css","style",{},xl,document.head)}show(t){return Li(this,void 0,void 0,function*(){const{enable:e,offset:n}=this.options;if(typeof e=="function"&&!e(t)||!e){this.hide();return}const s=yield this.getDOMContent(t);s instanceof HTMLElement?(this.$element.innerHTML="",this.$element.appendChild(s)):this.$element.innerHTML=s;const o=this.context.graph.getCanvas().getContainer().getBoundingClientRect();this.$element.style.left=`${t.client.x-o.left+n[0]}px`,this.$element.style.top=`${t.client.y-o.top+n[1]}px`,this.$element.style.display="block",this.targetElement=t.target})}hide(){this.$element.style.display="none",this.targetElement=null}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy(),this.$element.remove()}getDOMContent(t){return Li(this,void 0,void 0,function*(){const{getContent:e,getItems:n}=this.options;return n?El(yield n(t)):yield e(t)})}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.on(`canvas:${e}`,this.onTriggerEvent),t.on(`node:${e}`,this.onTriggerEvent),t.on(`edge:${e}`,this.onTriggerEvent),t.on(`combo:${e}`,this.onTriggerEvent),document.addEventListener("click",this.onMenuItemClick)}unbindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.off(`canvas:${e}`,this.onTriggerEvent),t.off(`node:${e}`,this.onTriggerEvent),t.off(`edge:${e}`,this.onTriggerEvent),t.off(`combo:${e}`,this.onTriggerEvent),document.removeEventListener("click",this.onMenuItemClick)}}zn.defaultOptions={trigger:"contextmenu",offset:[4,4],loadingContent:'<div class="g6-contextmenu-loading">Loading...</div>',getContent:()=>"It is a empty context menu.",enable:()=>!0};class Fn extends X{constructor(t,e){super(t,Object.assign({},Fn.defaultOptions,e)),this.edgeBundles={},this.edgePoints={},this.onBundle=()=>{const{model:n,element:s}=this.context,o=n.getEdgeData();this.divideEdges(this.options.divisions);const{cycles:r,iterRate:a,divRate:c}=this.options;let{lambda:l,divisions:d,iterations:h}=this.options;for(let u=0;u<r;u++){for(let f=0;f<h;f++){const g={};o.forEach(p=>{var y;if(p.source===p.target)return;const m=v(p);g[m]=this.getEdgeForces(p,d,l);for(let E=0;E<d+1;E++)(y=this.edgePoints)[m]||(y[m]=[]),this.edgePoints[m][E]=T(this.edgePoints[m][E],g[m][E])})}l/=2,d*=c,h*=a,this.divideEdges(d)}o.forEach(u=>{const f=v(u),g=s.getElement(f);g==null||g.update({d:Hs(this.edgePoints[f])})})},this.bindEvents()}get nodeMap(){const t=this.context.model.getNodeData();return Object.fromEntries(t.map(e=>[v(e),qt(V(e))]))}divideEdges(t){this.context.model.getEdgeData().forEach(n=>{var s;const o=v(n);(s=this.edgePoints)[o]||(s[o]=[]);const r=this.nodeMap[n.source],a=this.nodeMap[n.target];if(t===1)this.edgePoints[o].push(r),this.edgePoints[o].push(ut(T(r,a),2)),this.edgePoints[o].push(a);else{const l=(this.edgePoints[o].length===0?N(r,a):Cl(this.edgePoints[o]))/(t+1);let d=l;const h=[r];for(let u=1;u<this.edgePoints[o].length;u++){const f=this.edgePoints[o][u-1],g=this.edgePoints[o][u];let p=N(g,f);for(;p>d;){const y=d/p,m=T(f,lt(P(g,f),y));h.push(m),p-=d,d=l}d-=p}h.push(a),this.edgePoints[o]=h}})}getVectorPosition(t){const e=this.nodeMap[t.source],n=this.nodeMap[t.target],[s,o]=P(n,e),r=N(e,n);return{source:e,target:n,vx:s,vy:o,length:r}}measureEdgeCompatibility(t,e){const n=this.getVectorPosition(t),s=this.getVectorPosition(e),o=Sl(n,s),r=Ol(n,s),a=Dl(n,s),c=wl(n,s);return o*r*a*c}getEdgeBundles(){const t={},e=this.options.bundleThreshold,n=this.context.model.getEdgeData();return n.forEach((s,o)=>{n.forEach((r,a)=>{var c,l;if(a<=o)return;this.measureEdgeCompatibility(s,r)>=e&&(t[c=v(s)]||(t[c]=[]),t[v(s)].push(r),t[l=v(r)]||(t[l]=[]),t[v(r)].push(s))})}),t}getSpringForce(t,e){const{pre:n,cur:s,next:o}=t;return lt(P(T(n,o),lt(s,2)),e)}getElectrostaticForce(t,e){gt(this.edgeBundles)&&(this.edgeBundles=this.getEdgeBundles());const n=this.edgeBundles[v(e)];let s=[0,0];return n==null||n.forEach(o=>{const r=this.edgePoints[v(o)][t],a=this.edgePoints[v(e)][t],c=P(r,a),l=N(r,a);s=T(s,lt(c,1/l))}),s}getEdgeForces(t,e,n){const s=this.nodeMap[t.source],o=this.nodeMap[t.target],r=this.options.K/(N(s,o)*(e+1)),a=[[0,0]],c=v(t);for(let l=1;l<e;l++){const d=this.getSpringForce({pre:this.edgePoints[c][l-1],cur:this.edgePoints[c][l],next:this.edgePoints[c][l+1]||[0,0]},r),h=this.getElectrostaticForce(l,t);a.push(lt(T(d,h),n))}return a.push([0,0]),a}bindEvents(){const{graph:t}=this.context;t.on(O.AFTER_RENDER,this.onBundle)}unbindEvents(){const{graph:t}=this.context;t.off(O.AFTER_RENDER,this.onBundle)}destroy(){this.unbindEvents(),super.destroy()}}Fn.defaultOptions={K:.1,lambda:.1,divisions:1,divRate:2,cycles:6,iterations:90,iterRate:2/3,bundleThreshold:.6};const Sl=(i,t)=>Math.abs(Sa([i.vx,i.vy],[t.vx,t.vy])/(i.length*t.length)),Ol=(i,t)=>{const e=(i.length+t.length)/2;return 2/(e/Math.min(i.length,t.length)+Math.max(i.length,t.length)/e)},Dl=(i,t)=>{const e=(i.length+t.length)/2,n=ut(T(i.source,i.target),2),s=ut(T(t.source,t.target),2);return e/(e+N(n,s))},Ni=(i,t)=>{if(t.source[0]===t.target[0])return[t.source[0],i[1]];if(t.source[1]===t.target[1])return[i[0],t.source[1]];const e=(t.source[1]-t.target[1])/(t.source[0]-t.target[0]),n=(e*e*t.source[0]+e*(i[1]-t.source[1])+i[0])/(e*e+1),s=e*(n-t.source[0])+t.source[1];return[n,s]},Ii=(i,t)=>{const e=Ni(t.source,i),n=Ni(t.target,i),s=ut(T(e,n),2),o=ut(T(i.source,i.target),2);return N(e,n)===0?0:Math.max(0,1-2*N(o,s)/N(e,n))},wl=(i,t)=>Math.min(Ii(i,t),Ii(t,i)),Cl=i=>{let t=0;for(let e=1;e<i.length;e++)t+=N(i[e],i[e-1]);return t},_l={fill:"#fff",fillOpacity:1,lineWidth:1,stroke:"#000",strokeOpacity:.8,zIndex:-1/0},ki=.05;class $n extends X{constructor(t,e){super(t,Object.assign({},$n.defaultOptions,e)),this.shapes=new Map,this.r=this.options.r,this.onEdgeFilter=n=>{if(this.options.trigger==="drag"&&this.isLensOn)return;const s=K(n.canvas);this.renderLens(s),this.renderFocusElements()},this.renderLens=n=>{const s=Object.assign({},_l,this.options.style);this.isLensOn||(this.lens=new Jt({style:s}),this.canvas.appendChild(this.lens)),Object.assign(s,dt(n),{size:this.r*2}),this.lens.update(s)},this.getFilterData=()=>{const{filter:n}=this.options,{model:s}=this.context,o=s.getData();if(!n)return o;const{nodes:r,edges:a,combos:c}=o;return{nodes:r.filter(l=>n(v(l),"node")),edges:a.filter(l=>n(v(l),"edge")),combos:c.filter(l=>n(v(l),"combo"))}},this.getFocusElements=n=>{const{nodes:s,edges:o}=this.getFilterData(),r=s.filter(l=>N(V(l),n)<this.r),a=r.map(l=>v(l)),c=o.filter(l=>{const{source:d,target:h}=l,u=a.includes(d),f=a.includes(h);switch(this.options.nodeType){case"both":return u&&f;case"either":return u!==f;case"source":return u&&!f;case"target":return!u&&f;default:return!1}});return{nodes:r,edges:c}},this.renderFocusElements=()=>{const{element:n,graph:s}=this.context;if(!this.isLensOn)return;const o=this.lens.getCenter(),{nodes:r,edges:a}=this.getFocusElements(o),c=new Set,l=d=>{const h=v(d);c.add(h);const u=n.getElement(h);if(!u)return;const f=this.shapes.get(h)||u.cloneNode();f.setPosition(u.getPosition()),f.id=u.id,this.shapes.has(h)?Object.entries(u.attributes).forEach(([y,m])=>{f.style[y]!==m&&(f.style[y]=m)}):(this.canvas.appendChild(f),this.shapes.set(h,f));const g=s.getElementType(h),p=this.getElementStyle(g,d);f.update(p)};r.forEach(l),a.forEach(l),this.shapes.forEach((d,h)=>{c.has(h)||(d.destroy(),this.shapes.delete(h))})},this.scaleRByWheel=n=>{var s;this.options.preventDefault&&n.preventDefault();const{clientX:o,clientY:r,deltaX:a,deltaY:c}=n,{graph:l,canvas:d}=this.context,h=l.getCanvasByClient([o,r]),u=(s=this.lens)===null||s===void 0?void 0:s.getCenter();if(!this.isLensOn||N(h,u)>this.r)return;const{maxR:f,minR:g}=this.options,p=a+c>0?1/(1-ki):1-ki,y=Math.min(...d.getSize())/2;this.r=Math.max(g||0,Math.min(f||y,this.r*p)),this.renderLens(u),this.renderFocusElements()},this.isLensDragging=!1,this.onDragStart=n=>{var s;const o=K(n.canvas),r=(s=this.lens)===null||s===void 0?void 0:s.getCenter();!this.isLensOn||N(o,r)>this.r||(this.isLensDragging=!0)},this.onDrag=n=>{if(!this.isLensDragging)return;const s=K(n.canvas);this.renderLens(s),this.renderFocusElements()},this.onDragEnd=()=>{this.isLensDragging=!1},this.bindEvents()}get canvas(){return this.context.canvas.getLayer("transient")}get isLensOn(){return this.lens&&!this.lens.destroyed}getElementStyle(t,e){const n=t==="node"?this.options.nodeStyle:this.options.edgeStyle;return typeof n=="function"?n(e):n}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}bindEvents(){var t;const{graph:e}=this.context,{trigger:n,scaleRBy:s}=this.options,o=e.getCanvas().getLayer();["click","drag"].includes(n)&&o.addEventListener(x.CLICK,this.onEdgeFilter),n==="pointermove"?o.addEventListener(x.POINTER_MOVE,this.onEdgeFilter):n==="drag"&&(o.addEventListener(x.DRAG_START,this.onDragStart),o.addEventListener(x.DRAG,this.onDrag),o.addEventListener(x.DRAG_END,this.onDragEnd)),s==="wheel"&&((t=this.graphDom)===null||t===void 0||t.addEventListener(x.WHEEL,this.scaleRByWheel,{passive:!1}))}unbindEvents(){var t;const{graph:e}=this.context,{trigger:n,scaleRBy:s}=this.options,o=e.getCanvas().getLayer();["click","drag"].includes(n)&&o.removeEventListener(x.CLICK,this.onEdgeFilter),n==="pointermove"?o.removeEventListener(x.POINTER_MOVE,this.onEdgeFilter):n==="drag"&&(o.removeEventListener(x.DRAG_START,this.onDragStart),o.removeEventListener(x.DRAG,this.onDrag),o.removeEventListener(x.DRAG_END,this.onDragEnd)),s==="wheel"&&((t=this.graphDom)===null||t===void 0||t.removeEventListener(x.WHEEL,this.scaleRByWheel))}update(t){var e;this.unbindEvents(),super.update(t),this.r=(e=t.r)!==null&&e!==void 0?e:this.r,this.bindEvents()}destroy(){this.unbindEvents(),this.isLensOn&&this.lens.destroy(),this.shapes.forEach((t,e)=>{t.destroy(),this.shapes.delete(e)}),super.destroy()}}$n.defaultOptions={trigger:"pointermove",r:60,nodeType:"both",filter:()=>!0,style:{lineWidth:2},nodeStyle:{label:!1},edgeStyle:{label:!0},scaleRBy:"wheel",preventDefault:!0};const Tl={fill:"#ccc",fillOpacity:.1,lineWidth:2,stroke:"#000",strokeOpacity:.8,labelFontSize:12},Bi=.05,ji=.1;class Wn extends X{constructor(t,e){super(t,Object.assign({},Wn.defaultOptions,e)),this.r=this.options.r,this.d=this.options.d,this.onCreateFisheye=n=>{if(this.options.trigger==="drag"&&this.isLensOn)return;const s=K(n.canvas);this.onMagnify(s)},this.onMagnify=n=>{n.some(isNaN)||(this.renderLens(n),this.renderFocusElements())},this.renderLens=n=>{const s=Object.assign({},Tl,this.options.style);this.isLensOn||(this.lens=new Jt({style:s}),this.canvas.appendChild(this.lens)),Object.assign(s,dt(n),{size:this.r*2,label:this.options.showDPercent,labelText:this.getDPercent()}),this.lens.update(s)},this.getDPercent=()=>{const{minD:n,maxD:s}=this.options;return`${Math.round((this.d-n)/(s-n)*100)}%`},this.prevMagnifiedStyleMap=new Map,this.prevOriginStyleMap=new Map,this.renderFocusElements=()=>{if(!this.isLensOn)return;const{graph:n}=this.context,s=this.lens.getCenter(),o=(this.d+1)*this.r,r=new Map,a=new Map;n.getNodeData().forEach(l=>{const d=V(l),h=N(d,s);if(h>this.r)return;const u=o*h/(this.d*h+this.r),[f,g]=d,[p,y]=s,m=(f-p)/h,E=(g-y)/h,b=[p+u*m,y+u*E],S=v(l),D=this.getNodeStyle(l),w=Te(n.getElementRenderStyle(S),Object.keys(D));r.set(S,Object.assign(Object.assign({},dt(b)),D)),a.set(S,Object.assign(Object.assign({},dt(d)),w))}),this.updateStyle(r,a)},this.getNodeStyle=n=>{const{nodeStyle:s}=this.options;return typeof s=="function"?s(n):s},this.updateStyle=(n,s)=>{const{graph:o,element:r}=this.context,{enter:a,exit:c,keep:l}=It(Array.from(this.prevMagnifiedStyleMap.keys()),Array.from(n.keys()),u=>u),d=new Set,h=(u,f)=>{const g=r.getElement(u);g==null||g.update(f),o.getRelatedEdgesData(u).forEach(p=>{d.add(v(p))})};[...a,...l].forEach(u=>{h(u,n.get(u))}),c.forEach(u=>{h(u,this.prevOriginStyleMap.get(u)),this.prevOriginStyleMap.delete(u)}),d.forEach(u=>{const f=r.getElement(u);f==null||f.update({})}),this.prevMagnifiedStyleMap=n,s.forEach((u,f)=>{this.prevOriginStyleMap.has(f)||this.prevOriginStyleMap.set(f,u)})},this.isWheelValid=n=>{if(this.options.preventDefault&&n.preventDefault(),!this.isLensOn)return!1;const{clientX:s,clientY:o}=n,r=this.context.graph.getCanvasByClient([s,o]),a=this.lens.getCenter();return!(N(r,a)>this.r)},this.scaleR=n=>{const{maxR:s,minR:o}=this.options,r=n?1/(1-Bi):1-Bi,a=Math.min(...this.context.canvas.getSize())/2;this.r=Math.max(o||0,Math.min(s||a,this.r*r))},this.scaleD=n=>{const{maxD:s,minD:o}=this.options,r=n?this.d+ji:this.d-ji;this.d=Math.max(o,Math.min(s,r))},this.scaleRByWheel=n=>{if(!this.isWheelValid(n))return;const{deltaX:s,deltaY:o}=n;this.scaleR(s+o>0);const r=this.lens.getCenter();this.onMagnify(r)},this.scaleDByWheel=n=>{if(!this.isWheelValid(n))return;const{deltaX:s,deltaY:o}=n;this.scaleD(s+o>0);const r=this.lens.getCenter();this.onMagnify(r)},this.isDragValid=n=>{if(this.options.preventDefault&&n.preventDefault(),!this.isLensOn)return!1;const s=K(n.canvas),o=this.lens.getCenter();return!(N(s,o)>this.r)},this.isLensDragging=!1,this.onDragStart=n=>{this.isDragValid(n)&&(this.isLensDragging=!0)},this.onDrag=n=>{if(!this.isLensDragging)return;const s=K(n.canvas);this.onMagnify(s)},this.onDragEnd=()=>{this.isLensDragging=!1},this.scaleRByDrag=n=>{if(!this.isLensDragging)return;const{dx:s,dy:o}=n;this.scaleR(s-o>0);const r=this.lens.getCenter();this.onMagnify(r)},this.scaleDByDrag=n=>{if(!this.isLensDragging)return;const{dx:s,dy:o}=n;this.scaleD(s-o>0);const r=this.lens.getCenter();this.onMagnify(r)},this.bindEvents()}get canvas(){return this.context.canvas.getLayer("transient")}get isLensOn(){return this.lens&&!this.lens.destroyed}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}bindEvents(){var t;const{graph:e}=this.context,{trigger:n,scaleRBy:s,scaleDBy:o}=this.options,r=e.getCanvas().getLayer();if(["click","drag"].includes(n)&&r.addEventListener(x.CLICK,this.onCreateFisheye),n==="pointermove"&&r.addEventListener(x.POINTER_MOVE,this.onCreateFisheye),n==="drag"||s==="drag"||o==="drag"){r.addEventListener(x.DRAG_START,this.onDragStart),r.addEventListener(x.DRAG_END,this.onDragEnd);const a=n==="drag"?this.onDrag:s==="drag"?this.scaleRByDrag:this.scaleDByDrag;r.addEventListener(x.DRAG,a)}if(s==="wheel"||o==="wheel"){const a=s==="wheel"?this.scaleRByWheel:this.scaleDByWheel;(t=this.graphDom)===null||t===void 0||t.addEventListener(x.WHEEL,a,{passive:!1})}}unbindEvents(){var t;const{graph:e}=this.context,{trigger:n,scaleRBy:s,scaleDBy:o}=this.options,r=e.getCanvas().getLayer();if(["click","drag"].includes(n)&&r.removeEventListener(x.CLICK,this.onCreateFisheye),n==="pointermove"&&r.removeEventListener(x.POINTER_MOVE,this.onCreateFisheye),n==="drag"||s==="drag"||o==="drag"){r.removeEventListener(x.DRAG_START,this.onDragStart),r.removeEventListener(x.DRAG_END,this.onDragEnd);const a=n==="drag"?this.onDrag:s==="drag"?this.scaleRByDrag:this.scaleDByDrag;r.removeEventListener(x.DRAG,a)}if(s==="wheel"||o==="wheel"){const a=s==="wheel"?this.scaleRByWheel:this.scaleDByWheel;(t=this.graphDom)===null||t===void 0||t.removeEventListener(x.WHEEL,a)}}update(t){var e,n;this.unbindEvents(),super.update(t),this.r=(e=t.r)!==null&&e!==void 0?e:this.r,this.d=(n=t.d)!==null&&n!==void 0?n:this.d,this.bindEvents()}destroy(){var t;this.unbindEvents(),this.isLensOn&&((t=this.lens)===null||t===void 0||t.destroy()),this.prevMagnifiedStyleMap.clear(),this.prevOriginStyleMap.clear(),super.destroy()}}Wn.defaultOptions={trigger:"pointermove",r:120,d:1.5,maxD:5,minD:0,showDPercent:!0,style:{},nodeStyle:{label:!0},preventDefault:!0};class Vn extends X{constructor(t,e){super(t,Object.assign({},Vn.defaultOptions,e)),this.$el=this.context.canvas.getContainer(),this.graphSize=[0,0],this.onFullscreenChange=()=>{var n,s,o,r;const a=!!document.fullscreenElement;this.options.autoFit&&this.setGraphSize(a),a?(s=(n=this.options).onEnter)===null||s===void 0||s.call(n):(r=(o=this.options).onExit)===null||r===void 0||r.call(o)},this.shortcut=new he(t.graph),this.bindEvents(),this.style=document.createElement("style"),document.head.appendChild(this.style),this.style.innerHTML=`
      :not(:root):fullscreen::backdrop {
        background: transparent;
      }
    `}bindEvents(){this.unbindEvents(),this.shortcut.unbindAll();const{request:t=[],exit:e=[]}=this.options.trigger;this.shortcut.bind(t,this.request),this.shortcut.bind(e,this.exit),["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach(s=>{document.addEventListener(s,this.onFullscreenChange,!1)})}unbindEvents(){this.shortcut.unbindAll(),["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach(e=>{document.removeEventListener(e,this.onFullscreenChange,!1)})}setGraphSize(t=!0){var e,n;let s,o;t?(s=((e=globalThis.screen)===null||e===void 0?void 0:e.width)||0,o=((n=globalThis.screen)===null||n===void 0?void 0:n.height)||0,this.graphSize=this.context.graph.getSize()):[s,o]=this.graphSize,this.context.graph.setSize(s,o),this.context.graph.render()}request(){document.fullscreenElement||!Al()||this.$el.requestFullscreen().catch(t=>{yt.warn(`Error attempting to enable full-screen: ${t.message} (${t.name})`)})}exit(){document.fullscreenElement&&document.exitFullscreen()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.exit(),this.style.remove(),super.destroy()}}Vn.defaultOptions={trigger:{},autoFit:!0};function Al(){return document.fullscreenEnabled||Reflect.get(document,"webkitFullscreenEnabled")||Reflect.get(document,"mozFullscreenEnabled")||Reflect.get(document,"msFullscreenEnabled")}class Hn extends X{constructor(t,e){super(t,Object.assign({},Hn.defaultOptions,e)),this.$element=ge("grid-line",!0),this.offset=[0,0],this.currentScale=1,this.followZoom=s=>{const{data:{scale:o,origin:r}}=s;if(!o)return;const a=this.currentScale;this.currentScale=o;const c=o/a,l=lt(r||this.context.graph.getCanvasCenter(),1-c),d=this.baseSize*o,h=lt(this.offset,c),u=rs(h,d),f=T(u,l);this.$element.style.backgroundSize=`${d}px ${d}px`,this.$element.style.backgroundPosition=`${f[0]}px ${f[1]}px`,this.offset=rs(f,d)},this.followTranslate=s=>{if(!this.options.follow)return;const{data:{translate:o}}=s;o&&this.updateOffset(o)},this.onTransform=s=>{const o=this.parseFollow(this.options.follow);o.zoom&&this.followZoom(s),o.translate&&this.followTranslate(s)},this.context.canvas.getContainer().prepend(this.$element),this.baseSize=this.options.size,this.updateStyle(),this.bindEvents()}update(t){super.update(t),t.size!==void 0&&(this.baseSize=t.size),this.updateStyle()}bindEvents(){const{graph:t}=this.context;t.on(O.AFTER_TRANSFORM,this.onTransform)}updateStyle(){const{stroke:t,lineWidth:e,border:n,borderLineWidth:s,borderStroke:o,borderStyle:r}=this.options,a=this.baseSize*this.currentScale;Object.assign(this.$element.style,{border:n?`${s}px ${r} ${o}`:"none",backgroundImage:`linear-gradient(${t} ${e}px, transparent ${e}px), linear-gradient(90deg, ${t} ${e}px, transparent ${e}px)`,backgroundSize:`${a}px ${a}px`,backgroundRepeat:"repeat"})}updateOffset(t){const e=this.baseSize*this.currentScale;this.offset=rs(T(this.offset,t),e),this.$element.style.backgroundPosition=`${this.offset[0]}px ${this.offset[1]}px`}parseFollow(t){var e,n;return vs(t)?{translate:t,zoom:t}:{translate:(e=t==null?void 0:t.translate)!==null&&e!==void 0?e:!1,zoom:(n=t==null?void 0:t.zoom)!==null&&n!==void 0?n:!1}}destroy(){this.context.graph.off(O.AFTER_TRANSFORM,this.onTransform),this.$element.remove(),super.destroy()}}Hn.defaultOptions={border:!0,borderLineWidth:1,borderStroke:"#eee",borderStyle:"solid",lineWidth:1,size:20,stroke:"#eee"};function Xs(i){const t={Added:new Map,Updated:new Map,Removed:new Map};return i.forEach(e=>{const{type:n,value:s}=e,o=v(s);if(n==="NodeAdded"||n==="EdgeAdded"||n==="ComboAdded")t.Added.set(o,e);else if(n==="NodeUpdated"||n==="EdgeUpdated"||n==="ComboUpdated")if(t.Added.has(o))t.Added.set(o,{type:n.replace("Updated","Added"),value:s});else if(t.Updated.has(o)){const{original:r}=t.Updated.get(o);t.Updated.set(o,{type:n,value:s,original:r})}else t.Removed.has(o)||t.Updated.set(o,e);else(n==="NodeRemoved"||n==="EdgeRemoved"||n==="ComboRemoved")&&(t.Added.has(o)?t.Added.delete(o):(t.Updated.has(o)&&t.Updated.delete(o),t.Removed.set(o,e)))}),[...Array.from(t.Added.values()),...Array.from(t.Updated.values()),...Array.from(t.Removed.values())]}function rr(i){const{NodeAdded:t=[],NodeUpdated:e=[],NodeRemoved:n=[],EdgeAdded:s=[],EdgeUpdated:o=[],EdgeRemoved:r=[],ComboAdded:a=[],ComboUpdated:c=[],ComboRemoved:l=[]}=rn(i,d=>d.type);return{add:{nodes:t,edges:s,combos:a},update:{nodes:e,edges:o,combos:c},remove:{nodes:n,edges:r,combos:l}}}function ar(i,t){for(const e in i)at(i[e])&&!Array.isArray(i[e])&&i[e]!==null?(t[e]||(t[e]={}),ar(i[e],t[e])):t[e]===void 0&&(t[e]=Oe(e))}function Ml(i,t=!1,e){const n={animation:t,current:{add:{},update:{},remove:{}},original:{add:{},update:{},remove:{}}},{add:s,update:o,remove:r}=rr(Xs(i));return["nodes","edges","combos"].forEach(a=>{o[a]&&o[a].forEach(c=>{var l,d;const h=Object.assign({},c.value);let u=Object.assign({},c.original);if(e){const f=e.graph.getElementType(v(c.original)),g=f==="edge"?"stroke":"fill",p=e.element.getElementComputedStyle(f,c.original);u=Object.assign(Object.assign({},c.original),{style:Object.assign({[g]:p[g]},c.original.style)})}ar(h,u),(l=n.current.update)[a]||(l[a]=[]),n.current.update[a].push(h),(d=n.original.update)[a]||(d[a]=[]),n.original.update[a].push(u)}),s[a]&&s[a].forEach(c=>{var l,d;const h=Object.assign({},c.value);(l=n.current.add)[a]||(l[a]=[]),n.current.add[a].push(h),(d=n.original.remove)[a]||(d[a]=[]),n.original.remove[a].push(h)}),r[a]&&r[a].forEach(c=>{var l,d;const h=Object.assign({},c.value);(l=n.current.remove)[a]||(l[a]=[]),n.current.remove[a].push(h),(d=n.original.add)[a]||(d[a]=[]),n.original.add[a].push(h)})}),n}class Un extends X{constructor(t,e){super(t,Object.assign({},Un.defaultOptions,e)),this.batchChanges=null,this.batchAnimation=!1,this.undoStack=[],this.redoStack=[],this.freezed=!1,this.executeCommand=(s,o=!0)=>{var r,a,c;this.freezed=!0,(a=(r=this.options).executeCommand)===null||a===void 0||a.call(r,s);const l=o?s.original:s.current;this.context.graph.addData(l.add),this.context.graph.updateData(l.update),this.context.graph.removeData(Po(l.remove,!1)),(c=this.context.element)===null||c===void 0||c.draw({silence:!0,animation:s.animation}),this.freezed=!1},this.addCommand=s=>{var o;if(!this.freezed){if(s.type===O.AFTER_DRAW){const{dataChanges:r=[],animation:a=!0}=s.data;if(!((o=this.context.batch)===null||o===void 0)&&o.isBatching){if(!this.batchChanges)return;this.batchChanges.push(r),this.batchAnimation&&(this.batchAnimation=a);return}this.batchChanges=[r],this.batchAnimation=a}this.undoStackPush(Ml(this.batchChanges.flat(),this.batchAnimation,this.context)),this.notify(Pt.ADD,this.undoStack[this.undoStack.length-1])}},this.initBatchCommand=s=>{const{initiate:o}=s.data;this.batchAnimation=!1,o?this.batchChanges=[]:this.undoStack.pop()||(this.batchChanges=null)},this.emitter=new So;const{graph:n}=this.context;n.on(O.AFTER_DRAW,this.addCommand),n.on(O.BATCH_START,this.initBatchCommand),n.on(O.BATCH_END,this.addCommand)}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){var t,e,n,s;const o=this.undoStack.pop();if(o){if(this.executeCommand(o),((e=(t=this.options).beforeAddCommand)===null||e===void 0?void 0:e.call(t,o,!1))===!1)return;this.redoStack.push(o),(s=(n=this.options).afterAddCommand)===null||s===void 0||s.call(n,o,!1),this.notify(Pt.UNDO,o)}return this}redo(){const t=this.redoStack.pop();return t&&(this.executeCommand(t,!1),this.undoStackPush(t),this.notify(Pt.REDO,t)),this}undoAndCancel(){const t=this.undoStack.pop();return t&&(this.executeCommand(t,!1),this.redoStack=[],this.notify(Pt.CANCEL,t)),this}undoStackPush(t){var e,n,s,o;const{stackSize:r}=this.options;r!==0&&this.undoStack.length>=r&&this.undoStack.shift(),((n=(e=this.options).beforeAddCommand)===null||n===void 0?void 0:n.call(e,t,!0))!==!1&&(this.undoStack.push(t),(o=(s=this.options).afterAddCommand)===null||o===void 0||o.call(s,t,!0))}clear(){this.undoStack=[],this.redoStack=[],this.batchChanges=null,this.batchAnimation=!1,this.notify(Pt.CLEAR,null)}notify(t,e){this.emitter.emit(t,{cmd:e}),this.emitter.emit(Pt.CHANGE,{cmd:e})}on(t,e){this.emitter.on(t,e)}destroy(){const{graph:t}=this.context;t.off(O.AFTER_DRAW,this.addCommand),t.off(O.BATCH_START,this.initBatchCommand),t.off(O.BATCH_END,this.addCommand),this.emitter.off(),super.destroy(),this.undoStack=[],this.redoStack=[]}}Un.defaultOptions={stackSize:0};const fs={toXy(i,t){if(!t)return[...i];const e=t[0].slice(1),n=t[1].slice(1);return i.map(s=>[s[e],s[n]])},fromXy(i,t){if(!t)return[...i];const e=t[0].slice(1),n=t[1].slice(1);return i.map(([s,o])=>({[e]:s,[n]:o}))}};class Pl{constructor(t,e){this._cells=[],this._cellSize=e,this._reverseCellSize=1/e;for(const n of t){const s=this.coordToCellNum(n[0]),o=this.coordToCellNum(n[1]);this._cells[s]||(this._cells[s]=[]),this._cells[s][o]||(this._cells[s][o]=[]),this._cells[s][o].push(n)}}cellPoints(t,e){var n;return((n=this._cells[t])===null||n===void 0?void 0:n[e])||[]}rangePoints(t){const e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),s=this.coordToCellNum(t[2]),o=this.coordToCellNum(t[3]),r=[];for(let a=e;a<=s;a++)for(let c=n;c<=o;c++){const l=this.cellPoints(a,c);for(const d of l)r.push(d)}return r}removePoint(t){const e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),s=this._cells[e][n],o=s.findIndex(([r,a])=>r===t[0]&&a===t[1]);return o>-1&&s.splice(o,1),s}trunc(t){return Math.trunc(t)}coordToCellNum(t){return this.trunc(t*this._reverseCellSize)}extendBbox(t,e){return[t[0]-e*this._cellSize,t[1]-e*this._cellSize,t[2]+e*this._cellSize,t[3]+e*this._cellSize]}}function Rl(i,t){return new Pl(i,t)}const zi=+(Math.pow(2,27)+1);function Xe(i,t,e){const n=i*t,s=zi*i,o=s-i,r=s-o,a=i-r,c=zi*t,l=c-t,d=c-l,h=t-d,g=n-r*d-a*d-r*h,p=a*h-g;return e?(e[0]=p,e[1]=n,e):[p,n]}function Ll(i,t,e){const n=i+t,s=n-i,o=n-s,r=t-s,a=i-o;return e?(e[0]=a+r,e[1]=n,e):[a+r,n]}function Nl(i,t){const e=i.length;if(e===1){const a=Xe(i[0],t);return a[0]?a:[a[1]]}const n=new Array(2*e),s=[.1,.1],o=[.1,.1];let r=0;Xe(i[0],t,s),s[0]&&(n[r++]=s[0]);for(let a=1;a<e;++a){Xe(i[a],t,o);const c=s[1];Ll(c,o[0],s),s[0]&&(n[r++]=s[0]);const l=o[1],d=s[1],h=l+d,u=h-l,f=d-u;s[1]=h,f&&(n[r++]=f)}return s[1]&&(n[r++]=s[1]),r===0&&(n[r++]=0),n.length=r,n}function Il(i,t){const e=i+t,n=e-i,s=e-n,o=t-n,a=i-s+o;return a?[a,e]:[e]}function kl(i,t){const e=i.length|0,n=t.length|0;if(e===1&&n===1)return Il(i[0],-t[0]);const s=e+n,o=new Array(s);let r=0,a=0,c=0;const l=Math.abs;let d=i[a],h=l(d),u=-t[c],f=l(u),g,p;h<f?(p=d,a+=1,a<e&&(d=i[a],h=l(d))):(p=u,c+=1,c<n&&(u=-t[c],f=l(u))),a<e&&h<f||c>=n?(g=d,a+=1,a<e&&(d=i[a],h=l(d))):(g=u,c+=1,c<n&&(u=-t[c],f=l(u)));let y=g+p,m=y-g,E=p-m,b=E,S=y,D,w,C,_,M;for(;a<e&&c<n;)h<f?(g=d,a+=1,a<e&&(d=i[a],h=l(d))):(g=u,c+=1,c<n&&(u=-t[c],f=l(u))),p=b,y=g+p,m=y-g,E=p-m,E&&(o[r++]=E),D=S+y,w=D-S,C=D-w,_=y-w,M=S-C,b=M+_,S=D;for(;a<e;)g=d,p=b,y=g+p,m=y-g,E=p-m,E&&(o[r++]=E),D=S+y,w=D-S,C=D-w,_=y-w,M=S-C,b=M+_,S=D,a+=1,a<e&&(d=i[a]);for(;c<n;)g=u,p=b,y=g+p,m=y-g,E=p-m,E&&(o[r++]=E),D=S+y,w=D-S,C=D-w,_=y-w,M=S-C,b=M+_,S=D,c+=1,c<n&&(u=-t[c]);return b&&(o[r++]=b),S&&(o[r++]=S),r||(o[r++]=0),o.length=r,o}function Bl(i,t){const e=i+t,n=e-i,s=e-n,o=t-n,a=i-s+o;return a?[a,e]:[e]}function jl(i,t){const e=i.length|0,n=t.length|0;if(e===1&&n===1)return Bl(i[0],t[0]);const s=e+n,o=new Array(s);let r=0,a=0,c=0;const l=Math.abs;let d=i[a],h=l(d),u=t[c],f=l(u),g,p;h<f?(p=d,a+=1,a<e&&(d=i[a],h=l(d))):(p=u,c+=1,c<n&&(u=t[c],f=l(u))),a<e&&h<f||c>=n?(g=d,a+=1,a<e&&(d=i[a],h=l(d))):(g=u,c+=1,c<n&&(u=t[c],f=l(u)));let y=g+p,m=y-g,E=p-m,b=E,S=y,D,w,C,_,M;for(;a<e&&c<n;)h<f?(g=d,a+=1,a<e&&(d=i[a],h=l(d))):(g=u,c+=1,c<n&&(u=t[c],f=l(u))),p=b,y=g+p,m=y-g,E=p-m,E&&(o[r++]=E),D=S+y,w=D-S,C=D-w,_=y-w,M=S-C,b=M+_,S=D;for(;a<e;)g=d,p=b,y=g+p,m=y-g,E=p-m,E&&(o[r++]=E),D=S+y,w=D-S,C=D-w,_=y-w,M=S-C,b=M+_,S=D,a+=1,a<e&&(d=i[a]);for(;c<n;)g=u,p=b,y=g+p,m=y-g,E=p-m,E&&(o[r++]=E),D=S+y,w=D-S,C=D-w,_=y-w,M=S-C,b=M+_,S=D,c+=1,c<n&&(u=t[c]);return b&&(o[r++]=b),S&&(o[r++]=S),r||(o[r++]=0),o.length=r,o}const Fi=5,on=11102230246251565e-32,zl=(3+16*on)*on,Fl=(7+56*on)*on;function $l(i,t,e,n){return function(o,r,a){const c=i(i(t(r[1],a[0]),t(-a[1],r[0])),i(t(o[1],r[0]),t(-r[1],o[0]))),l=i(t(o[1],a[0]),t(-a[1],o[0])),d=n(c,l);return d[d.length-1]}}function Wl(i,t,e,n){return function(o,r,a,c){const l=i(i(e(i(t(a[1],c[0]),t(-c[1],a[0])),r[2]),i(e(i(t(r[1],c[0]),t(-c[1],r[0])),-a[2]),e(i(t(r[1],a[0]),t(-a[1],r[0])),c[2]))),i(e(i(t(r[1],c[0]),t(-c[1],r[0])),o[2]),i(e(i(t(o[1],c[0]),t(-c[1],o[0])),-r[2]),e(i(t(o[1],r[0]),t(-r[1],o[0])),c[2])))),d=i(i(e(i(t(a[1],c[0]),t(-c[1],a[0])),o[2]),i(e(i(t(o[1],c[0]),t(-c[1],o[0])),-a[2]),e(i(t(o[1],a[0]),t(-a[1],o[0])),c[2]))),i(e(i(t(r[1],a[0]),t(-a[1],r[0])),o[2]),i(e(i(t(o[1],a[0]),t(-a[1],o[0])),-r[2]),e(i(t(o[1],r[0]),t(-r[1],o[0])),a[2])))),h=n(l,d);return h[h.length-1]}}function Vl(i,t,e,n){return function(o,r,a,c,l){const d=i(i(i(e(i(e(i(t(c[1],l[0]),t(-l[1],c[0])),a[2]),i(e(i(t(a[1],l[0]),t(-l[1],a[0])),-c[2]),e(i(t(a[1],c[0]),t(-c[1],a[0])),l[2]))),r[3]),i(e(i(e(i(t(c[1],l[0]),t(-l[1],c[0])),r[2]),i(e(i(t(r[1],l[0]),t(-l[1],r[0])),-c[2]),e(i(t(r[1],c[0]),t(-c[1],r[0])),l[2]))),-a[3]),e(i(e(i(t(a[1],l[0]),t(-l[1],a[0])),r[2]),i(e(i(t(r[1],l[0]),t(-l[1],r[0])),-a[2]),e(i(t(r[1],a[0]),t(-a[1],r[0])),l[2]))),c[3]))),i(e(i(e(i(t(a[1],c[0]),t(-c[1],a[0])),r[2]),i(e(i(t(r[1],c[0]),t(-c[1],r[0])),-a[2]),e(i(t(r[1],a[0]),t(-a[1],r[0])),c[2]))),-l[3]),i(e(i(e(i(t(c[1],l[0]),t(-l[1],c[0])),r[2]),i(e(i(t(r[1],l[0]),t(-l[1],r[0])),-c[2]),e(i(t(r[1],c[0]),t(-c[1],r[0])),l[2]))),o[3]),e(i(e(i(t(c[1],l[0]),t(-l[1],c[0])),o[2]),i(e(i(t(o[1],l[0]),t(-l[1],o[0])),-c[2]),e(i(t(o[1],c[0]),t(-c[1],o[0])),l[2]))),-r[3])))),i(i(e(i(e(i(t(r[1],l[0]),t(-l[1],r[0])),o[2]),i(e(i(t(o[1],l[0]),t(-l[1],o[0])),-r[2]),e(i(t(o[1],r[0]),t(-r[1],o[0])),l[2]))),c[3]),i(e(i(e(i(t(r[1],c[0]),t(-c[1],r[0])),o[2]),i(e(i(t(o[1],c[0]),t(-c[1],o[0])),-r[2]),e(i(t(o[1],r[0]),t(-r[1],o[0])),c[2]))),-l[3]),e(i(e(i(t(a[1],c[0]),t(-c[1],a[0])),r[2]),i(e(i(t(r[1],c[0]),t(-c[1],r[0])),-a[2]),e(i(t(r[1],a[0]),t(-a[1],r[0])),c[2]))),o[3]))),i(e(i(e(i(t(a[1],c[0]),t(-c[1],a[0])),o[2]),i(e(i(t(o[1],c[0]),t(-c[1],o[0])),-a[2]),e(i(t(o[1],a[0]),t(-a[1],o[0])),c[2]))),-r[3]),i(e(i(e(i(t(r[1],c[0]),t(-c[1],r[0])),o[2]),i(e(i(t(o[1],c[0]),t(-c[1],o[0])),-r[2]),e(i(t(o[1],r[0]),t(-r[1],o[0])),c[2]))),a[3]),e(i(e(i(t(r[1],a[0]),t(-a[1],r[0])),o[2]),i(e(i(t(o[1],a[0]),t(-a[1],o[0])),-r[2]),e(i(t(o[1],r[0]),t(-r[1],o[0])),a[2]))),-c[3]))))),h=i(i(i(e(i(e(i(t(c[1],l[0]),t(-l[1],c[0])),a[2]),i(e(i(t(a[1],l[0]),t(-l[1],a[0])),-c[2]),e(i(t(a[1],c[0]),t(-c[1],a[0])),l[2]))),o[3]),e(i(e(i(t(c[1],l[0]),t(-l[1],c[0])),o[2]),i(e(i(t(o[1],l[0]),t(-l[1],o[0])),-c[2]),e(i(t(o[1],c[0]),t(-c[1],o[0])),l[2]))),-a[3])),i(e(i(e(i(t(a[1],l[0]),t(-l[1],a[0])),o[2]),i(e(i(t(o[1],l[0]),t(-l[1],o[0])),-a[2]),e(i(t(o[1],a[0]),t(-a[1],o[0])),l[2]))),c[3]),e(i(e(i(t(a[1],c[0]),t(-c[1],a[0])),o[2]),i(e(i(t(o[1],c[0]),t(-c[1],o[0])),-a[2]),e(i(t(o[1],a[0]),t(-a[1],o[0])),c[2]))),-l[3]))),i(i(e(i(e(i(t(a[1],l[0]),t(-l[1],a[0])),r[2]),i(e(i(t(r[1],l[0]),t(-l[1],r[0])),-a[2]),e(i(t(r[1],a[0]),t(-a[1],r[0])),l[2]))),o[3]),e(i(e(i(t(a[1],l[0]),t(-l[1],a[0])),o[2]),i(e(i(t(o[1],l[0]),t(-l[1],o[0])),-a[2]),e(i(t(o[1],a[0]),t(-a[1],o[0])),l[2]))),-r[3])),i(e(i(e(i(t(r[1],l[0]),t(-l[1],r[0])),o[2]),i(e(i(t(o[1],l[0]),t(-l[1],o[0])),-r[2]),e(i(t(o[1],r[0]),t(-r[1],o[0])),l[2]))),a[3]),e(i(e(i(t(r[1],a[0]),t(-a[1],r[0])),o[2]),i(e(i(t(o[1],a[0]),t(-a[1],o[0])),-r[2]),e(i(t(o[1],r[0]),t(-r[1],o[0])),a[2]))),-l[3])))),u=n(d,h);return u[u.length-1]}}function Yn(i){return(i===3?$l:i===4?Wl:Vl)(jl,Xe,Nl,kl)}const Hl=Yn(3),Ul=Yn(4),Vt=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,n){const s=(t[1]-n[1])*(e[0]-n[0]),o=(t[0]-n[0])*(e[1]-n[1]),r=s-o;let a;if(s>0){if(o<=0)return r;a=s+o}else if(s<0){if(o>=0)return r;a=-(s+o)}else return r;const c=zl*a;return r>=c||r<=-c?r:Hl(t,e,n)},function(t,e,n,s){const o=t[0]-s[0],r=e[0]-s[0],a=n[0]-s[0],c=t[1]-s[1],l=e[1]-s[1],d=n[1]-s[1],h=t[2]-s[2],u=e[2]-s[2],f=n[2]-s[2],g=r*d,p=a*l,y=a*c,m=o*d,E=o*l,b=r*c,S=h*(g-p)+u*(y-m)+f*(E-b),D=(Math.abs(g)+Math.abs(p))*Math.abs(h)+(Math.abs(y)+Math.abs(m))*Math.abs(u)+(Math.abs(E)+Math.abs(b))*Math.abs(f),w=Fl*D;return S>w||-S>w?S:Ul(t,e,n,s)}];function Yl(i){let t=Vt[i.length];return t||(t=Vt[i.length]=Yn(i.length)),t.apply(void 0,...i)}function Kl(i,t,e,n,s,o,r){return function(...c){switch(c.length){case 0:case 1:return 0;case 2:return n(c[0],c[1]);case 3:return s(c[0],c[1],c[2]);case 4:return o(c[0],c[1],c[2],c[3]);case 5:return r(c[0],c[1],c[2],c[3],c[4])}return i(c)}}function Xl(){for(;Vt.length<=Fi;)Vt.push(Yn(Vt.length));const i=Kl(void 0,Yl,...Vt);for(let t=0;t<=Fi;++t)i[t]=Vt[t];return i}const ve=Xl(),$i=ve[3];function Gl(i){const t=i.length;if(t<3){const a=new Array(t);for(let c=0;c<t;++c)a[c]=c;return t===2&&i[0][0]===i[1][0]&&i[0][1]===i[1][1]?[0]:a}const e=new Array(t);for(let a=0;a<t;++a)e[a]=a;e.sort((a,c)=>{const l=i[a][0]-i[c][0];return l||i[a][1]-i[c][1]});const n=[e[0],e[1]],s=[e[0],e[1]];for(let a=2;a<t;++a){const c=e[a],l=i[c];let d=n.length;for(;d>1&&$i(i[n[d-2]],i[n[d-1]],l)<=0;)d-=1,n.pop();for(n.push(c),d=s.length;d>1&&$i(i[s[d-2]],i[s[d-1]],l)>=0;)d-=1,s.pop();s.push(c)}const o=new Array(s.length+n.length-2);let r=0;for(let a=0,c=n.length;a<c;++a)o[r++]=n[a];for(let a=s.length-2;a>0;--a)o[r++]=s[a];return o}function Zl(i,t,e,n){for(let s=0;s<2;++s){const o=i[s],r=t[s],[a,c]=[Math.min(o,r),Math.max(o,r)],l=e[s],d=n[s],[h,u]=[Math.min(l,d),Math.max(l,d)];if(u<a||c<h)return!1}return!0}function ql(i,t,e,n){const s=ve(i,e,n),o=ve(t,e,n);if(s>0&&o>0||s<0&&o<0)return!1;const r=ve(e,i,t),a=ve(n,i,t);return r>0&&a>0||r<0&&a<0?!1:s===0&&o===0&&r===0&&a===0?Zl(i,t,e,n):!0}function Ql(i){const t=[i[0]];let e=i[0];for(let n=1;n<i.length;n++){const s=i[n];(e[0]!==s[0]||e[1]!==s[1])&&t.push(s),e=s}return t}function Jl(i){return i.sort(function(t,e){return t[0]-e[0]||t[1]-e[1]})}function Ps(i,t){return Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2)}function Wi(i,t,e){const n=[t[0]-i[0],t[1]-i[1]],s=[e[0]-i[0],e[1]-i[1]],o=Ps(i,t),r=Ps(i,e);return(n[0]*s[0]+n[1]*s[1])/Math.sqrt(o*r)}function Vi(i,t){for(let e=0;e<t.length-1;e++){const n=[t[e],t[e+1]];if(!(i[0][0]===n[0][0]&&i[0][1]===n[0][1]||i[0][0]===n[1][0]&&i[0][1]===n[1][1])&&ql(i[0],i[1],n[0],n[1]))return!0}return!1}function td(i){let t=1/0,e=1/0,n=-1/0,s=-1/0;for(let o=i.length-1;o>=0;o--)i[o][0]<t&&(t=i[o][0]),i[o][1]<e&&(e=i[o][1]),i[o][0]>n&&(n=i[o][0]),i[o][1]>s&&(s=i[o][1]);return[n-t,s-e]}function ed(i){return[Math.min(i[0][0],i[1][0]),Math.min(i[0][1],i[1][1]),Math.max(i[0][0],i[1][0]),Math.max(i[0][1],i[1][1])]}function nd(i,t,e){let n=null,s=Hi,o=Hi,r,a;for(let c=0;c<t.length;c++)r=Wi(i[0],i[1],t[c]),a=Wi(i[1],i[0],t[c]),r>s&&a>o&&!Vi([i[0],t[c]],e)&&!Vi([i[1],t[c]],e)&&(s=r,o=a,n=t[c]);return n}function cr(i,t,e,n,s){let o=!1;for(let r=0;r<i.length-1;r++){const a=[i[r],i[r+1]],c=a[0][0]+","+a[0][1]+","+a[1][0]+","+a[1][1];if(Ps(a[0],a[1])<t||s.has(c))continue;let l=0,d=ed(a),h,u,f;do d=n.extendBbox(d,l),h=d[2]-d[0],u=d[3]-d[1],f=nd(a,n.rangePoints(d),i),l++;while(f===null&&(e[0]>h||e[1]>u));h>=e[0]&&u>=e[1]&&s.add(c),f!==null&&(i.splice(r+1,0,f),n.removePoint(f),o=!0)}return o?cr(i,t,e,n,s):i}function sd(i,t,e){const n=t||20,s=Ql(Jl(fs.toXy(i,e)));if(s.length<4){const h=s.concat([s[0]]);return e?fs.fromXy(h,e):h}const o=td(s),r=[o[0]*Ui,o[1]*Ui],a=Gl(s).reverse().map(h=>s[h]);a.push(a[0]);const c=s.filter(function(h){return a.indexOf(h)<0}),l=Math.ceil(1/(s.length/(o[0]*o[1]))),d=cr(a,Math.pow(n,2),r,Rl(c,l),new Set);return e?fs.fromXy(d,e):d}const Hi=Math.cos(90/(180/Math.PI)),Ui=.6;function id(i,t,e){if(i.length===1)return od(i[0],t,e);if(i.length===2)return Yi(i,t,e);if(i.length===3){const[n,s,o]=Fs(i);if(jo(n,s,o))return Yi([n,o],t,e)}switch(e){case"smooth":return ad(i,t);case"sharp":return cd(i,t);case"rounded":default:return rd(i,t)}}const od=(i,t,e)=>{if(e==="sharp")return[["M",i[0]-t,i[1]-t],["L",i[0]+t,i[1]-t],["L",i[0]+t,i[1]+t],["L",i[0]-t,i[1]+t],["Z"]];const n=[t,t,0,0,0];return[["M",i[0],i[1]-t],["A",...n,i[0],i[1]+t],["A",...n,i[0],i[1]-t]]},Yi=(i,t,e)=>{const n=[t,t,0,0,0],s=e==="sharp"?T(i[0],Nt(Ot(P(i[0],i[1])),t)):i[0],o=e==="sharp"?T(i[1],Nt(Ot(P(i[1],i[0])),t)):i[1],r=Nt(Ot(dn(P(s,o),!1)),t),a=Nt(r,-1),c=T(s,r),l=T(o,r),d=T(o,a),h=T(s,a);return e==="sharp"?[["M",c[0],c[1]],["L",l[0],l[1]],["L",d[0],d[1]],["L",h[0],h[1]],["Z"]]:[["M",c[0],c[1]],["L",l[0],l[1]],["A",...n,d[0],d[1]],["L",h[0],h[1]],["A",...n,c[0],c[1]]]},rd=(i,t)=>{const e=Fs(i).map((a,c)=>{const l=(c-2+i.length)%i.length,d=(c-1+i.length)%i.length,h=(c+1)%i.length,u=i[l],f=i[d],g=i[h],p=P(u,f),y=P(f,a),m=P(a,g),E=(C,_)=>js(C,_,!0)<Math.PI,b=E(p,y),S=E(y,m),D=C=>Nt(Ot(dn(C,!1)),t),w=D(y);return[{p:qt(b?T(f,D(p)):T(f,w)),concave:b&&f},{p:qt(S?T(a,D(m)):T(a,w)),concave:S&&a}]}),n=[t,t,0,0,0],s=e.findIndex((a,c)=>!e[(c-1+e.length)%e.length][0].concave&&!e[(c-1+e.length)%e.length][1].concave&&!a[0].concave&&!a[0].concave&&!a[1].concave),o=e.slice(s).concat(e.slice(0,s));let r=[];return o.flatMap((a,c)=>{const l=[],d=o[e.length-1];return c===0&&l.push(["M",...d[1].p]),a[0].concave?r.push(a[0].p,a[1].p):l.push(["A",...n,...a[0].p]),a[1].concave?r.unshift(a[1].p):l.push(["L",...a[1].p]),r.length===3&&(l.pop(),l.push(["C",...r.flat()]),r=[]),l})},ad=(i,t)=>{const e=Fs(i).map((n,s)=>{const o=i[(s+1)%i.length];return{p:n,v:Ot(P(o,n))}});return e.forEach((n,s)=>{const o=s>0?s-1:i.length-1,r=e[o].v,a=Ot(T(r,Nt(n.v,js(r,n.v,!0)<Math.PI?1:-1)));n.p=T(n.p,Nt(a,t))}),Ko(e.map(n=>n.p))},cd=(i,t)=>{const n=i.map((o,r)=>{const a=i[r===0?i.length-1:r-1],c=De(Nt(Ot(dn(P(a,o),!1)),t));return[T(a,c),T(o,c)]}).flat();return n.map((o,r)=>{if(r%2===0)return null;const a=[n[(r-1)%n.length],n[r%n.length]],c=[n[(r+1)%n.length],n[(r+2)%n.length]];return zs(a,c,!0)}).filter(Boolean).map((o,r)=>[r===0?"M":"L",o[0],o[1]]).concat([["Z"]])};var ld=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class Kn extends X{constructor(t,e){super(t,Object.assign({},Kn.defaultOptions,e)),this.hullMemberIds=[],this.drawHull=()=>{if(!this.shape)this.shape=new Re({style:this.getHullStyle()}),this.context.canvas.appendChild(this.shape);else{const n=!$(this.optionsCache,this.options);this.shape.update(this.getHullStyle(n))}this.optionsCache=Object.assign({},this.options)},this.updateHullPath=n=>{this.shape&&this.options.members.includes(v(n.data))&&this.shape.update({d:this.getHullPath(!0)})},this.getHullPath=(n=!1)=>{const{graph:s}=this.context,o=this.getMember();if(o.length===0)return"";const r=o.map(l=>s.getNodeData(l)),a=sd(r.map(V),this.options.concavity).slice(1).reverse(),c=a.flatMap(l=>r.filter(d=>$(V(d),l)).map(v));return $(c,this.hullMemberIds)&&!n?this.path:(this.hullMemberIds=c,this.path=id(a,this.getPadding(),this.options.corner),this.path)},this.bindEvents()}bindEvents(){this.context.graph.on(O.AFTER_RENDER,this.drawHull),this.context.graph.on(O.AFTER_ELEMENT_UPDATE,this.updateHullPath)}getHullStyle(t){const e=this.options,{members:n,padding:s,corner:o}=e,r=ld(e,["members","padding","corner"]);return Object.assign(Object.assign({},r),{d:this.getHullPath(t)})}getPadding(){const{graph:t}=this.context;return this.hullMemberIds.reduce((n,s)=>{const{halfExtents:o}=t.getElementRenderBounds(s),r=Math.max(o[0],o[1]);return Math.max(n,r)},0)+this.options.padding}addMember(t){const e=Array.isArray(t)?t:[t];this.options.members=[...new Set([...this.options.members,...e])],this.shape.update({d:this.getHullPath()})}removeMember(t){const e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter(n=>!e.includes(n)),e.some(n=>this.hullMemberIds.includes(n))&&this.shape.update({d:this.getHullPath()})}updateMember(t){this.options.members=A(t)?t(this.options.members):t,this.shape.update(this.getHullStyle(!0))}getMember(){return this.options.members}destroy(){this.context.graph.off(O.AFTER_DRAW,this.drawHull),this.shape.destroy(),this.hullMemberIds=[],super.destroy()}}Kn.defaultOptions={members:[],padding:10,corner:"rounded",concavity:1/0,fill:"lightblue",fillOpacity:.2,labelOpacity:1,stroke:"blue",strokeOpacity:.2};function Gs(i){const{width:t,height:e,renderer:n}=i,s=dd(i),o=new bs({width:t,height:e,container:s,renderer:n||new xe});return[s,o]}function dd(i){var t;const{container:e,className:n,graphCanvas:s}=i;if(e)return typeof e=="string"?document.getElementById(e):e;const o=ge(n,!1),{width:r,height:a,containerStyle:c}=i,[l,d]=hd(i);return Object.assign(o.style,Object.assign({position:"absolute",left:l+"px",top:d+"px",width:r+"px",height:a+"px"},c)),(t=s.getContainer())===null||t===void 0||t.appendChild(o),o}function hd(i){const{width:t,height:e,placement:n,graphCanvas:s}=i,[o,r]=s.getSize(),[a,c]=ko(n);return[a*(o-t),c*(r-e)]}var ud=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class Xn extends X{constructor(t,e){super(t,Object.assign({},Xn.defaultOptions,e)),this.typePrefix="__data__",this.draw=!1,this.fieldMap={node:new Map,edge:new Map,combo:new Map},this.selectedItems=[],this.bindEvents=()=>{const{graph:n}=this.context;n.on(O.AFTER_DRAW,this.createElement)},this.changeState=(n,s)=>{const{graph:o}=this.context,{typePrefix:r}=this,a=tt(n,[r,"id"]),c=tt(n,[r,"style","labelText"]),[l]=a.split("__"),d=this.fieldMap[l].get(c)||[];o.setElementState(Object.fromEntries(d==null?void 0:d.map(h=>[h,s])))},this.click=n=>{if(this.options.trigger==="hover")return;const s=tt(n,[this.typePrefix,"id"]);this.selectedItems.includes(s)?(this.selectedItems=this.selectedItems.filter(o=>o!==s),this.changeState(n,[])):(this.selectedItems.push(s),this.changeState(n,"selected"))},this.mouseleave=n=>{this.options.trigger!=="click"&&(this.selectedItems=[],this.changeState(n,[]))},this.mouseenter=n=>{if(this.options.trigger==="click")return;const s=tt(n,[this.typePrefix,"id"]);this.selectedItems.includes(s)?this.selectedItems=this.selectedItems.filter(o=>o!==s):(this.selectedItems.push(s),this.changeState(n,"active"))},this.setFieldMap=(n,s,o)=>{if(!n)return;const r=this.fieldMap[o];if(r)if(!r.has(n))r.set(n,[s]);else{const a=r.get(n);a&&(a.push(s),r.set(n,a))}},this.getEvents=()=>({mouseenter:this.mouseenter,mouseleave:this.mouseleave,click:this.click}),this.getMarkerData=(n,s)=>{if(!n)return[];const{model:o,element:r}=this.context,{nodes:a,edges:c,combos:l}=o.getData(),d={},h=y=>A(n)?n(y):n,u={node:"circle",edge:"line",combo:"rect"},f={circle:"circle",ellipse:"circle",image:"bowtie",rect:"square",star:"cross",triangle:"triangle",diamond:"diamond",cubic:"dot",line:"hyphen",polyline:"hyphen",quadratic:"hv","cubic-horizontal":"hyphen","cubic-vertical":"line"},g=(y,m)=>r==null?void 0:r.getElementComputedStyle(y,m),p=(y,m)=>{y.forEach(E=>{const{id:b}=E,S=tt(E,["data",h(E)]),D=(r==null?void 0:r.getElementType(m,E))||"circle",w=g(m,E),C=(m==="edge"?w==null?void 0:w.stroke:w==null?void 0:w.fill)||"#1783ff";b&&S&&S.replace(/\s+/g,"")&&(this.setFieldMap(S,b,m),d[S]||(d[S]={id:`${m}__${b}`,label:S,marker:f[D]||u[m],elementType:m,lineWidth:1,stroke:C,fill:C}))})};switch(s){case"node":p(a,"node");break;case"edge":p(c,"edge");break;case"combo":p(l,"combo");break;default:return[]}return Object.values(d)},this.createElement=()=>{if(this.draw){this.updateElement();return}const n=this.options,{width:s,height:o,nodeField:r,edgeField:a,comboField:c,trigger:l,position:d,container:h,containerStyle:u,className:f}=n,g=ud(n,["width","height","nodeField","edgeField","comboField","trigger","position","container","containerStyle","className"]),p=this.getMarkerData(r,"node"),y=this.getMarkerData(a,"edge"),m=this.getMarkerData(c,"combo"),E=[...p,...m,...y],b=Object.assign({width:s,height:o,data:E,itemMarkerLineWidth:({lineWidth:w})=>w,itemMarker:({marker:w})=>w,itemMarkerStroke:({stroke:w})=>w,itemMarkerFill:({fill:w})=>w,gridCol:p.length},g,this.getEvents()),S=new Or({className:"legend",style:b});this.category=S,this.upsertCanvas().appendChild(S),this.draw=!0},this.bindEvents()}update(t){super.update(t),this.clear(),this.createElement()}clear(){var t,e;(t=this.canvas)===null||t===void 0||t.destroy(),(e=this.container)===null||e===void 0||e.remove(),this.canvas=void 0,this.container=void 0,this.draw=!1}updateElement(){this.category&&this.category.update({itemMarkerOpacity:({id:t})=>!this.selectedItems.length||this.selectedItems.includes(t)?1:.5,itemLabelOpacity:({id:t})=>!this.selectedItems.length||this.selectedItems.includes(t)?1:.5})}upsertCanvas(){if(this.canvas)return this.canvas;const t=this.context.canvas,[e,n]=t.getSize(),{width:s=e,height:o=n,position:r,container:a,containerStyle:c,className:l}=this.options,[d,h]=Gs({width:s,height:o,graphCanvas:t,container:a,containerStyle:c,placement:r,className:"legend"});return this.container=d,l&&d.classList.add(l),this.canvas=h,this.canvas}destroy(){this.clear(),this.context.graph.off(O.AFTER_DRAW,this.createElement),super.destroy()}}Xn.defaultOptions={position:"bottom",trigger:"hover",orientation:"horizontal",layout:"flex",itemSpacing:4,rowPadding:10,colPadding:10,itemMarkerSize:16,itemLabelFontSize:16,width:240,height:160};class Gn extends X{constructor(t,e){super(t,Object.assign({},Gn.defaultOptions,e)),this.onDraw=n=>{var s;!((s=n==null?void 0:n.data)===null||s===void 0)&&s.render||this.onRender()},this.shapes=new Map,this.landmarkMap=new Map,this.mask=null,this.isMaskDragging=!1,this.onMaskDragStart=n=>{this.mask&&(this.isMaskDragging=!0,this.mask.setPointerCapture(n.pointerId),this.mask.addEventListener("pointermove",this.onMaskDrag),this.mask.addEventListener("pointerup",this.onMaskDragEnd),this.mask.addEventListener("pointercancel",this.onMaskDragEnd))},this.onMaskDrag=n=>{if(!this.mask||!this.isMaskDragging)return;const{size:[s,o]}=this.options,{movementX:r,movementY:a}=n,{left:c,top:l,width:d,height:h}=this.mask.style,[,,u,f]=this.maskBBox;let g=parseInt(c)+r,p=parseInt(l)+a,y=parseInt(d),m=parseInt(h);g<0&&(g=0),p<0&&(p=0),g+y>s&&(g=At(s-y,0)),p+m>o&&(p=At(o-m,0)),y<u&&(r>0?(g=At(g-r,0),y=Tt(y+r,s)):r<0&&(y=Tt(y-r,s))),m<f&&(a>0?(p=At(p-a,0),m=Tt(m+a,o)):a<0&&(m=Tt(m-a,o))),Object.assign(this.mask.style,{left:g+"px",top:p+"px",width:y+"px",height:m+"px"});const E=parseInt(c)-g,b=parseInt(l)-p;if(E===0&&b===0)return;const S=this.context.canvas.getCamera().getZoom(),D=this.canvas.getCamera().getZoom(),w=S/D;this.context.graph.translateBy([E*w,b*w],!1)},this.onMaskDragEnd=n=>{this.mask&&(this.isMaskDragging=!1,this.mask.releasePointerCapture(n.pointerId),this.mask.removeEventListener("pointermove",this.onMaskDrag),this.mask.removeEventListener("pointerup",this.onMaskDragEnd),this.mask.removeEventListener("pointercancel",this.onMaskDragEnd))},this.onTransform=go(()=>{this.isMaskDragging||(this.updateMask(),this.setCamera())},32,{leading:!0}),this.setOnRender(),this.bindEvents()}update(t){this.unbindEvents(),super.update(t),"delay"in t&&this.setOnRender(),this.bindEvents()}setOnRender(){this.onRender=cn(()=>{this.renderMinimap(),this.renderMask()},this.options.delay)}bindEvents(){const{graph:t}=this.context;t.on(O.AFTER_DRAW,this.onDraw),t.on(O.AFTER_RENDER,this.onRender),t.on(O.AFTER_TRANSFORM,this.onTransform)}unbindEvents(){const{graph:t}=this.context;t.off(O.AFTER_DRAW,this.onDraw),t.off(O.AFTER_RENDER,this.onRender),t.off(O.AFTER_TRANSFORM,this.onTransform)}renderMinimap(){const t=this.getElements(),e=this.initCanvas();this.setShapes(e,t)}getElements(){const{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;const{nodes:s,edges:o,combos:r}=n;return{nodes:s.filter(a=>t(v(a),"node")),edges:o.filter(a=>t(v(a),"edge")),combos:r.filter(a=>t(v(a),"combo"))}}setShapes(t,e){const{nodes:n,edges:s,combos:o}=e,{shape:r}=this.options,{element:a}=this.context;if(r==="key"){const l=new Set,d=h=>{const u=v(h);l.add(u);const f=a.getElement(u);if(!f)return;const g=f.getShape("key"),p=this.shapes.get(u)||g.cloneNode();p.setPosition(g.getPosition()),f.style.zIndex&&(p.style.zIndex=f.style.zIndex),p.id=f.id,this.shapes.has(u)?Object.entries(g.attributes).forEach(([y,m])=>{p.style[y]!==m&&(p.style[y]=m)}):(t.appendChild(p),this.shapes.set(u,p))};s.forEach(d),o.forEach(d),n.forEach(d),this.shapes.forEach((h,u)=>{l.has(u)||(t.removeChild(h),this.shapes.delete(u))});return}const c=(l,d)=>{const u=a.getElement(l).getPosition();return d.setPosition(u),d};t.removeChildren(),s.forEach(l=>t.appendChild(r(v(l),"edge"))),o.forEach(l=>{t.appendChild(c(v(l),r(v(l),"combo")))}),n.forEach(l=>{t.appendChild(c(v(l),r(v(l),"node")))})}initCanvas(){const{renderer:t,size:[e,n]}=this.options;if(this.canvas){const{width:s,height:o}=this.canvas.getConfig();(e!==s||n!==o)&&this.canvas.resize(e,n),t&&this.canvas.setRenderer(t)}else{const{className:s,position:o,container:r,containerStyle:a}=this.options,[c,l]=Gs({renderer:t,width:e,height:n,placement:o,className:"minimap",container:r,containerStyle:a,graphCanvas:this.context.canvas});s&&c.classList.add(s),this.container=c,this.canvas=l}return this.setCamera(),this.canvas}createLandmark(t,e,n){const s=`${t.join(",")}-${e.join(",")}-${n}`;if(this.landmarkMap.has(s))return this.landmarkMap.get(s);const r=this.canvas.getCamera().createLandmark(s,{position:t,focalPoint:e,zoom:n});return this.landmarkMap.set(s,r),r}setCamera(){var t;const{canvas:e}=this.context,n=(t=this.canvas)===null||t===void 0?void 0:t.getCamera();if(!n)return;const{size:[s,o],padding:r}=this.options,[a,c,l,d]=mt(r),{min:h,max:u,center:f}=e.getBounds("elements"),g=u[0]-h[0],p=u[1]-h[1],y=s-d-c,m=o-a-l,E=y/g,b=m/p,S=Math.min(E,b),D=this.createLandmark(f,f,S);n.gotoLandmark(D,0)}get maskBBox(){const{canvas:t}=this.context,e=t.getSize(),n=t.getCanvasByViewport([0,0]),s=t.getCanvasByViewport(e),o=this.canvas.canvas2Viewport(dt(n)),r=this.canvas.canvas2Viewport(dt(s)),a=r.x-o.x,c=r.y-o.y;return[o.x,o.y,a,c]}calculateMaskBBox(){const{size:[t,e]}=this.options;let[n,s,o,r]=this.maskBBox;return n<0&&(o=Tt(o+n,t),n=0),s<0&&(r=Tt(r+s,e),s=0),n+o>t&&(o=At(t-n,0)),s+r>e&&(r=At(e-s,0)),[Tt(n,t),Tt(s,e),At(o,0),At(r,0)]}renderMask(){const{maskStyle:t}=this.options;this.mask||(this.mask=document.createElement("div"),this.mask.addEventListener("pointerdown",this.onMaskDragStart)),this.container.appendChild(this.mask),Object.assign(this.mask.style,Object.assign(Object.assign({},t),{cursor:"move",position:"absolute",pointerEvents:"auto"})),this.updateMask()}updateMask(){if(!this.mask)return;const[t,e,n,s]=this.calculateMaskBBox();Object.assign(this.mask.style,{top:e+"px",left:t+"px",width:n+"px",height:s+"px"})}destroy(){var t;this.unbindEvents(),this.canvas.destroy(),(t=this.mask)===null||t===void 0||t.remove(),super.destroy()}}Gn.defaultOptions={size:[240,160],shape:"key",padding:10,position:"right-bottom",maskStyle:{border:"1px solid #ddd",background:"rgba(0, 0, 0, 0.1)"},containerStyle:{border:"1px solid #ddd",background:"#fff"},delay:128};const Tt=(i,t)=>Math.min(i,t),At=(i,t)=>Math.max(i,t);var gs=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};const ps={x1:0,y1:0,x2:0,y2:0,visibility:"hidden"};class Zn extends X{constructor(t,e){super(t,Object.assign({},Zn.defaultOptions,e)),this.initSnapline=()=>{const n=this.context.canvas.getLayer("transient");this.horizontalLine||(this.horizontalLine=n.appendChild(new Es({style:Object.assign(Object.assign({},ps),this.options.horizontalLineStyle)}))),this.verticalLine||(this.verticalLine=n.appendChild(new Es({style:Object.assign(Object.assign({},ps),this.options.verticalLineStyle)})))},this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!0,this.autoSnapToLine=(n,s,o)=>gs(this,void 0,void 0,function*(){const{verticalX:r,horizontalY:a}=o,{tolerance:c}=this.options,{min:[l,d],max:[h,u],center:[f,g]}=s;let p=0,y=0;r!==null&&(G(h,r)<c&&(p=r-h),G(l,r)<c&&(p=r-l),G(f,r)<c&&(p=r-f),p!==0&&(this.isVerticalSticking=!0)),a!==null&&(G(u,a)<c&&(y=a-u),G(d,a)<c&&(y=a-d),G(g,a)<c&&(y=a-g),y!==0&&(this.isHorizontalSticking=!0)),(p!==0||y!==0)&&(yield this.context.graph.translateElementBy({[n]:[p,y]},!1))}),this.enableSnap=n=>{const{target:s}=n,o=.5;if(this.isHorizontalSticking||this.isVerticalSticking){const[r,a]=this.getDelta(n);if(this.isHorizontalSticking&&this.isVerticalSticking&&Math.abs(r)<=o&&Math.abs(a)<=o)return this.context.graph.translateElementBy({[s.id]:[-r,-a]},!1),!1;if(this.isHorizontalSticking&&Math.abs(a)<=o)return this.context.graph.translateElementBy({[s.id]:[0,-a]},!1),!1;if(this.isVerticalSticking&&Math.abs(r)<=o)return this.context.graph.translateElementBy({[s.id]:[-r,0]},!1),!1;this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!1,setTimeout(()=>{this.enableStick=!0},200)}return this.enableStick},this.calcSnaplineMetadata=(n,s)=>{const{tolerance:o,shape:r}=this.options,{min:[a,c],max:[l,d],center:[h,u]}=s;let f=null,g=null,p=null,y=null,m=null,E=null;return this.getNodes().some(b=>{if($(n.id,b.id))return!1;const S=Ki(b,r).getRenderBounds(),{min:[D,w],max:[C,_],center:[M,k]}=S;return f===null&&(G(M,h)<o?f=M:G(D,a)<o||G(D,l)<o?f=D:(G(C,l)<o||G(C,a)<o)&&(f=C),f!==null&&(g=Math.min(w,c),p=Math.max(_,d))),y===null&&(G(k,u)<o?y=k:G(w,c)<o||G(w,d)<o?y=w:(G(_,d)<o||G(_,c)<o)&&(y=_),y!==null&&(m=Math.min(D,a),E=Math.max(C,l))),f!==null&&y!==null}),{verticalX:f,verticalMinY:g,verticalMaxY:p,horizontalY:y,horizontalMinX:m,horizontalMaxX:E}},this.onDragStart=()=>{this.initSnapline()},this.onDrag=n=>gs(this,void 0,void 0,function*(){const{target:s}=n;if(this.options.autoSnap&&!this.enableSnap(n))return;const o=Ki(s,this.options.shape).getRenderBounds(),r=this.calcSnaplineMetadata(s,o);this.hideSnapline(),(r.verticalX!==null||r.horizontalY!==null)&&this.updateSnapline(r),this.options.autoSnap&&(yield this.autoSnapToLine(s.id,o,r))}),this.onDragEnd=()=>{this.hideSnapline()},this.bindEvents()}getNodes(){var t;const{filter:e}=this.options,s=(((t=this.context.element)===null||t===void 0?void 0:t.getNodes())||[]).filter(o=>{var r;return Kc(o)&&((r=this.context.viewport)===null||r===void 0?void 0:r.isInViewport(o.getRenderBounds()))});return e?s.filter(o=>e(o)):s}hideSnapline(){this.horizontalLine.style.visibility="hidden",this.verticalLine.style.visibility="hidden"}getLineWidth(t){const{lineWidth:e}=this.options[`${t}LineStyle`];return+(e||ps.lineWidth||1)/this.context.graph.getZoom()}updateSnapline(t){const{verticalX:e,verticalMinY:n,verticalMaxY:s,horizontalY:o,horizontalMinX:r,horizontalMaxX:a}=t,[c,l]=this.context.canvas.getSize(),{offset:d}=this.options;o!==null?Object.assign(this.horizontalLine.style,{x1:d===1/0?0:r-d,y1:o,x2:d===1/0?c:a+d,y2:o,visibility:"visible",lineWidth:this.getLineWidth("horizontal")}):this.horizontalLine.style.visibility="hidden",e!==null?Object.assign(this.verticalLine.style,{x1:e,y1:d===1/0?0:n-d,x2:e,y2:d===1/0?l:s+d,visibility:"visible",lineWidth:this.getLineWidth("vertical")}):this.verticalLine.style.visibility="hidden"}getDelta(t){const e=this.context.graph.getZoom();return ut([t.dx,t.dy],e)}bindEvents(){return gs(this,void 0,void 0,function*(){const{graph:t}=this.context;t.on(rt.DRAG_START,this.onDragStart),t.on(rt.DRAG,this.onDrag),t.on(rt.DRAG_END,this.onDragEnd)})}unbindEvents(){const{graph:t}=this.context;t.off(rt.DRAG_START,this.onDragStart),t.off(rt.DRAG,this.onDrag),t.off(rt.DRAG_END,this.onDragEnd)}destroyElements(){var t,e;(t=this.horizontalLine)===null||t===void 0||t.destroy(),(e=this.verticalLine)===null||e===void 0||e.destroy()}destroy(){this.destroyElements(),this.unbindEvents(),super.destroy()}}Zn.defaultOptions={tolerance:5,offset:20,autoSnap:!0,shape:"key",verticalLineStyle:{stroke:"#1783FF"},horizontalLineStyle:{stroke:"#1783FF"},filter:()=>!0};const G=(i,t)=>Math.abs(i-t),Ki=(i,t)=>typeof t=="function"?t(i):i.getShape(t);var fd=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})},gd=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};const pd=["timestamp","time","date","datetime"];class qn extends X{get padding(){return mt(this.options.padding)}constructor(t,e){super(t,Object.assign({},qn.defaultOptions,e)),this.backup(),this.upsertTimebar()}play(){var t;(t=this.timebar)===null||t===void 0||t.play()}pause(){var t;(t=this.timebar)===null||t===void 0||t.pause()}forward(){var t;(t=this.timebar)===null||t===void 0||t.forward()}backward(){var t;(t=this.timebar)===null||t===void 0||t.backward()}reset(){var t;(t=this.timebar)===null||t===void 0||t.reset()}update(t){super.update(t),this.backup(),this.upsertTimebar()}backup(){this.originalData=Xi(this.context.graph.getData())}upsertTimebar(){const{canvas:t}=this.context,e=this.options,{onChange:n,timebarType:s,data:o,x:r,y:a,width:c,height:l,mode:d}=e,h=gd(e,["onChange","timebarType","data","x","y","width","height","mode"]),u=t.getSize(),[f]=this.padding;this.upsertCanvas().ready.then(()=>{var g;const p=Object.assign(Object.assign({x:u[0]/2-c/2,y:f,onChange:y=>{const m=(Dr(y)?y:[y,y]).map(E=>wr(E)?E.getTime():E);this.options.mode==="modify"?this.filterElements(m):this.hiddenElements(m),n==null||n(m)}},h),{data:o.map(y=>U(y)?{time:y,value:0}:y),width:c,height:l,type:s});this.timebar?this.timebar.update(p):(this.timebar=new Cr({style:p}),(g=this.canvas)===null||g===void 0||g.appendChild(this.timebar))})}upsertCanvas(){if(this.canvas)return this.canvas;const{className:t,height:e,position:n}=this.options,s=this.context.canvas,[o]=s.getSize(),[r,,a]=this.padding,[c,l]=Gs({width:o,height:e+r+a,graphCanvas:s,className:"timebar",placement:n});return this.container=c,t&&c.classList.add(t),this.canvas=l,this.canvas}filterElements(t){return fd(this,void 0,void 0,function*(){var e;if(!this.originalData)return;const{elementTypes:n,getTime:s}=this.options,{graph:o,element:r}=this.context,a=Xi(this.originalData);n.forEach(l=>{const d=`${l}s`;a[d]=(this.originalData[d]||[]).filter(h=>{const u=s(h);return!!Gi(u,t)})});const c=[...a.nodes,...a.combos].map(l=>v(l));a.edges=a.edges.filter(l=>{const d=l.source,h=l.target;return c.includes(d)&&c.includes(h)}),o.setData(a),yield(e=r.draw({animation:!1,silence:!0}))===null||e===void 0?void 0:e.finished})}hiddenElements(t){const{graph:e}=this.context,{elementTypes:n,getTime:s}=this.options,o=[],r=[];n.forEach(a=>{var c;const l=`${a}s`;(((c=this.originalData)===null||c===void 0?void 0:c[l])||[]).forEach(h=>{const u=v(h),f=s(h);Gi(f,t)?r.push(u):o.push(u)})}),e.hideElement(o,!1),e.showElement(r,!1)}destroy(){var t,e,n;const{graph:s}=this.context;this.originalData&&s.setData(Object.assign({},this.originalData)),(t=this.timebar)===null||t===void 0||t.destroy(),(e=this.canvas)===null||e===void 0||e.destroy(),(n=this.container)===null||n===void 0||n.remove(),this.originalData=void 0,this.container=void 0,this.timebar=void 0,this.canvas=void 0,super.destroy()}}qn.defaultOptions={position:"bottom",enable:!0,timebarType:"time",className:"g6-timebar",width:450,height:60,zIndex:3,elementTypes:["node"],padding:10,mode:"modify",getTime:i=>yd(i,pd,void 0),loop:!1};const Xi=i=>{const{nodes:t=[],edges:e=[],combos:n=[]}=i;return{nodes:[...t],edges:[...e],combos:[...n]}},Gi=(i,t)=>{if(U(t))return i===t;const[e,n]=t;return i>=e&&i<=n},yd=(i,t,e)=>{var n;for(let s=0;s<t.length;s++){const o=t[s],r=(n=i.data)===null||n===void 0?void 0:n[o];if(r)return r}return e};function md(i){const t={top:"unset",right:"unset",bottom:"unset",left:"unset"};return i.split("-").forEach(n=>{t[n]="8px"}),t.flexDirection=i.startsWith("top")||i.startsWith("bottom")?"row":"column",t}const vd=`
  .g6-toolbar {
    position: absolute;
    z-index: 100;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.1);
    opacity: 0.65;
  }
  .g6-toolbar .g6-toolbar-item {
    display: inline-block;
    width: 16px;
    height: 16px;
    padding: 4px;
    cursor: pointer;
    box-sizing: content-box;
  }

  .g6-toolbar .g6-toolbar-item:hover {
    background-color: #f0f0f0;
  }

  .g6-toolbar .g6-toolbar-item svg {
    display: inline-block;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
`,bd=`
  <svg>
    <symbol id="zoom-in" viewBox="64 64 896 896">
      <path d="M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>
    </symbol>
    <symbol id="zoom-out" viewBox="64 64 896 896">
      <path d="M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>
    </symbol>
    <symbol id="edit" viewBox="64 64 896 896">
      <path d="M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"></path>
    </symbol>
    <symbol id="delete" viewBox="64 64 896 896">
      <path d="M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"></path>
    </symbol>
    <symbol id="redo" viewBox="64 64 896 896">
      <path d="M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"></path>
    </symbol>
    <symbol id="undo" viewBox="64 64 896 896">
      <path d="M511.4 124C290.5 124.3 112 303 112 523.9c0 128 60.2 242 153.8 315.2l-37.5 48c-4.1 5.3-.3 13 6.3 12.9l167-.8c5.2 0 9-4.9 7.7-9.9L369.8 727a8 8 0 00-14.1-3L315 776.1c-10.2-8-20-16.7-29.3-26a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-7.5 7.5-15.3 14.5-23.4 21.2a7.93 7.93 0 00-1.2 11.1l39.4 50.5c2.8 3.5 7.9 4.1 11.4 1.3C854.5 760.8 912 649.1 912 523.9c0-221.1-179.4-400.2-400.6-399.9z"></path>
    </symbol>
    <symbol id="export" viewBox="64 64 896 896">
      <path d="M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"></path>
    </symbol>
    <symbol id="auto-fit" viewBox="64 64 896 896">
      <path d="M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"></path>
      <path d="M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"></path>
    </symbol>
    <symbol id="reset" viewBox="64 64 896 896">
      <path d="M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"></path>
    </symbol>
    <symbol id="exit-fullscreen" viewBox="0 0 1024 1024">
      <path d="M418.13333333 361.43786666c0 0.2048-0.13653333 0.4096-0.13653334 0.68266667C417.99679999 362.32533333 418.13333333 362.53013333 418.13333333 362.73493333 418.13333333 371.54133333 414.44693333 379.392 408.78079999 385.39946666 408.43946666 385.7408 408.30293333 386.21866666 408.02986666 386.49173333c-1.09226667 1.09226667-2.59413333 1.77493333-3.82293333 2.73066667C398.40426666 393.65973333 391.64586666 396.8 383.93173333 396.8 383.72693333 396.8 383.59039999 396.73173333 383.38559999 396.73173333S382.97599999 396.8 382.77119999 396.8L112.29866666 396.8C92.50133333 396.8 76.79999999 381.50826666 76.79999999 362.66666666 76.66346666 343.89333333 92.63786666 328.53333333 112.16213333 328.53333333l189.44 0L87.44959999 114.51733333C73.59146666 100.59093333 73.25013333 78.5408 86.63039999 65.29706666c13.17546667-13.44853333 35.36213333-12.97066667 49.152 0.88746667l214.08426667 214.08426667L349.86666666 90.89706666C349.79839999 71.23626666 365.22666666 55.46666666 383.99999999 55.46666666 402.77333333 55.33013333 418.13333333 71.30453333 418.13333333 90.8288L418.13333333 361.43786666zM928.90453333 328.53333333l-189.44 0 214.15253333-214.08426667c13.85813333-13.9264 14.19946667-35.90826667 0.88746667-49.22026666-13.17546667-13.44853333-35.36213333-12.97066667-49.152 0.88746666l-214.08426667 214.08426667L691.26826666 90.89706666C691.26826666 71.23626666 675.83999999 55.46666666 657.06666666 55.46666666 638.29333333 55.33013333 622.93333333 71.30453333 622.93333333 90.8288l0 270.60906666c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 362.32533333 622.93333333 362.53013333 622.93333333 362.73493333 622.93333333 371.54133333 626.61973333 379.392 632.28586666 385.39946666c0.34133333 0.34133333 0.47786667 0.8192 0.8192 1.09226667 1.09226667 1.09226667 2.59413333 1.77493333 3.8912 2.73066667C642.66239999 393.65973333 649.42079999 396.8 657.13493333 396.8c0.2048 0 0.34133333-0.06826667 0.54613333-0.06826667S658.09066666 396.8 658.29546666 396.8l270.5408 0C948.56533333 396.8 964.26666666 381.50826666 964.26666666 362.66666666 964.40319999 343.89333333 948.42879999 328.53333333 928.90453333 328.53333333zM418.13333333 635.73333333c0-8.8064-3.6864-16.5888-9.35253334-22.66453333C408.43946666 612.72746666 408.30293333 612.2496 408.02986666 611.90826666 406.86933333 610.88426666 405.43573333 610.2016 404.20693333 609.24586666 398.47253333 604.80853333 391.64586666 601.6 383.93173333 601.6 383.72693333 601.6 383.59039999 601.73653333 383.38559999 601.73653333S382.97599999 601.6 382.77119999 601.6L112.29866666 601.6C92.50133333 601.6 76.79999999 616.96 76.79999999 635.73333333 76.66346666 654.50666666 92.63786666 669.86666666 112.16213333 669.86666666l189.44 0-214.15253334 214.15253334c-13.85813333 13.85813333-14.19946667 35.84-0.88746666 49.22026666 13.17546667 13.44853333 35.36213333 12.9024 49.152-0.95573333l214.08426666-214.08426667 0 189.37173334c0 19.59253333 15.42826667 35.49866667 34.2016 35.36213333C402.77333333 943.2064 418.13333333 927.232 418.13333333 907.5712L418.13333333 637.09866666c0-0.27306667-0.13653333-0.47786667-0.13653334-0.68266666C417.99679999 636.14293333 418.13333333 635.93813333 418.13333333 635.73333333zM739.46453333 669.86666666l189.44 0c19.456 0 35.49866667-15.36 35.36213333-34.13333333C964.26666666 616.96 948.56533333 601.6 928.76799999 601.6L658.29546666 601.6C658.09066666 601.6 657.88586666 601.73653333 657.68106666 601.73653333S657.33973333 601.6 657.13493333 601.6C649.42079999 601.6 642.59413333 604.80853333 636.85973333 609.24586666 635.63093333 610.2016 634.19733333 610.88426666 633.03679999 611.90826666 632.76373333 612.2496 632.62719999 612.72746666 632.28586666 613.0688 626.61973333 619.14453333 622.93333333 626.92693333 622.93333333 635.73333333c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 636.6208 622.93333333 636.8256 622.93333333 637.09866666l0 270.5408C622.93333333 927.232 638.29333333 943.2064 657.06666666 942.93333333c18.77333333 0.13653333 34.2016-15.70133333 34.2016-35.36213333l0-189.37173334 214.08426667 214.08426667c13.78986667 13.85813333 35.90826667 14.40426667 49.152 0.95573333 13.312-13.312 12.97066667-35.36213333-0.88746667-49.22026666L739.46453333 669.86666666z"  ></path></symbol>
    <symbol id="request-fullscreen" viewBox="0 0 1024 1024">
      <path d="M69.818182 87.598545v273.128728a34.909091 34.909091 0 0 0 69.818182 0V163.653818l221.928727 222.021818a33.512727 33.512727 0 0 0 47.383273-47.383272L186.926545 116.363636h197.073455a34.909091 34.909091 0 0 0 0-69.818181H110.871273C85.364364 46.545455 69.818182 59.671273 69.818182 87.598545zM938.542545 46.545455H665.413818a34.909091 34.909091 0 0 0 0 69.818181h197.073455L640.465455 338.292364a33.512727 33.512727 0 0 0 47.383272 47.383272l221.928728-222.021818v197.073455a34.909091 34.909091 0 0 0 69.818181 0V87.598545c0-27.927273-15.453091-41.053091-40.96-41.05309z m-827.671272 907.636363h273.128727a34.909091 34.909091 0 0 0 0-69.818182H186.926545l222.021819-221.928727a33.512727 33.512727 0 0 0-47.383273-47.383273L139.636364 837.073455V640a34.909091 34.909091 0 0 0-69.818182 0v273.128727c0 27.927273 15.546182 41.053091 41.053091 41.053091z m868.724363-41.053091V640a34.909091 34.909091 0 0 0-69.818181 0v197.073455L687.941818 615.051636a33.512727 33.512727 0 0 0-47.383273 47.383273L862.487273 884.363636H665.413818a34.909091 34.909091 0 0 0 0 69.818182h273.128727c25.6 0 41.053091-13.125818 41.053091-41.053091z"  ></path></symbol>
  </svg>
`;var Zi=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class Qn extends X{constructor(t,e){super(t,Object.assign({},Qn.defaultOptions,e)),this.$element=ge("toolbar",!1),this.onToolbarItemClick=s=>{const{onClick:o}=this.options;if(s.target instanceof Element&&s.target.className.includes("g6-toolbar-item")){const r=s.target.getAttribute("value");o==null||o(r,s.target)}};const n=this.context.canvas.getContainer();this.$element.style.display="flex",n.appendChild(this.$element),Ms("g6-toolbar-css","style",{},vd,document.head),Ms("g6-toolbar-svgicon","div",{display:"none"},bd),this.$element.addEventListener("click",this.onToolbarItemClick),this.update(e)}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Zi(this,void 0,void 0,function*(){e.update.call(this,t);const{className:n,position:s,style:o}=this.options;this.$element.className=`g6-toolbar ${n||""}`,Object.assign(this.$element.style,o,md(s)),this.$element.innerHTML=yield this.getDOMContent()})}destroy(){this.$element.removeEventListener("click",this.onToolbarItemClick),this.$element.remove(),super.destroy()}getDOMContent(){return Zi(this,void 0,void 0,function*(){return(yield this.options.getItems()).map(e=>{var n;return`
          <div class="g6-toolbar-item" value="${e.value}" title="${(n=e.title)!==null&&n!==void 0?n:""}">
            <svg aria-hidden="true" focusable="false">
              <use xlink:href="#${e.id}"></use>
            </svg>
          </div>`}).join("")})}}Qn.defaultOptions={position:"top-left"};var qi=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class Jn extends X{constructor(t,e){super(t,Object.assign({},Jn.defaultOptions,e)),this.currentTarget=null,this.tooltipElement=null,this.container=null,this.isEnable=(n,s)=>{const{enable:o}=this.options;return typeof o=="function"?o(n,s):o},this.onClick=n=>{const{target:{id:s}}=n;this.currentTarget===s?this.hide(n):this.show(n)},this.onPointerMove=n=>{const{target:s}=n;!this.currentTarget||s.id===this.currentTarget||this.show(n)},this.onPointerLeave=n=>{this.hide(n)},this.onCanvasMove=n=>{this.hide(n)},this.onPointerEnter=n=>{this.show(n)},this.showById=n=>qi(this,void 0,void 0,function*(){const s={target:{id:n}};yield this.show(s)}),this.getElementData=(n,s)=>{const{model:o}=this.context;switch(s){case"node":return o.getNodeData([n]);case"edge":return o.getEdgeData([n]);case"combo":return o.getComboData([n]);default:return[]}},this.show=n=>qi(this,void 0,void 0,function*(){var s,o;const{client:r,target:{id:a}}=n;if(Dn(n.target))return;const c=this.context.graph.getElementType(a),{getContent:l,title:d}=this.options,h=this.getElementData(a,c);if(!this.tooltipElement||!this.isEnable(n,h))return;let u={};if(l){if(u.content=yield l(n,h),!u.content)return}else{const p=this.context.graph.getElementRenderStyle(a),y=c==="node"?p.fill:p.stroke;u={title:d||c,data:h.map(m=>({name:"ID",value:m.id||`${m.source} -> ${m.target}`,color:y}))}}this.currentTarget=a;let f,g;if(r)f=r.x,g=r.y;else{const p=tt(h,"0.style",{x:0,y:0});f=p.x,g=p.y}(o=(s=this.options).onOpenChange)===null||o===void 0||o.call(s,!0),this.tooltipElement.update(Object.assign(Object.assign(Object.assign({},this.tooltipStyleProps),{x:f,y:g,style:{".tooltip":{visibility:"visible"}}}),u))}),this.hide=n=>{var s,o,r,a,c;if(!n){(o=(s=this.options).onOpenChange)===null||o===void 0||o.call(s,!1),(r=this.tooltipElement)===null||r===void 0||r.hide(),this.currentTarget=null;return}if(!this.tooltipElement||!this.currentTarget)return;const{client:{x:l,y:d}}=n;(c=(a=this.options).onOpenChange)===null||c===void 0||c.call(a,!1),this.tooltipElement.hide(l,d),this.currentTarget=null},this.initTooltip=()=>{var n;const s=new _r({className:"tooltip",style:this.tooltipStyleProps});return(n=this.container)===null||n===void 0||n.appendChild(s.HTMLTooltipElement),s},this.render(),this.bindEvents()}getEvents(){return this.options.trigger==="click"?{"node:click":this.onClick,"edge:click":this.onClick,"combo:click":this.onClick,"canvas:click":this.onPointerLeave,contextmenu:this.onPointerLeave,drag:this.onPointerLeave}:{"node:pointerenter":this.onPointerEnter,"node:pointermove":this.onPointerMove,"canvas:pointermove":this.onCanvasMove,"edge:pointerenter":this.onPointerEnter,"edge:pointermove":this.onPointerMove,"combo:pointerenter":this.onPointerEnter,"combo:pointermove":this.onPointerMove,contextmenu:this.onPointerLeave,"node:drag":this.onPointerLeave}}update(t){var e;this.unbindEvents(),super.update(t),this.tooltipElement&&((e=this.container)===null||e===void 0||e.removeChild(this.tooltipElement.HTMLTooltipElement)),this.tooltipElement=this.initTooltip(),this.bindEvents()}render(){const{canvas:t}=this.context,e=t.getContainer();e&&(this.container=e,this.tooltipElement=this.initTooltip())}unbindEvents(){const{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach(n=>{t.off(n,e[n])})}bindEvents(){const{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach(n=>{t.on(n,e[n])})}get tooltipStyleProps(){const{canvas:t}=this.context,{center:e}=t.getBounds(),n=t.getContainer(),{top:s,left:o}=n.getBoundingClientRect(),{style:r,position:a,enterable:c,container:l={x:-o,y:-s},title:d,offset:h}=this.options,[u,f]=e,[g,p]=t.getSize();return{x:u,y:f,container:l,title:d,bounding:{x:0,y:0,width:g,height:p},position:a,enterable:c,offset:h,style:r}}destroy(){var t;this.unbindEvents(),this.tooltipElement&&((t=this.container)===null||t===void 0||t.removeChild(this.tooltipElement.HTMLTooltipElement)),super.destroy()}}Jn.defaultOptions={trigger:"hover",position:"top-right",enterable:!1,enable:!0,offset:[10,10],style:{".tooltip":{visibility:"hidden"}}};var lr=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};let ne;function dr(i,t){return ne||(ne=document.createElement("canvas")),ne.width=i,ne.height=t,ne.getContext("2d").clearRect(0,0,i,t),ne}function Ed(i,t,e,n){return lr(this,void 0,void 0,function*(){const s=dr(i,t),o=s.getContext("2d"),{rotate:r,opacity:a,textFill:c,textFontSize:l,textFontFamily:d,textFontVariant:h,textFontWeight:u,textAlign:f,textBaseline:g}=n;return o.textAlign=f,o.textBaseline=g,o.translate(i/2,t/2),o.font=`${l}px ${d} ${h} ${u}`,r&&o.rotate(r),a&&(o.globalAlpha=a),c&&(o.fillStyle=c,o.fillText(`${e}`,0,0)),s.toDataURL()})}function xd(i,t,e,n){return lr(this,void 0,void 0,function*(){const s=dr(i,t),o=s.getContext("2d"),{rotate:r,opacity:a}=n;r&&o.rotate(r),a&&(o.globalAlpha=a);const c=new Image;return c.crossOrigin="anonymous",c.src=e,new Promise(l=>{c.onload=function(){const d=i>c.width?(i-c.width)/2:0,h=t>c.height?(t-c.height)/2:0;o.drawImage(c,0,0,c.width,c.height,d,h,i-d*2,t-h*2),l(s.toDataURL())}})})}var Sd=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})},Od=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class ts extends X{constructor(t,e){super(t,Object.assign({},ts.defaultOptions,e)),this.$element=ge("watermark"),this.context.canvas.getContainer().appendChild(this.$element),this.update(e)}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Sd(this,void 0,void 0,function*(){e.update.call(this,t);const n=this.options,{width:s,height:o,text:r,imageURL:a}=n,c=Od(n,["width","height","text","imageURL"]);Object.keys(c).forEach(d=>{d.startsWith("background")&&(this.$element.style[d]=t[d])});const l=a?yield xd(s,o,a,c):yield Ed(s,o,r,c);this.$element.style.backgroundImage=`url(${l})`})}destroy(){super.destroy(),this.$element.remove()}}ts.defaultOptions={width:200,height:100,opacity:.2,rotate:Math.PI/12,text:"",textFill:"#000",textFontSize:16,textAlign:"center",textBaseline:"middle",backgroundRepeat:"repeat"};const Dd=["#7E92B5","#F4664A","#FFBE3A"],wd={type:"group",color:["#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]},Cd={type:"group",color:["#99ADD1","#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]};function hr(i){const{bgColor:t,textColor:e,nodeColor:n,nodeColorDisabled:s,nodeStroke:o,nodeHaloStrokeOpacityActive:r=.15,nodeHaloStrokeOpacitySelected:a=.25,nodeOpacityDisabled:c=.06,nodeIconOpacityInactive:l=.85,nodeOpacityInactive:d=.25,nodeBadgePalette:h=Dd,nodePaletteOptions:u=wd,edgeColor:f,edgeColorDisabled:g,edgePaletteOptions:p=Cd,comboColor:y,comboColorDisabled:m,comboStroke:E,comboStrokeDisabled:b,edgeColorInactive:S}=i;return{background:t,node:{palette:u,style:{donutOpacity:1,badgeBackgroundOpacity:1,badgeFill:"#fff",badgeFontSize:8,badgePadding:[0,4],badgePalette:h,fill:n,fillOpacity:1,halo:!1,iconFill:"#fff",iconOpacity:1,labelBackground:!1,labelBackgroundFill:t,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelFill:e,labelFillOpacity:.85,labelLineHeight:16,labelPadding:[0,2],labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelOffsetY:2,lineWidth:0,portFill:n,portLineWidth:1,portStroke:o,portStrokeOpacity:.65,size:32,stroke:o,strokeOpacity:1,zIndex:2},state:{selected:{halo:!0,haloLineWidth:24,haloStrokeOpacity:a,labelFontSize:12,labelFontWeight:"bold",lineWidth:4,stroke:o},active:{halo:!0,haloLineWidth:12,haloStrokeOpacity:r},highlight:{labelFontWeight:"bold",lineWidth:4,stroke:o,strokeOpacity:.85},inactive:{badgeBackgroundOpacity:d,donutOpacity:d,fillOpacity:d,iconOpacity:l,labelFill:e,labelFillOpacity:d,strokeOpacity:d},disabled:{badgeBackgroundOpacity:.25,donutOpacity:c,fill:s,fillOpacity:c,iconFill:s,iconOpacity:.25,labelFill:e,labelFillOpacity:.25,strokeOpacity:c}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"node-expand",collapse:"node-collapse",update:[{fields:["x","y","fill","stroke"]}],translate:[{fields:["x","y"]}]}},edge:{palette:p,style:{badgeBackgroundFill:f,badgeFill:"#fff",badgeFontSize:8,badgeOffsetX:10,fillOpacity:1,halo:!1,haloLineWidth:12,haloStrokeOpacity:1,increasedLineWidthForHitTesting:2,labelBackground:!1,labelBackgroundFill:t,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[4,4,4,4],labelFill:e,labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelPlacement:"center",labelTextBaseline:"middle",lineWidth:1,stroke:f,strokeOpacity:1,zIndex:1},state:{selected:{halo:!0,haloStrokeOpacity:.25,labelFontSize:14,labelFontWeight:"bold",lineWidth:3},active:{halo:!0,haloStrokeOpacity:.15},highlight:{labelFontWeight:"bold",lineWidth:3},inactive:{stroke:S,fillOpacity:.08,labelOpacity:.25,strokeOpacity:.08,badgeBackgroundOpacity:.25},disabled:{stroke:g,fillOpacity:.45,strokeOpacity:.45,labelOpacity:.25,badgeBackgroundOpacity:.45}},animation:{enter:"fade",exit:"fade",expand:"path-in",collapse:"path-out",show:"fade",hide:"fade",update:[{fields:["sourceNode","targetNode"]},{fields:["stroke"],shape:"key"}],translate:[{fields:["sourceNode","targetNode"]}]}},combo:{style:{collapsedMarkerFill:t,collapsedMarkerFontSize:12,collapsedMarkerFillOpacity:1,collapsedSize:32,collapsedFillOpacity:1,fill:y,halo:!1,haloLineWidth:12,haloStroke:E,haloStrokeOpacity:.25,labelBackground:!1,labelBackgroundFill:t,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[2,4,2,4],labelFill:e,labelFontSize:12,labelFontWeight:400,labelOpacity:1,lineDash:0,lineWidth:1,fillOpacity:.04,strokeOpacity:1,padding:10,stroke:E},state:{selected:{halo:!0,labelFontSize:14,labelFontWeight:700,lineWidth:4},active:{halo:!0},highlight:{labelFontWeight:700,lineWidth:4},inactive:{fillOpacity:.65,labelOpacity:.25,strokeOpacity:.65},disabled:{fill:m,fillOpacity:.25,labelOpacity:.25,stroke:b,strokeOpacity:.25}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"combo-expand",collapse:"combo-collapse",update:[{fields:["x","y"]},{fields:["fill","stroke","lineWidth"],shape:"key"}],translate:[{fields:["x","y"]}]}}}}const _d={type:"group",color:["#637088","#0F55A6","#008383","#9C5D38","#8B53A6","#4E40A6","#8F6608","#3E801D","#A65383","#175E75","#0F8248"]},Td={bgColor:"#000000",comboColor:"#fdfdfd",comboColorDisabled:"#d0e4ff",comboStroke:"#99add1",comboStrokeDisabled:"#969696",edgeColor:"#637088",edgeColorDisabled:"#637088",edgeColorInactive:"#D0E4FF",edgePaletteOptions:_d,nodeColor:"#1783ff",nodeColorDisabled:"#D0E4FF",nodeHaloStrokeOpacityActive:.25,nodeHaloStrokeOpacitySelected:.45,nodeIconOpacityInactive:.45,nodeOpacityDisabled:.25,nodeOpacityInactive:.45,nodeStroke:"#d0e4ff",textColor:"#ffffff"},Ad=hr(Td),Md={bgColor:"#ffffff",comboColor:"#99ADD1",comboColorDisabled:"#f0f0f0",comboStroke:"#99add1",comboStrokeDisabled:"#d9d9d9",edgeColor:"#99add1",edgeColorDisabled:"#d9d9d9",edgeColorInactive:"#1B324F",nodeColor:"#1783ff",nodeColorDisabled:"#1B324F",nodeHaloStrokeOpacityActive:.15,nodeHaloStrokeOpacitySelected:.25,nodeIconOpacityInactive:.85,nodeOpacityDisabled:.06,nodeOpacityInactive:.25,nodeStroke:"#000000",textColor:"#000000"},Pd=hr(Md);class Wt extends Bs{beforeDraw(t,e){return t}afterLayout(t,e){}}class Rd extends Wt{beforeDraw(t){const{model:e}=this.context,n=t.add.combos,s=o=>{const r=[];return o.forEach((a,c)=>{const d=e.getAncestorsData(c,"combo").map(h=>v(h)).reverse();r.push([c,a,d.length])}),new Map(r.sort(([,,a],[,,c])=>c-a).map(([a,c])=>[a,c]))};return t.add.combos=s(n),t.update.combos=s(t.update.combos),t}}function et(i,t,e,n,s){const o=v(n),r=`${e}s`,a=s?n:i.add[r].get(o)||i.update[r].get(o)||i.remove[r].get(o)||n;Object.entries(i).forEach(([c,l])=>{t===c?l[r].set(o,a):l[r].delete(o)})}function Ge(i,t){return Object.keys(i).every(e=>i[e]===t[e])}class Ld extends Wt{beforeDraw(t,e){if(e.stage==="visibility"||!this.context.model.model.hasTreeStructure(R))return t;const{model:n}=this.context,{add:s,update:o}=t,r=[...t.update.combos.entries(),...t.add.combos.entries()];for(;r.length;){const[a,c]=r.pop();if(Q(c)){const l=n.getDescendantsData(a),d=l.map(v),{internal:h,external:u}=_s(d,f=>n.getRelatedEdgesData(f));l.forEach(f=>{const g=v(f),p=r.findIndex(([m])=>m===g);p!==-1&&r.splice(p,1);const y=n.getElementType(g);et(t,"remove",y,f)}),h.forEach(f=>et(t,"remove","edge",f)),u.forEach(f=>{var g;const p=v(f);((g=this.context.element)===null||g===void 0?void 0:g.getElement(p))?o.edges.set(p,f):s.edges.set(p,f)})}else{const l=n.getChildrenData(a),d=l.map(v),{edges:h}=_s(d,u=>n.getRelatedEdgesData(u));[...l,...h].forEach(u=>{var f;const g=v(u),p=n.getElementType(g);((f=this.context.element)===null||f===void 0?void 0:f.getElement(g))?et(t,"update",p,u):et(t,"add",p,u),p==="combo"&&r.push([g,u])})}}return t}}const Qi=(i,t,e,n)=>{const s=`${e}s`,o=v(n);!i.add[s].has(o)&&!i.update[s].has(o)&&i[t][s].set(v(n),n)};class Nd extends Wt{getElement(t){return this.context.element.getElement(t)}handleExpand(t,e){if(Qi(e,"add","node",t),Q(t))return;const n=v(t);Qi(e,"add","node",t),this.context.model.getRelatedEdgesData(n,"out").forEach(r=>{et(e,"add","edge",r)}),this.context.model.getChildrenData(n).forEach(r=>{this.handleExpand(r,e)})}beforeDraw(t){const{graph:e,model:n}=this.context;if(!n.model.hasTreeStructure(J))return t;const{add:{nodes:s,edges:o},update:{nodes:r}}=t,a=new Map,c=new Map;s.forEach((d,h)=>{Q(d)&&a.set(h,d)}),o.forEach(d=>{if(e.getElementType(d.source)!=="node")return;const h=e.getNodeData(d.source);Q(h)&&a.set(d.source,h)}),r.forEach((d,h)=>{const u=this.getElement(h);if(!u)return;const f=u.attributes.collapsed;Q(d)?f||a.set(h,d):f&&c.set(h,d)});const l=new Set;return a.forEach((d,h)=>{n.getDescendantsData(h).forEach(f=>{const g=v(f);if(l.has(g))return;et(t,"remove","node",f),n.getRelatedEdgesData(g).forEach(y=>{et(t,"remove","edge",y)}),l.add(g)})}),c.forEach((d,h)=>{if(n.getAncestorsData(h,J).some(Q)){et(t,"remove","node",d);return}this.handleExpand(d,t)}),t}}function Id(i,t,e,n=!1){const s=xs[i][t];!n&&s?s!==e&&yt.warn(`The extension ${t} of ${i} has been registered before.`):Object.assign(xs[i],{[t]:e})}var Ji=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})},to=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};const eo=["main"],no=["background","main","label","transient"];function kd(i){return i.main}class so{getConfig(){return this.config}getLayer(t="main"){return this.extends.layers[t]||kd(this.getLayers())}getLayers(){return this.extends.layers}getRenderer(t){return this.extends.renderers[t]}getCamera(t="main"){return this.getLayer(t).getCamera()}getRoot(t="main"){return this.getLayer(t).getRoot()}getContextService(t="main"){return this.getLayer(t).getContextService()}setCursor(t){this.config.cursor=t,this.getLayer().setCursor(t)}get document(){return this.getLayer().document}get context(){return this.getLayer().context}constructor(t){this.config={enableMultiLayer:!0},Object.assign(this.config,t);const e=this.config,{renderer:n,background:s,cursor:o,enableMultiLayer:r}=e,a=to(e,["renderer","background","cursor","enableMultiLayer"]),c=r?no:eo,l=io(n,c),d=Object.fromEntries(c.map(h=>{const u=new bs(Object.assign(Object.assign({},a),{supportsMutipleCanvasesInOneContainer:r,renderer:l[h],background:r?h==="background"?s:void 0:s}));return[h,u]}));oo(d),this.extends={config:this.config,renderer:n,renderers:l,layers:d}}get ready(){return Promise.all(Object.entries(this.getLayers()).map(([,t])=>t.ready))}resize(t,e){Object.assign(this.extends.config,{width:t,height:e}),Object.values(this.getLayers()).forEach(n=>{const s=n.getCamera(),o=s.getPosition(),r=s.getFocalPoint();n.resize(t,e),s.setPosition(o),s.setFocalPoint(r)})}getBounds(t){return Ae(Object.values(this.getLayers()).map(e=>t?e.getRoot().childNodes.find(s=>s.classList.includes(t)):e.getRoot()).filter(e=>(e==null?void 0:e.childNodes.length)>0).map(e=>e.getBounds()))}getContainer(){const t=this.extends.config.container;return typeof t=="string"?document.getElementById(t):t}getSize(){return[this.extends.config.width||0,this.extends.config.height||0]}appendChild(t,e){var n;const s=((n=t.style)===null||n===void 0?void 0:n.$layer)||"main";return this.getLayer(s).appendChild(t,e)}setRenderer(t){if(t===this.extends.renderer)return;const e=io(t,this.config.enableMultiLayer?no:eo);this.extends.renderers=e,Object.entries(e).forEach(([n,s])=>this.getLayer(n).setRenderer(s)),oo(this.getLayers())}getCanvasByViewport(t){return K(this.getLayer().viewport2Canvas(dt(t)))}getViewportByCanvas(t){return K(this.getLayer().canvas2Viewport(dt(t)))}getViewportByClient(t){return K(this.getLayer().client2Viewport(dt(t)))}getClientByViewport(t){return K(this.getLayer().viewport2Client(dt(t)))}getClientByCanvas(t){return this.getClientByViewport(this.getViewportByCanvas(t))}getCanvasByClient(t){const e=this.getLayer(),n=e.client2Viewport(dt(t));return K(e.viewport2Canvas(n))}toDataURL(){return Ji(this,arguments,void 0,function*(t={}){const e=globalThis.devicePixelRatio||1,{mode:n="viewport"}=t,s=to(t,["mode"]);let[o,r,a,c]=[0,0,0,0];if(n==="viewport")[a,c]=this.getSize();else if(n==="overall"){const m=this.getBounds(),E=jt(m);[o,r]=m.min,[a,c]=E}const l=Tr('<div id="virtual-image"></div>'),d=new bs({width:a,height:c,renderer:new xe,devicePixelRatio:e,container:l,background:this.extends.config.background});yield d.ready,d.appendChild(this.getLayer("background").getRoot().cloneNode(!0)),d.appendChild(this.getRoot().cloneNode(!0));const h=this.getLayer("label").getRoot().cloneNode(!0),u=d.viewport2Canvas({x:0,y:0}),f=this.getCanvasByViewport([0,0]);h.translate([f[0]-u.x,f[1]-u.y]),h.scale(1/this.getCamera().getZoom()),d.appendChild(h),d.appendChild(this.getLayer("transient").getRoot().cloneNode(!0));const g=this.getCamera(),p=d.getCamera();if(n==="viewport")p.setZoom(g.getZoom()),p.setPosition(g.getPosition()),p.setFocalPoint(g.getFocalPoint());else if(n==="overall"){const[m,E,b]=p.getPosition(),[S,D,w]=p.getFocalPoint();p.setPosition([m+o,E+r,b]),p.setFocalPoint([S+o,D+r,w])}const y=d.getContextService();return new Promise(m=>{d.addEventListener(Ar.RERENDER,()=>Ji(this,void 0,void 0,function*(){yield new Promise(b=>setTimeout(b,300));const E=yield y.toDataURL(s);m(E)}))})})}destroy(){Object.values(this.getLayers()).forEach(t=>{t.getCamera().cancelLandmarkAnimation(),t.destroy()})}}function io(i,t){return Object.fromEntries(t.map(e=>{const n=(i==null?void 0:i(e))||new xe;return n instanceof xe&&n.setConfig({enableDirtyRectangleRendering:!1}),e==="main"?n.registerPlugin(new Mr({isDocumentDraggable:!0,isDocumentDroppable:!0,dragstartDistanceThreshold:10,dragstartTimeThreshold:100})):n.unregisterPlugin(n.getPlugin("dom-interaction")),[e,n]}))}function oo(i){Object.entries(i).forEach(([t,e])=>{const n=e.getContextService().getDomElement();n!=null&&n.style&&(n.style.gridArea="1 / 1 / 2 / 2",n.style.outline="none",n.tabIndex=1,t!=="main"&&(n.style.pointerEvents="none")),n!=null&&n.parentElement&&(n.parentElement.style.display="grid")})}const se=i=>i?parseInt(i):0;function Bd(i){const t=getComputedStyle(i),e=i.clientWidth||se(t.width),n=i.clientHeight||se(t.height),s=se(t.paddingLeft)+se(t.paddingRight),o=se(t.paddingTop)+se(t.paddingBottom);return[e-s,n-o]}function ro(i){if(!i)return[0,0];let t=640,e=480;const[n,s]=Bd(i);t=n||t,e=s||e;const o=1,r=1;return[Math.max(U(t)?t:o,o),Math.max(U(e)?e:r,r)]}class es{constructor(t){this.type=t}}class z extends es{constructor(t,e){super(t),this.data=e}}class ot extends es{constructor(t,e,n,s){super(t),this.animationType=e,this.animation=n,this.data=s}}class ie extends es{constructor(t,e,n){super(t),this.elementType=e,this.data=n}}class He extends es{constructor(t,e){super(t),this.data=e}}function W(i,t){i.emit(t.type,t)}function jd(i){if(!i)return null;if(i instanceof Pr)return{type:"canvas",element:i};let t=i;for(;t;){if(Le(t))return{type:"node",element:t};if(ir(t))return{type:"edge",element:t};if(Us(t))return{type:"combo",element:t};t=t.parentElement}return null}function ao(i){var t;return((t=i==null?void 0:i.style)===null||t===void 0?void 0:t.zIndex)||0}const Ee="cachedStyle",Zs=i=>`__${i}__`;function zd(i,t){const e=Array.isArray(t)?t:[t];tt(i,Ee)||Qe(i,Ee,{}),e.forEach(n=>{Qe(tt(i,Ee),Zs(n),i.attributes[n])})}function co(i,t){return tt(i,[Ee,Zs(t)])}function Fd(i,t){return Zs(t)in(tt(i,Ee)||{})}class $d{constructor(t){this.tasks=[],this.animations=new Set,this.context=t}getTasks(){const t=[...this.tasks];return this.tasks=[],t}add(t,e){this.tasks.push([t,e])}animate(t,e,n){var s,o,r;(s=e==null?void 0:e.before)===null||s===void 0||s.call(e);const a=this.getTasks().map(([l,d])=>{var h,u,f;const{element:g,elementType:p,stage:y}=l,m=Jr(this.context.options,p,y,t);(h=d==null?void 0:d.before)===null||h===void 0||h.call(d);const E=m.length?ea(g,this.inferStyle(l,n),m):null;return E?((u=d==null?void 0:d.beforeAnimate)===null||u===void 0||u.call(d,E),E.finished.then(()=>{var b,S;(b=d==null?void 0:d.afterAnimate)===null||b===void 0||b.call(d,E),(S=d==null?void 0:d.after)===null||S===void 0||S.call(d),this.animations.delete(E)})):(f=d==null?void 0:d.after)===null||f===void 0||f.call(d),E}).filter(Boolean);a.forEach(l=>this.animations.add(l));const c=Ns(a);return c?((o=e==null?void 0:e.beforeAnimate)===null||o===void 0||o.call(e,c),c.finished.then(()=>{var l,d;(l=e==null?void 0:e.afterAnimate)===null||l===void 0||l.call(e,c),(d=e==null?void 0:e.after)===null||d===void 0||d.call(e),this.release()})):(r=e==null?void 0:e.after)===null||r===void 0||r.call(e),c}inferStyle(t,e){var n,s;const{element:o,elementType:r,stage:a,originalStyle:c,updatedStyle:l={}}=t;t.modifiedStyle||(t.modifiedStyle=Object.assign(Object.assign({},c),l));const{modifiedStyle:d}=t,h={},u={};if(a==="enter")Object.assign(h,{opacity:0});else if(a==="exit")Object.assign(u,{opacity:0});else if(a==="show")Object.assign(h,{opacity:0}),Object.assign(u,{opacity:(n=co(o,"opacity"))!==null&&n!==void 0?n:Oe("opacity")});else if(a==="hide")Object.assign(h,{opacity:(s=co(o,"opacity"))!==null&&s!==void 0?s:Oe("opacity")}),Object.assign(u,{opacity:0});else if(a==="collapse"){const{collapse:f}=e||{},{target:g,descendants:p,position:y}=f;if(r==="node"){if(p.includes(o.id)){const[m,E,b]=y;Object.assign(u,{x:m,y:E,z:b})}}else if(r==="combo"){if(o.id===g||p.includes(o.id)){const[m,E]=y;Object.assign(u,{x:m,y:E,childrenNode:c.childrenNode})}}else r==="edge"&&Object.assign(u,{sourceNode:d.sourceNode,targetNode:d.targetNode})}else if(a==="expand"){const{expand:f}=e||{},{target:g,descendants:p,position:y}=f;if(r==="node"){if(o.id===g||p.includes(o.id)){const[m,E,b]=y;Object.assign(h,{x:m,y:E,z:b})}}else if(r==="combo"){if(o.id===g||p.includes(o.id)){const[m,E,b]=y;Object.assign(h,{x:m,y:E,z:b,childrenNode:d.childrenNode})}}else r==="edge"&&Object.assign(h,{sourceNode:d.sourceNode,targetNode:d.targetNode})}return[Object.keys(h).length>0?Object.assign({},c,h):c,Object.keys(u).length>0?Object.assign({},d,u):d]}stop(){this.animations.forEach(t=>t.cancel())}clear(){this.tasks=[]}release(){var t,e;const{canvas:n}=this.context,s=(e=(t=n.document)===null||t===void 0?void 0:t.timeline)===null||e===void 0?void 0:e.animationsWithPromises;s&&(n.document.timeline.animationsWithPromises=s.filter(o=>o.playState!=="finished"))}destroy(){this.stop(),this.animations.clear(),this.tasks=[]}}class Wd{constructor(t){this.batchCount=0,this.context=t}emit(t){const{graph:e}=this.context;e.emit(t.type,t)}startBatch(t=!0){this.batchCount++,this.batchCount===1&&this.emit(new z(O.BATCH_START,{initiate:t}))}endBatch(){this.batchCount--,this.batchCount===0&&this.emit(new z(O.BATCH_END))}get isBatching(){return this.batchCount>0}destroy(){this.context=null}}class Vd extends ks{constructor(t){super(t),this.currentTarget=null,this.currentTargetType=null,this.category="behavior",this.forwardCanvasEvents=e=>{const{target:n}=e,s=jd(n);if(!s)return;const{graph:o,canvas:r}=this.context,{type:a,element:c}=s;if("destroyed"in c&&(Dn(c)||c.destroyed))return;const{type:l,detail:d,button:h}=e,u=Object.assign(Object.assign({},e),{target:c,targetType:a,originalTarget:n});l===x.POINTER_MOVE&&(this.currentTarget!==c&&(this.currentTarget&&o.emit(`${this.currentTargetType}:${x.POINTER_LEAVE}`,Object.assign(Object.assign({},u),{type:x.POINTER_LEAVE,target:this.currentTarget,targetType:this.currentTargetType})),c&&(Object.assign(u,{type:x.POINTER_ENTER}),o.emit(`${a}:${x.POINTER_ENTER}`,u))),this.currentTarget=c,this.currentTargetType=a),l===x.CLICK&&h===2||(o.emit(`${a}:${l}`,u),o.emit(l,u)),l===x.CLICK&&d===2&&(Object.assign(u,{type:x.DBLCLICK}),o.emit(`${a}:${x.DBLCLICK}`,u),o.emit(x.DBLCLICK,u)),l===x.POINTER_DOWN&&h===2&&(Object.assign(u,{type:x.CONTEXT_MENU,preventDefault:()=>{var f;(f=r.getContainer())===null||f===void 0||f.addEventListener(x.CONTEXT_MENU,g=>g.preventDefault(),{once:!0})}}),o.emit(`${a}:${x.CONTEXT_MENU}`,u),o.emit(x.CONTEXT_MENU,u))},this.forwardContainerEvents=e=>{this.context.graph.emit(e.type,e)},this.forwardEvents(),this.setBehaviors(this.context.options.behaviors||[])}setBehaviors(t){this.setExtensions(t)}forwardEvents(){const t=this.context.canvas.getContainer();t&&[ce.KEY_DOWN,ce.KEY_UP].forEach(n=>{t.addEventListener(n,this.forwardContainerEvents)});const e=this.context.canvas.document;e&&[x.CLICK,x.DBLCLICK,x.POINTER_OVER,x.POINTER_LEAVE,x.POINTER_ENTER,x.POINTER_MOVE,x.POINTER_OUT,x.POINTER_DOWN,x.POINTER_UP,x.CONTEXT_MENU,x.DRAG_START,x.DRAG,x.DRAG_END,x.DRAG_ENTER,x.DRAG_OVER,x.DRAG_LEAVE,x.DROP,x.WHEEL].forEach(n=>{e.addEventListener(n,this.forwardCanvasEvents)})}destroy(){const t=this.context.canvas.getContainer();t&&[ce.KEY_DOWN,ce.KEY_UP].forEach(e=>{t.removeEventListener(e,this.forwardContainerEvents)}),this.context.canvas.document.removeAllEventListeners(),super.destroy()}}var _e=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};function Mt(i,t){const{data:e,style:n}=i,s=_e(i,["data","style"]),{data:o,style:r}=t,a=_e(t,["data","style"]),c=Object.assign(Object.assign({},s),a);return(e||o)&&Object.assign(c,{data:Object.assign(Object.assign({},e),o)}),(n||r)&&Object.assign(c,{style:Object.assign(Object.assign({},n),r)}),c}function ys(i){const{data:t,style:e}=i,s=_e(i,["data","style"]);return t&&(s.data=Object.assign({},t)),e&&(s.style=Object.assign({},e)),s}function oe(i={},t={}){const{states:e=[],data:n={},style:s={},children:o=[]}=i,r=_e(i,["states","data","style","children"]),{states:a=[],data:c={},style:l={},children:d=[]}=t,h=_e(t,["states","data","style","children"]),u=(g,p)=>g.length!==p.length?!1:g.every((y,m)=>y===p[m]),f=(g,p)=>{const y=Object.keys(g),m=Object.keys(p);return y.length!==m.length?!1:y.every(E=>g[E]===p[E])};return!(!f(r,h)||!u(o,d)||!u(e,a)||!f(n,c)||!f(s,l))}var Hd=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};function ms(i){const{id:t=v(i),style:e,data:n}=i,s=Hd(i,["id","style","data"]),o=Object.assign(Object.assign({},i),{style:Object.assign({},e),data:Object.assign({},n)});return aa(i)?Object.assign({id:t,data:o},s):{id:t,data:o}}function H(i){return i.data}function Ud(i){if(i.hasTreeStructure(J))return;i.attachTreeStructure(J);const t=i.getAllEdges();for(const e of t){const{source:n,target:s}=e;i.setParent(s,n,J)}}class Yd{constructor(){this.latestRemovedComboIds=new Set,this.comboIds=new Set,this.changes=[],this.batchCount=0,this.isTraceless=!1,this.enableUpdateNodeLikeHierarchy=!0,this.model=new Ls}pushChange(t){if(this.isTraceless)return;const{type:e}=t;if(e===I.NodeUpdated||e===I.EdgeUpdated||e===I.ComboUpdated){const{value:n,original:s}=t;this.changes.push({value:ys(n),original:ys(s),type:e})}else this.changes.push({value:ys(t.value),type:e})}getChanges(){return this.changes}clearChanges(){this.changes=[]}batch(t){this.batchCount++,this.model.batch(t),this.batchCount--}isBatching(){return this.batchCount>0}silence(t){this.isTraceless=!0,t(),this.isTraceless=!1}isCombo(t){return this.comboIds.has(t)||this.latestRemovedComboIds.has(t)}getData(){return{nodes:this.getNodeData(),edges:this.getEdgeData(),combos:this.getComboData()}}getNodeData(t){return this.model.getAllNodes().reduce((e,n)=>{const s=H(n);return this.isCombo(v(s))||(t===void 0||t.includes(v(s)))&&e.push(s),e},[])}getEdgeDatum(t){return H(this.model.getEdge(t))}getEdgeData(t){return this.model.getAllEdges().reduce((e,n)=>{const s=H(n);return(t===void 0||t.includes(v(s)))&&e.push(s),e},[])}getComboData(t){return this.model.getAllNodes().reduce((e,n)=>{const s=H(n);return this.isCombo(v(s))&&(t===void 0||t.includes(v(s)))&&e.push(s),e},[])}getRootsData(t=J){return this.model.getRoots(t).map(H)}getAncestorsData(t,e){const{model:n}=this;return!n.hasNode(t)||!n.hasTreeStructure(e)?[]:n.getAncestors(t,e).map(H)}getDescendantsData(t){const e=this.getElementDataById(t),n=[];return Kt(e,s=>{s!==e&&n.push(s)},s=>this.getChildrenData(v(s)),"TB"),n}getParentData(t,e){const{model:n}=this;if(!e){yt.warn("The hierarchy structure key is not specified");return}if(!n.hasNode(t)||!n.hasTreeStructure(e))return;const s=n.getParent(t,e);return s?H(s):void 0}getChildrenData(t){const e=this.getElementType(t)==="node"?J:R,{model:n}=this;return!n.hasNode(t)||!n.hasTreeStructure(e)?[]:n.getChildren(t,e).map(H)}getElementsDataByType(t){return t==="node"?this.getNodeData():t==="edge"?this.getEdgeData():t==="combo"?this.getComboData():[]}getElementDataById(t){return this.getElementType(t)==="edge"?this.getEdgeDatum(t):this.getNodeLikeDatum(t)}getNodeLikeDatum(t){const e=this.model.getNode(t);return H(e)}getNodeLikeData(t){return this.model.getAllNodes().reduce((e,n)=>{const s=H(n);return t?t.includes(v(s))&&e.push(s):e.push(s),e},[])}getElementDataByState(t,e){return this.getElementsDataByType(t).filter(s=>{var o;return(o=s.states)===null||o===void 0?void 0:o.includes(e)})}getElementState(t){var e;return((e=this.getElementDataById(t))===null||e===void 0?void 0:e.states)||[]}hasNode(t){return this.model.hasNode(t)&&!this.isCombo(t)}hasEdge(t){return this.model.hasEdge(t)}hasCombo(t){return this.model.hasNode(t)&&this.isCombo(t)}getRelatedEdgesData(t,e="both"){return this.model.getRelatedEdges(t,e).map(H)}getNeighborNodesData(t){return this.model.getNeighbors(t).map(H)}setData(t){const{nodes:e=[],edges:n=[],combos:s=[]}=t,{nodes:o,edges:r,combos:a}=this.getData(),c=It(o,e,h=>v(h),oe),l=It(r,n,h=>v(h),oe),d=It(a,s,h=>v(h),oe);this.batch(()=>{const h={nodes:c.enter,edges:l.enter,combos:d.enter};this.addData(h),this.computeZIndex(h,"add",!0);const u={nodes:c.update,edges:l.update,combos:d.update};this.updateData(u),this.computeZIndex(u,"update",!0);const f={nodes:c.exit.map(v),edges:l.exit.map(v),combos:d.exit.map(v)};this.removeData(f)})}addData(t){const{nodes:e,edges:n,combos:s}=t;this.batch(()=>{this.addComboData(s),this.addNodeData(e),this.addEdgeData(n)}),this.computeZIndex(t,"add")}addNodeData(t=[]){t.length&&(this.model.addNodes(t.map(e=>(this.pushChange({value:e,type:I.NodeAdded}),ms(e)))),this.updateNodeLikeHierarchy(t),this.computeZIndex({nodes:t},"add"))}addEdgeData(t=[]){t.length&&(this.model.addEdges(t.map(e=>(this.pushChange({value:e,type:I.EdgeAdded}),ms(e)))),this.computeZIndex({edges:t},"add"))}addComboData(t=[]){if(!t.length)return;const{model:e}=this;e.hasTreeStructure(R)||e.attachTreeStructure(R),e.addNodes(t.map(n=>(this.comboIds.add(v(n)),this.pushChange({value:n,type:I.ComboAdded}),ms(n)))),this.updateNodeLikeHierarchy(t),this.computeZIndex({combos:t},"add")}addChildrenData(t,e){const n=this.getNodeLikeDatum(t),s=e.map(v);this.addNodeData(e),this.updateNodeData([{id:t,children:[...n.children||[],...s]}]),this.addEdgeData(s.map(o=>({source:t,target:o})))}computeZIndex(t,e,n=!1){!n&&this.isBatching()||this.batch(()=>{const{nodes:s=[],edges:o=[],combos:r=[]}=t;r.forEach(a=>{var c,l,d;const h=v(a);if(e==="add"&&U((c=a.style)===null||c===void 0?void 0:c.zIndex)||e==="update"&&!("combo"in a))return;const u=this.getParentData(h,R),f=u?((d=(l=u.style)===null||l===void 0?void 0:l.zIndex)!==null&&d!==void 0?d:0)+1:0;this.preventUpdateNodeLikeHierarchy(()=>{this.updateComboData([{id:h,style:{zIndex:f}}])})}),s.forEach(a=>{var c,l,d;const h=v(a);if(e==="add"&&U((c=a.style)===null||c===void 0?void 0:c.zIndex)||e==="update"&&!("combo"in a)&&!("children"in a))return;let u=0;const f=this.getParentData(h,R);if(f)u=(((l=f.style)===null||l===void 0?void 0:l.zIndex)||0)+1;else{const g=this.getParentData(h,J);g&&(u=((d=g==null?void 0:g.style)===null||d===void 0?void 0:d.zIndex)||0)}this.preventUpdateNodeLikeHierarchy(()=>{this.updateNodeData([{id:h,style:{zIndex:u}}])})}),o.forEach(a=>{var c,l,d,h,u;if(U((c=a.style)===null||c===void 0?void 0:c.zIndex))return;let{id:f,source:g,target:p}=a;if(!f)f=v(a);else{const E=this.getEdgeDatum(f);g=E.source,p=E.target}if(!g||!p)return;const y=((d=(l=this.getNodeLikeDatum(g))===null||l===void 0?void 0:l.style)===null||d===void 0?void 0:d.zIndex)||0,m=((u=(h=this.getNodeLikeDatum(p))===null||h===void 0?void 0:h.style)===null||u===void 0?void 0:u.zIndex)||0;this.updateEdgeData([{id:v(a),style:{zIndex:Math.max(y,m)-1}}])})})}getFrontZIndex(t){var e;const n=this.getElementType(t),s=this.getElementDataById(t),o=this.getData();if(Object.assign(o,{[`${n}s`]:o[`${n}s`].filter(r=>v(r)!==t)}),n==="combo"&&!Q(s)){const r=new Set(this.getAncestorsData(t,R).map(v));o.nodes=o.nodes.filter(a=>!r.has(v(a))),o.combos=o.combos.filter(a=>!r.has(v(a))),o.edges=o.edges.filter(({source:a,target:c})=>!r.has(a)&&!r.has(c))}return Math.max(((e=s.style)===null||e===void 0?void 0:e.zIndex)||0,0,...Object.values(o).flat().map(r=>{var a;return(((a=r==null?void 0:r.style)===null||a===void 0?void 0:a.zIndex)||0)+1}))}updateNodeLikeHierarchy(t){if(!this.enableUpdateNodeLikeHierarchy)return;const{model:e}=this;t.forEach(n=>{const s=v(n),o=Be(n);o!==void 0&&(e.hasTreeStructure(R)||e.attachTreeStructure(R),o===null&&this.refreshComboData(s),this.setParent(s,Be(n),R));const r=n.children||[];if(r.length){e.hasTreeStructure(J)||e.attachTreeStructure(J);const a=r.filter(c=>e.hasNode(c));a.forEach(c=>this.setParent(c,s,J)),a.length!==r.length&&this.updateNodeData([{id:s,children:a}])}})}preventUpdateNodeLikeHierarchy(t){this.enableUpdateNodeLikeHierarchy=!1,t(),this.enableUpdateNodeLikeHierarchy=!0}updateData(t){const{nodes:e,edges:n,combos:s}=t;this.batch(()=>{this.updateNodeData(e),this.updateComboData(s),this.updateEdgeData(n)}),this.computeZIndex(t,"update")}updateNodeData(t=[]){if(!t.length)return;const{model:e}=this;this.batch(()=>{const n=[];t.forEach(s=>{const o=v(s),r=H(e.getNode(o));if(oe(r,s))return;const a=Mt(r,s);this.pushChange({value:a,original:r,type:I.NodeUpdated}),e.mergeNodeData(o,a),n.push(a)}),this.updateNodeLikeHierarchy(n)}),this.computeZIndex({nodes:t},"update")}refreshData(){const{nodes:t,edges:e,combos:n}=this.getData();t.forEach(s=>{this.pushChange({value:s,original:s,type:I.NodeUpdated})}),e.forEach(s=>{this.pushChange({value:s,original:s,type:I.EdgeUpdated})}),n.forEach(s=>{this.pushChange({value:s,original:s,type:I.ComboUpdated})})}syncNodeLikeDatum(t){const{model:e}=this,n=v(t);if(!e.hasNode(n))return;const s=H(e.getNode(n)),o=Mt(s,t);e.mergeNodeData(n,o)}syncEdgeDatum(t){const{model:e}=this,n=v(t);if(!e.hasEdge(n))return;const s=H(e.getEdge(n)),o=Mt(s,t);e.mergeEdgeData(n,o)}updateEdgeData(t=[]){if(!t.length)return;const{model:e}=this;this.batch(()=>{t.forEach(n=>{const s=v(n),o=H(e.getEdge(s));if(oe(o,n))return;n.source&&o.source!==n.source&&e.updateEdgeSource(s,n.source),n.target&&o.target!==n.target&&e.updateEdgeTarget(s,n.target);const r=Mt(o,n);this.pushChange({value:r,original:o,type:I.EdgeUpdated}),e.mergeEdgeData(s,r)})}),this.computeZIndex({edges:t},"update")}updateComboData(t=[]){if(!t.length)return;const{model:e}=this;e.batch(()=>{const n=[];t.forEach(s=>{const o=v(s),r=H(e.getNode(o));if(oe(r,s))return;const a=Mt(r,s);this.pushChange({value:a,original:r,type:I.ComboUpdated}),e.mergeNodeData(o,a),n.push(a)}),this.updateNodeLikeHierarchy(n)}),this.computeZIndex({combos:t},"update")}setParent(t,e,n,s=!0){if(t===e)return;const o=this.getNodeLikeDatum(t),r=Be(o);if(r!==e&&n===R){const a={id:t,combo:e};this.isCombo(t)?this.syncNodeLikeDatum(a):this.syncNodeLikeDatum(a)}this.model.setParent(t,e,n),s&&n===R&&Rr([r,e]).forEach(a=>{a!==void 0&&this.refreshComboData(a)})}refreshComboData(t){const e=this.getComboData([t])[0],n=this.getAncestorsData(t,R);e&&this.pushChange({value:e,original:e,type:I.ComboUpdated}),n.forEach(s=>{this.pushChange({value:s,original:s,type:I.ComboUpdated})})}getElementPosition(t){const e=this.getElementDataById(t);return V(e)}translateNodeLikeBy(t,e){this.isCombo(t)?this.translateComboBy(t,e):this.translateNodeBy(t,e)}translateNodeLikeTo(t,e){this.isCombo(t)?this.translateComboTo(t,e):this.translateNodeTo(t,e)}translateNodeBy(t,e){const n=this.getElementPosition(t),s=T(n,[...e,0].slice(0,3));this.translateNodeTo(t,s)}translateNodeTo(t,e){const[n=0,s=0,o=0]=e;this.preventUpdateNodeLikeHierarchy(()=>{this.updateNodeData([{id:t,style:{x:n,y:s,z:o}}])})}translateComboBy(t,e){const[n=0,s=0,o=0]=e;if([n,s,o].some(isNaN)||[n,s,o].every(c=>c===0))return;const r=this.getComboData([t])[0];if(!r)return;const a=new Set;Kt(r,c=>{const l=v(c);if(a.has(l))return;a.add(l);const[d,h,u]=V(c),f=Mt(c,{style:{x:d+n,y:h+s,z:u+o}});this.pushChange({value:f,original:c,type:this.isCombo(l)?I.ComboUpdated:I.NodeUpdated}),this.model.mergeNodeData(l,f)},c=>this.getChildrenData(v(c)),"BT")}translateComboTo(t,e){var n;if(e.some(isNaN))return;const[s=0,o=0,r=0]=e,a=(n=this.getComboData([t]))===null||n===void 0?void 0:n[0];if(!a)return;const[c,l,d]=V(a),h=s-c,u=o-l,f=r-d;Kt(a,g=>{const p=v(g),[y,m,E]=V(g),b=Mt(g,{style:{x:y+h,y:m+u,z:E+f}});this.pushChange({value:b,original:g,type:this.isCombo(p)?I.ComboUpdated:I.NodeUpdated}),this.model.mergeNodeData(p,b)},g=>this.getChildrenData(v(g)),"BT")}removeData(t){const{nodes:e,edges:n,combos:s}=t;this.batch(()=>{this.removeEdgeData(n),this.removeNodeData(e),this.removeComboData(s),this.latestRemovedComboIds=new Set(s)})}removeNodeData(t=[]){t.length&&this.batch(()=>{t.forEach(e=>{this.removeEdgeData(this.getRelatedEdgesData(e).map(v)),this.pushChange({value:this.getNodeData([e])[0],type:I.NodeRemoved}),this.removeNodeLikeHierarchy(e)}),this.model.removeNodes(t)})}removeEdgeData(t=[]){t.length&&(t.forEach(e=>this.pushChange({value:this.getEdgeData([e])[0],type:I.EdgeRemoved})),this.model.removeEdges(t))}removeComboData(t=[]){t.length&&this.batch(()=>{t.forEach(e=>{this.pushChange({value:this.getComboData([e])[0],type:I.ComboRemoved}),this.removeNodeLikeHierarchy(e),this.comboIds.delete(e)}),this.model.removeNodes(t)})}removeNodeLikeHierarchy(t){if(this.model.hasTreeStructure(R)){const e=Be(this.getNodeLikeDatum(t));this.setParent(t,void 0,R,!1),this.model.getChildren(t,R).forEach(n=>{const s=H(n),o=v(s);this.setParent(v(s),e,R,!1);const r=Mt(s,{id:v(s),combo:e});this.pushChange({value:r,original:s,type:this.isCombo(o)?I.ComboUpdated:I.NodeUpdated}),this.model.mergeNodeData(v(s),r)}),Ze(e)||this.refreshComboData(e)}}getElementType(t){if(this.model.hasNode(t))return this.isCombo(t)?"combo":"node";if(this.model.hasEdge(t))return"edge";throw new Error(St(`Unknown element type of id: ${t}`))}destroy(){const{model:t}=this,e=t.getAllNodes(),n=t.getAllEdges();t.removeEdges(n.map(s=>s.id)),t.removeNodes(e.map(s=>s.id)),this.context={}}}var ye=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class Kd{constructor(t){this.elementMap={},this.shapeTypeMap={},this.paletteStyle={},this.defaultStyle={},this.stateStyle={},this.visibilityCache=new WeakMap,this.context=t}init(){this.initContainer()}initContainer(){if(!this.container||this.container.destroyed){const{canvas:t}=this.context;this.container=t.appendChild(new Oo({className:"elements"}))}}emit(t,e){e.silence||W(this.context.graph,t)}forEachElementData(t){Qt.forEach(e=>{const n=this.context.model.getElementsDataByType(e);t(e,n)})}getElementType(t,e){var n;const{options:s,graph:o}=this.context,r=((n=s[t])===null||n===void 0?void 0:n.type)||e.type;return r?typeof r=="string"?r:r.call(o,e):t==="edge"?"line":"circle"}getTheme(t){return Do(this.context.options)[t]||{}}getThemeStyle(t){return this.getTheme(t).style||{}}getThemeStateStyle(t,e){const{state:n={}}=this.getTheme(t);return Object.assign({},...e.map(s=>n[s]||{}))}computePaletteStyle(){const{options:t}=this.context;this.paletteStyle={},this.forEachElementData((e,n)=>{var s,o;const r=Object.assign({},di((s=this.getTheme(e))===null||s===void 0?void 0:s.palette),di((o=t[e])===null||o===void 0?void 0:o.palette));r!=null&&r.field&&Object.assign(this.paletteStyle,Fa(n,r))})}getPaletteStyle(t,e){const n=this.paletteStyle[e];return n?t==="edge"?{stroke:n}:{fill:n}:{}}computeElementDefaultStyle(t,e){var n;const{options:s}=this.context,o=((n=s[t])===null||n===void 0?void 0:n.style)||{};"transform"in o&&Array.isArray(o.transform)&&(o.transform=[...o.transform]),this.defaultStyle[v(e.datum)]=li(o,e)}computeElementsDefaultStyle(t){const{graph:e}=this.context;this.forEachElementData((n,s)=>{const o=s.length;for(let r=0;r<o;r++){const a=s[r];(t===void 0||t.includes(v(a)))&&this.computeElementDefaultStyle(n,{datum:a,graph:e})}})}getDefaultStyle(t){return this.defaultStyle[t]||{}}getElementState(t){try{const{model:e}=this.context;return e.getElementState(t)}catch{return[]}}getElementStateStyle(t,e,n){var s,o;const{options:r}=this.context,a=((o=(s=r[t])===null||s===void 0?void 0:s.state)===null||o===void 0?void 0:o[e])||{};return li(a,n)}computeElementStatesStyle(t,e,n){this.stateStyle[v(n.datum)]=Object.assign({},...e.map(s=>this.getElementStateStyle(t,s,n)))}computeElementsStatesStyle(t){const{graph:e}=this.context;this.forEachElementData((n,s)=>{const o=s.length;for(let r=0;r<o;r++){const a=s[r];if(t===void 0||t.includes(v(a))){const c=this.getElementState(v(a));this.computeElementStatesStyle(n,c,{datum:a,graph:e})}}})}getStateStyle(t){return this.stateStyle[t]||{}}computeStyle(t,e){t&&["translate","zIndex"].includes(t)||(this.computePaletteStyle(),this.computeElementsDefaultStyle(e),this.computeElementsStatesStyle(e))}getElement(t){return this.elementMap[t]}getNodes(){return this.context.model.getNodeData().map(({id:t})=>this.elementMap[t])}getEdges(){return this.context.model.getEdgeData().map(t=>this.elementMap[v(t)])}getCombos(){return this.context.model.getComboData().map(({id:t})=>this.elementMap[t])}getElementComputedStyle(t,e){const n=v(e),s=this.getThemeStyle(t),o=this.getPaletteStyle(t,n),r=e.style||{},a=this.getDefaultStyle(n),c=this.getThemeStateStyle(t,this.getElementState(n)),l=this.getStateStyle(n),d=Object.assign({},s,o,r,a,c,l);if(t==="combo"){const h=this.context.model.getChildrenData(n),f=!!d.collapsed?[]:h.map(v).filter(g=>this.getElement(g));Object.assign(d,{childrenNode:f,childrenData:h})}return d}getDrawData(t){this.init();const e=this.computeChangesAndDrawData(t);if(!e)return null;const{type:n="draw",stage:s=n}=t;return this.markDestroyElement(e.drawData),this.computeStyle(s),{type:n,stage:s,data:e}}draw(t={animation:!0}){const e=this.getDrawData(t);if(!e)return;const{data:{drawData:{add:n,update:s,remove:o}}}=e;return this.destroyElements(o,t),this.createElements(n,t),this.updateElements(s,t),this.setAnimationTask(t,e)}preLayoutDraw(){return ye(this,arguments,void 0,function*(t={animation:!0}){var e,n;const s=this.getDrawData(t);if(!s)return;const{data:{drawData:o}}=s;yield(n=(e=this.context.layout)===null||e===void 0?void 0:e.preLayout)===null||n===void 0?void 0:n.call(e,o);const{add:r,update:a,remove:c}=o;return this.destroyElements(c,t),this.createElements(r,t),this.updateElements(a,t),this.setAnimationTask(t,s)})}setAnimationTask(t,e){const{animation:n,silence:s}=t,{data:{dataChanges:o,drawData:r},stage:a,type:c}=e;return this.context.animation.animate(n,s?{}:{before:()=>this.emit(new z(O.BEFORE_DRAW,{dataChanges:o,animation:n,stage:a,render:c==="render"}),t),beforeAnimate:l=>this.emit(new ot(O.BEFORE_ANIMATE,q.DRAW,l,r),t),afterAnimate:l=>this.emit(new ot(O.AFTER_ANIMATE,q.DRAW,l,r),t),after:()=>this.emit(new z(O.AFTER_DRAW,{dataChanges:o,animation:n,stage:a,render:c==="render",firstRender:this.context.graph.rendered===!1}),t)})}computeChangesAndDrawData(t){const{model:e}=this.context,n=e.getChanges(),s=Xs(n);if(s.length===0)return null;const{NodeAdded:o=[],NodeUpdated:r=[],NodeRemoved:a=[],EdgeAdded:c=[],EdgeUpdated:l=[],EdgeRemoved:d=[],ComboAdded:h=[],ComboUpdated:u=[],ComboRemoved:f=[]}=rn(s,m=>m.type),g=m=>new Map(m.map(E=>{const b=E.value;return[v(b),b]})),p={add:{nodes:g(o),edges:g(c),combos:g(h)},update:{nodes:g(r),edges:g(l),combos:g(u)},remove:{nodes:g(a),edges:g(d),combos:g(f)}},y=this.transformData(p,t);return e.clearChanges(),{dataChanges:n,drawData:y}}transformData(t,e){const n=this.context.transform.getTransformInstance();return Object.values(n).reduce((s,o)=>o.beforeDraw(s,e),t)}createElement(t,e,n){var s;const o=v(e);if(this.getElement(o))return;const a=this.getElementType(t,e),c=this.getElementComputedStyle(t,e),l=wt(t,a);if(!l)return yt.warn(`The element ${a} of ${t} is not registered.`);this.emit(new ie(O.BEFORE_ELEMENT_CREATE,t,e),n);const d=this.container.appendChild(new l({id:o,context:this.context,style:c}));this.shapeTypeMap[o]=a,this.elementMap[o]=d;const{stage:h="enter"}=n;(s=this.context.animation)===null||s===void 0||s.add({element:d,elementType:t,stage:h,originalStyle:Object.assign({},d.attributes),updatedStyle:c},{after:()=>{var u;this.emit(new ie(O.AFTER_ELEMENT_CREATE,t,e),n),(u=d.onCreate)===null||u===void 0||u.call(d)}})}createElements(t,e){const{nodes:n,edges:s,combos:o}=t;[["node",n],["combo",o],["edge",s]].forEach(([a,c])=>{c.forEach(l=>this.createElement(a,l,e))})}getUpdateStageStyle(t,e,n){const{stage:s="update"}=n;if(s==="translate")if(t==="node"||t==="combo"){const{style:{x:o=0,y:r=0,z:a=0}={}}=e;return{x:o,y:r,z:a}}else return{};return this.getElementComputedStyle(t,e)}updateElement(t,e,n){var s;const o=v(e),{stage:r="update"}=n,a=this.getElement(o);if(!a)return()=>null;this.emit(new ie(O.BEFORE_ELEMENT_UPDATE,t,e),n);const c=this.getElementType(t,e),l=this.getUpdateStageStyle(t,e,n);this.shapeTypeMap[o]!==c&&(a.destroy(),delete this.shapeTypeMap[o],delete this.elementMap[o],this.createElement(t,e,{animation:!1,silence:!0}));const d=r!=="visibility"?r:l.visibility==="hidden"?"hide":"show";d==="hide"&&delete l.visibility,(s=this.context.animation)===null||s===void 0||s.add({element:a,elementType:t,stage:d,originalStyle:Object.assign({},a.attributes),updatedStyle:l},{before:()=>{const h=this.elementMap[o];r!=="collapse"&&As(h,l),r==="visibility"&&(Fd(h,"opacity")||zd(h,"opacity"),this.visibilityCache.set(h,d==="show"?"visible":"hidden"),d==="show"&&Zt(h,"visible"))},after:()=>{var h;const u=this.elementMap[o];r==="collapse"&&As(u,l),d==="hide"&&Zt(u,this.visibilityCache.get(u)),this.emit(new ie(O.AFTER_ELEMENT_UPDATE,t,e),n),(h=u.onUpdate)===null||h===void 0||h.call(u)}})}updateElements(t,e){const{nodes:n,edges:s,combos:o}=t;[["node",n],["combo",o],["edge",s]].forEach(([a,c])=>{c.forEach(l=>this.updateElement(a,l,e))})}markDestroyElement(t){Object.values(t.remove).forEach(e=>{e.forEach(n=>{const s=v(n),o=this.getElement(s);o&&Zc(o)})})}destroyElement(t,e,n){var s;const{stage:o="exit"}=n,r=v(e),a=this.elementMap[r];if(!a)return()=>null;this.emit(new ie(O.BEFORE_ELEMENT_DESTROY,t,e),n),(s=this.context.animation)===null||s===void 0||s.add({element:a,elementType:t,stage:o,originalStyle:Object.assign({},a.attributes),updatedStyle:{}},{after:()=>{var c;this.clearElement(r),a.destroy(),(c=a.onDestroy)===null||c===void 0||c.call(a),this.emit(new ie(O.AFTER_ELEMENT_DESTROY,t,e),n)}})}destroyElements(t,e){const{nodes:n,edges:s,combos:o}=t;[["combo",o],["edge",s],["node",n]].forEach(([a,c])=>{c.forEach(l=>this.destroyElement(a,l,e))})}clearElement(t){delete this.paletteStyle[t],delete this.defaultStyle[t],delete this.stateStyle[t],delete this.elementMap[t],delete this.shapeTypeMap[t]}alignLayoutResultToElement(t,e){var n,s;const o=(n=t.nodes)===null||n===void 0?void 0:n.find(r=>v(r)===e);if(o){const r=V(this.context.model.getNodeLikeDatum(e)),a=V(o),c=P(r,a);(s=t.nodes)===null||s===void 0||s.forEach(l=>{var d,h,u;!((d=l.style)===null||d===void 0)&&d.x&&(l.style.x+=c[0]),!((h=l.style)===null||h===void 0)&&h.y&&(l.style.y+=c[1]),!((u=l.style)===null||u===void 0)&&u.z&&(l.style.z+=c[2]||0)})}}collapseNode(t,e){return ye(this,void 0,void 0,function*(){var n;const{animation:s,align:o}=e,{model:r,layout:a}=this.context,c=this.computeChangesAndDrawData({stage:"collapse",animation:s});if(!c)return;this.markDestroyElement(c.drawData);const l=yield a.simulate();o&&this.alignLayoutResultToElement(l,t),r.updateData(l);const d=this.computeChangesAndDrawData({stage:"collapse",animation:s});if(!d)return;const{drawData:h}=d,{add:u,remove:f,update:g}=h;this.markDestroyElement(h);const p={animation:s,stage:"collapse",data:h};this.destroyElements(f,p),this.createElements(u,p),this.updateElements(g,p),yield(n=this.context.animation.animate(s,{beforeAnimate:y=>this.emit(new ot(O.BEFORE_ANIMATE,q.COLLAPSE,y,h),p),afterAnimate:y=>this.emit(new ot(O.AFTER_ANIMATE,q.COLLAPSE,y,h),p)},{collapse:{target:t,descendants:Array.from(f.nodes).map(([,y])=>v(y)),position:V(g.nodes.get(t))}}))===null||n===void 0?void 0:n.finished})}expandNode(t,e){return ye(this,void 0,void 0,function*(){var n;const{model:s,layout:o}=this.context,{animation:r,align:a}=e,c=V(s.getNodeData([t])[0]),l=this.computeChangesAndDrawData({stage:"expand",animation:r});if(!l)return;const{drawData:{add:d}}=l;this.createElements(d,{animation:!1,stage:"expand",target:t}),this.context.animation.clear();const h=yield o.simulate();a&&this.alignLayoutResultToElement(h,t),s.updateData(h),this.computeStyle("expand");const u=this.computeChangesAndDrawData({stage:"collapse",animation:r});if(!u)return;const{drawData:f}=u,{update:g}=f,p={animation:r,stage:"expand",data:f};d.edges.forEach(y=>g.edges.set(v(y),y)),d.nodes.forEach(y=>g.nodes.set(v(y),y)),this.updateElements(g,p),yield(n=this.context.animation.animate(r,{beforeAnimate:y=>this.emit(new ot(O.BEFORE_ANIMATE,q.EXPAND,y,f),p),afterAnimate:y=>this.emit(new ot(O.AFTER_ANIMATE,q.EXPAND,y,f),p)},{expand:{target:t,descendants:Array.from(d.nodes).map(([,y])=>v(y)),position:c}}))===null||n===void 0?void 0:n.finished})}collapseCombo(t,e){return ye(this,void 0,void 0,function*(){var n;const{model:s,element:o}=this.context;if(s.getAncestorsData(t,R).some(p=>Q(p)))return;const r=o.getElement(t),a=r.getComboPosition(Object.assign(Object.assign({},r.attributes),{collapsed:!0})),c=this.computeChangesAndDrawData({stage:"collapse",animation:e});if(!c)return;const{dataChanges:l,drawData:d}=c;this.markDestroyElement(d);const{update:h,remove:u}=d,f={animation:e,stage:"collapse",data:d};this.destroyElements(u,f),this.updateElements(h,f);const g=p=>Array.from(p).map(([,y])=>v(y));yield(n=this.context.animation.animate(e,{before:()=>this.emit(new z(O.BEFORE_DRAW,{dataChanges:l,animation:e}),f),beforeAnimate:p=>this.emit(new ot(O.BEFORE_ANIMATE,q.COLLAPSE,p,d),f),afterAnimate:p=>this.emit(new ot(O.AFTER_ANIMATE,q.COLLAPSE,p,d),f),after:()=>this.emit(new z(O.AFTER_DRAW,{dataChanges:l,animation:e}),f)},{collapse:{target:t,descendants:[...g(u.nodes),...g(u.combos)],position:a}}))===null||n===void 0?void 0:n.finished})}expandCombo(t,e){return ye(this,void 0,void 0,function*(){var n;const{model:s}=this.context,o=V(s.getComboData([t])[0]);this.computeStyle("expand");const r=this.computeChangesAndDrawData({stage:"expand",animation:e});if(!r)return;const{dataChanges:a,drawData:c}=r,{add:l,update:d}=c,h={animation:e,stage:"expand",data:c,target:t};this.createElements(l,h),this.updateElements(d,h);const u=f=>Array.from(f).map(([,g])=>v(g));yield(n=this.context.animation.animate(e,{before:()=>this.emit(new z(O.BEFORE_DRAW,{dataChanges:a,animation:e}),h),beforeAnimate:f=>this.emit(new ot(O.BEFORE_ANIMATE,q.EXPAND,f,c),h),afterAnimate:f=>this.emit(new ot(O.AFTER_ANIMATE,q.EXPAND,f,c),h),after:()=>this.emit(new z(O.AFTER_DRAW,{dataChanges:a,animation:e}),h)},{expand:{target:t,descendants:[...u(l.nodes),...u(l.combos)],position:o}}))===null||n===void 0?void 0:n.finished})}clear(){this.container.destroy(),this.initContainer(),this.elementMap={},this.shapeTypeMap={},this.defaultStyle={},this.stateStyle={},this.paletteStyle={}}destroy(){this.clear(),this.container.destroy(),this.context={}}}var re=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})},Xd=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};class Gd{get presetOptions(){return{animation:!!wo(this.context.options,!0)}}get options(){const{options:t}=this.context;return t.layout}constructor(t){this.instances=[],this.context=t}getLayoutInstance(){return this.instances}preLayout(t){return re(this,void 0,void 0,function*(){var e,n,s,o;const{graph:r,model:a}=this.context,{add:c}=t;W(r,new z(O.BEFORE_LAYOUT,{type:"pre"}));const l=yield(e=this.context.layout)===null||e===void 0?void 0:e.simulate();(n=l==null?void 0:l.nodes)===null||n===void 0||n.forEach(d=>{const h=v(d),u=c.nodes.get(h);a.syncNodeLikeDatum(d),u&&Object.assign(u.style,d.style)}),(s=l==null?void 0:l.edges)===null||s===void 0||s.forEach(d=>{const h=v(d),u=c.edges.get(h);a.syncEdgeDatum(d),u&&Object.assign(u.style,d.style)}),(o=l==null?void 0:l.combos)===null||o===void 0||o.forEach(d=>{const h=v(d),u=c.combos.get(h);a.syncNodeLikeDatum(d),u&&Object.assign(u.style,d.style)}),W(r,new z(O.AFTER_LAYOUT,{type:"pre"})),this.transformDataAfterLayout("pre",t)})}postLayout(){return re(this,arguments,void 0,function*(t=this.options){if(!t)return;const e=Array.isArray(t)?t:[t],{graph:n}=this.context;W(n,new z(O.BEFORE_LAYOUT,{type:"post"}));for(let s=0;s<e.length;s++){const o=e[s],r=this.getLayoutData(o),a=Object.assign(Object.assign({},this.presetOptions),o);W(n,new z(O.BEFORE_STAGE_LAYOUT,{options:a,index:s}));const c=yield this.stepLayout(r,a,s);W(n,new z(O.AFTER_STAGE_LAYOUT,{options:a,index:s})),o.animation||this.updateElementPosition(c,!1)}W(n,new z(O.AFTER_LAYOUT,{type:"post"})),this.transformDataAfterLayout("post")})}transformDataAfterLayout(t,e){const n=this.context.transform.getTransformInstance();Object.values(n).forEach(s=>s.afterLayout(t,e))}simulate(){return re(this,void 0,void 0,function*(){if(!this.options)return{};const t=Array.isArray(this.options)?this.options:[this.options];let e={};for(let n=0;n<t.length;n++){const s=t[n],o=this.getLayoutData(s);e=yield this.stepLayout(o,Object.assign(Object.assign(Object.assign({},this.presetOptions),s),{animation:!1}),n)}return e})}stepLayout(t,e,n){return re(this,void 0,void 0,function*(){return el(e)?yield this.treeLayout(t,e,n):yield this.graphLayout(t,e,n)})}graphLayout(t,e,n){return re(this,void 0,void 0,function*(){const{animation:s,enableWorker:o,iterations:r=300}=e,a=this.initGraphLayout(e);if(!a)return{};if(this.instances[n]=a,this.instance=a,o){const l=a;return this.supervisor=new Lr(l.graphData2LayoutModel(t),l.instance,{iterations:r}),Ke(yield this.supervisor.execute())}if(ii(a))return s?yield a.execute(t,{onTick:l=>{this.updateElementPosition(l,!1)}}):(a.execute(t),a.stop(),a.tick(r));const c=yield a.execute(t);if(s){const l=this.updateElementPosition(c,s);yield l==null?void 0:l.finished}return c})}treeLayout(t,e,n){return re(this,void 0,void 0,function*(){const{type:s,animation:o}=e,r=wt("layout",s);if(!r)return{};const{nodes:a=[],edges:c=[]}=t,l=new Ls({nodes:a.map(g=>({id:v(g),data:g.data||{}})),edges:c.map(g=>({id:v(g),source:g.source,target:g.target,data:g.data||{}}))});Ud(l);const d={nodes:[],edges:[]},h={nodes:[],edges:[]};l.getRoots(J).forEach(g=>{Kt(g,b=>{b.children=l.getSuccessors(b.id)},b=>l.getSuccessors(b.id),"TB");const p=r(g,e),{x:y,y:m,z:E=0}=p;Kt(p,b=>{const{id:S,x:D,y:w,z:C=0}=b;d.nodes.push({id:S,style:{x:y,y:m,z:E}}),h.nodes.push({id:S,style:{x:D,y:w,z:C}})},b=>b.children,"TB")});const f=this.inferTreeLayoutOffset(h);if(lo(h,f),o){lo(d,f),this.updateElementPosition(d,!1);const g=this.updateElementPosition(h,o);yield g==null?void 0:g.finished}return h})}inferTreeLayoutOffset(t){var e;let[n,s]=[1/0,-1/0],[o,r]=[1/0,-1/0];(e=t.nodes)===null||e===void 0||e.forEach(p=>{const{x:y=0,y:m=0}=p.style||{};n=Math.min(n,y),s=Math.max(s,y),o=Math.min(o,m),r=Math.max(r,m)});const{canvas:a}=this.context,c=a.getSize(),[l,d]=a.getCanvasByViewport([0,0]),[h,u]=a.getCanvasByViewport(c);if(n>=l&&s<=h&&o>=d&&r<=u)return[0,0];const f=(l+h)/2,g=(d+u)/2;return[f-(n+s)/2,g-(o+r)/2]}stopLayout(){this.instance&&ii(this.instance)&&(this.instance.stop(),this.instance=void 0),this.supervisor&&(this.supervisor.stop(),this.supervisor=void 0),this.animationResult&&(this.animationResult.finish(),this.animationResult=void 0)}getLayoutData(t){const{nodeFilter:e=()=>!0,preLayout:n=!1,isLayoutInvisibleNodes:s=!1}=t,{nodes:o,edges:r,combos:a}=this.context.model.getData(),{element:c,model:l}=this.context,d=p=>c.getElement(p),h=n?p=>{var y;return!s&&(((y=p.style)===null||y===void 0?void 0:y.visibility)==="hidden"||l.getAncestorsData(p.id,J).some(Q)||l.getAncestorsData(p.id,R).some(Q))?!1:e(p)}:p=>{const y=v(p),m=d(y);return!m||Dn(m)?!1:e(p)},u=o.filter(h),f=new Map(u.map(p=>[v(p),p]));a.forEach(p=>f.set(v(p),p));const g=r.filter(({source:p,target:y})=>f.has(p)&&f.has(y));return{nodes:u,edges:g,combos:a}}initGraphLayout(t){var e;const{element:n,viewport:s}=this.context,{type:o,enableWorker:r,animation:a,iterations:c}=t,l=Xd(t,["type","enableWorker","animation","iterations"]),[d,h]=s.getCanvasSize(),u=[d/2,h/2],f=(e=t==null?void 0:t.nodeSize)!==null&&e!==void 0?e:E=>{const b=n==null?void 0:n.getElement(E.id);return b?b.attributes.size:n==null?void 0:n.getElementComputedStyle("node",E).size},g=wt("layout",o);if(!g)return yt.warn(`The layout of ${o} is not registered.`);const p=Object.getPrototypeOf(g.prototype)===Tn.prototype?g:sl(g,this.context),y=new p(this.context),m={nodeSize:f,width:d,height:h,center:u};switch(y.id){case"d3-force":case"d3-force-3d":Object.assign(m,{center:{x:d/2,y:h/2,z:0}});break}return Gt(y.options,m,l),y}updateElementPosition(t,e){const{model:n,element:s}=this.context;return s?(n.updateData(t),s.draw({animation:e,silence:!0})):null}destroy(){var t;this.stopLayout(),this.context={},(t=this.supervisor)===null||t===void 0||t.kill(),this.supervisor=void 0,this.instance=void 0,this.instances=[],this.animationResult=void 0}}const lo=(i,t)=>{var e;const[n,s]=t;(e=i.nodes)===null||e===void 0||e.forEach(o=>{if(o.style){const{x:r=0,y:a=0}=o.style;o.style.x=r+n,o.style.y=a+s}else o.style={x:n,y:s}})};function Zd(i){return[qd].reduce((e,n)=>n(e),i)}function qd(i){return!i.layout||Array.isArray(i.layout)||"preLayout"in i.layout||["antv-dagre","combo-combined","compact-box","circular","concentric","dagre","fishbone","grid","indented","mds","radial","random","snake","dendrogram","mindmap"].includes(i.layout.type)&&(i.layout.preLayout=!0),i}class Qd extends ks{constructor(t){super(t),this.category="plugin",this.setPlugins(this.context.options.plugins||[])}setPlugins(t){this.setExtensions(t)}getPluginInstance(t){const e=this.extensionMap[t];if(e)return e;yt.warn(`Cannot find the plugin ${t}, will try to find it by type.`);const n=this.extensions.find(s=>s.type===t);if(n)return this.extensionMap[n.key]}}const Ue=["update-related-edges","collapse-expand-node","collapse-expand-combo","get-edge-actual-ends","arrange-draw-order"];class Jd extends ks{constructor(t){super(t),this.category="transform",this.setTransforms(this.context.options.transforms||[])}getTransforms(){}setTransforms(t){this.setExtensions([...Ue.slice(0,Ue.length-1),...t,Ue[Ue.length-1]])}getTransformInstance(t){return t?this.extensionMap[t]:this.extensionMap}}var me=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class th{get padding(){return mt(this.context.options.padding)}get paddingOffset(){const[t,e,n,s]=this.padding,[o,r,a]=[(s-e)/2,(t-n)/2,0];return[o,r,a]}constructor(t){this.landmarkCounter=0,this.context=t;const[e,n]=this.paddingOffset,{zoom:s,rotation:o,x:r=e,y:a=n}=t.options;this.transform({mode:"absolute",scale:s,translate:[r,a],rotate:o},!1)}get camera(){const{canvas:t}=this.context;return new Proxy(t.getCamera(),{get:(e,n)=>{const o=Object.entries(t.getLayers()).filter(([a])=>!["main"].includes(a)).map(([,a])=>a.getCamera()),r=e[n];if(typeof r=="function")return(...a)=>{const c=r.apply(e,a);return o.forEach(l=>{l[n].apply(l,a)}),c}}})}createLandmark(t){return this.camera.createLandmark(`landmark-${this.landmarkCounter++}`,t)}getAnimation(t){const e=wo(this.context.options,t);return e?Te(Object.assign({},e),["easing","duration"]):!1}getCanvasSize(){const{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e,n]}getCanvasCenter(){const{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e/2,n/2,0]}getViewportCenter(){const[t,e]=this.camera.getPosition();return[t,e,0]}getGraphCenter(){return this.context.graph.getViewportByCanvas(this.getCanvasCenter())}getZoom(){return this.camera.getZoom()}getRotation(){return this.camera.getRoll()}getTranslateOptions(t){const{camera:e}=this,{mode:n,translate:s=[]}=t,o=this.getZoom(),r=e.getPosition(),a=e.getFocalPoint(),[c,l]=this.getCanvasCenter(),[d=0,h=0,u=0]=s,f=ut([-d,-h,-u],o);return n==="relative"?{position:T(r,f),focalPoint:T(a,f)}:{position:T([c,l,r[2]],f),focalPoint:T([c,l,a[2]],f)}}getRotateOptions(t){const{mode:e,rotate:n=0}=t;return{roll:e==="relative"?this.camera.getRoll()+n:n}}getZoomOptions(t){const{zoomRange:e}=this.context.options,n=this.camera.getZoom(),{mode:s,scale:o=1}=t;return bo(s==="relative"?n*o:o,...e)}transform(t,e){return me(this,void 0,void 0,function*(){const{graph:n}=this.context,{translate:s,rotate:o,scale:r,origin:a}=t;this.cancelAnimation();const c=this.getAnimation(e);if(W(n,new He(O.BEFORE_TRANSFORM,t)),!o&&r&&!s&&a&&!c){this.camera.setZoomByViewportPoint(this.getZoomOptions(t),a),W(n,new He(O.AFTER_TRANSFORM,t));return}const l={};if(s&&Object.assign(l,this.getTranslateOptions(t)),U(o)&&Object.assign(l,this.getRotateOptions(t)),U(r)&&Object.assign(l,{zoom:this.getZoomOptions(t)}),c)return W(n,new ot(O.BEFORE_ANIMATE,q.TRANSFORM,null,t)),new Promise(d=>{this.transformResolver=d,this.camera.gotoLandmark(this.createLandmark(l),Object.assign(Object.assign({},c),{onfinish:()=>{W(n,new ot(O.AFTER_ANIMATE,q.TRANSFORM,null,t)),W(n,new He(O.AFTER_TRANSFORM,t)),this.transformResolver=void 0,d()}}))});this.camera.gotoLandmark(this.createLandmark(l),{duration:0}),W(n,new He(O.AFTER_TRANSFORM,t))})}fitView(t,e){return me(this,void 0,void 0,function*(){const[n,s,o,r]=this.padding,{when:a="always",direction:c="both"}=t||{},[l,d]=this.context.canvas.getSize(),h=l-r-s,u=d-n-o,f=this.context.canvas.getBounds(),g=this.getBBoxInViewport(f),[p,y]=jt(g),m=c==="x"&&p>=h||c==="y"&&y>=u||c==="both"&&p>=h&&y>=u;if(a==="overflow"&&!m)return yield this.fitCenter({animation:e});const E=h/p,b=u/y,S=c==="x"?E:c==="y"?b:Math.min(E,b),D=this.getAnimation(e);yield this.transform({mode:"relative",scale:S,translate:T(P(this.getCanvasCenter(),this.getBBoxInViewport(f).center),ut(this.paddingOffset,S))},D)})}fitCenter(t){return me(this,void 0,void 0,function*(){const e=this.context.canvas.getBounds();yield this.focus(e,t)})}focusElements(t){return me(this,arguments,void 0,function*(e,n={}){const{element:s}=this.context;if(!s)return;const o=a=>n.shapes?a.getShape(n.shapes).getRenderBounds():a.getRenderBounds(),r=Ae(e.map(a=>o(s.getElement(a))));yield this.focus(r,n)})}focus(t,e){return me(this,void 0,void 0,function*(){const n=this.context.graph.getViewportByCanvas(t.center),s=e.position||this.getCanvasCenter(),o=P(s,n);yield this.transform({mode:"relative",translate:T(o,this.paddingOffset)},e.animation)})}getBBoxInViewport(t){const{min:e,max:n}=t,{graph:s}=this.context,[o,r]=s.getViewportByCanvas(e),[a,c]=s.getViewportByCanvas(n),l=new Xt;return l.setMinMax([o,r,0],[a,c,0]),l}isInViewport(t,e=!1,n=0){const{graph:s}=this.context,o=this.getCanvasSize(),[r,a]=s.getCanvasByViewport([0,0]),[c,l]=s.getCanvasByViewport(o);let d=new Xt;return d.setMinMax([r,a,0],[c,l,0]),n&&(d=zt(d,n)),de(t)?ht(t,d):e?da(t,d):d.intersects(t)}cancelAnimation(){var t,e;!((t=this.camera.landmarks)===null||t===void 0)&&t.length&&this.camera.cancelLandmarkAnimation(),(e=this.transformResolver)===null||e===void 0||e.call(this)}}var L=function(i,t,e,n){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function a(d){try{l(n.next(d))}catch(h){r(h)}}function c(d){try{l(n.throw(d))}catch(h){r(h)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(i,t||[])).next())})};class qs extends So{constructor(t){var e;super(),this.options={},this.rendered=!1,this.destroyed=!1,this.context={model:new Yd},this.isCollapsingExpanding=!1,this.onResize=cn(()=>{this.resize()},300),this._setOptions(Object.assign({},qs.defaultOptions,t),!0),this.context.graph=this,this.options.autoResize&&((e=globalThis.addEventListener)===null||e===void 0||e.call(globalThis,"resize",this.onResize))}getOptions(){return this.options}setOptions(t){this._setOptions(t,!1)}_setOptions(t,e){if(this.updateCanvas(t),Object.assign(this.options,Zd(t)),e){const{data:u}=t;u&&this.addData(u);return}const{behaviors:n,combo:s,data:o,edge:r,layout:a,node:c,plugins:l,theme:d,transforms:h}=t;n&&this.setBehaviors(n),o&&this.setData(o),c&&this.setNode(c),r&&this.setEdge(r),s&&this.setCombo(s),a&&this.setLayout(a),d&&this.setTheme(d),l&&this.setPlugins(l),h&&this.setTransforms(h)}getSize(){return this.context.canvas?this.context.canvas.getSize():[this.options.width||0,this.options.height||0]}setSize(t,e){t&&(this.options.width=t),e&&(this.options.height=e),this.resize(t,e)}setZoomRange(t){this.options.zoomRange=t}getZoomRange(){return this.options.zoomRange}setNode(t){this.options.node=t,this.context.model.refreshData()}setEdge(t){this.options.edge=t,this.context.model.refreshData()}setCombo(t){this.options.combo=t,this.context.model.refreshData()}getTheme(){return this.options.theme}setTheme(t){this.options.theme=A(t)?t(this.getTheme()):t}setLayout(t){this.options.layout=A(t)?t(this.getLayout()):t}getLayout(){return this.options.layout}setBehaviors(t){var e;this.options.behaviors=A(t)?t(this.getBehaviors()):t,(e=this.context.behavior)===null||e===void 0||e.setBehaviors(this.options.behaviors)}updateBehavior(t){this.setBehaviors(e=>e.map(n=>typeof n=="object"&&n.key===t.key?Object.assign(Object.assign({},n),t):n))}getBehaviors(){return this.options.behaviors||[]}setPlugins(t){var e;this.options.plugins=A(t)?t(this.getPlugins()):t,(e=this.context.plugin)===null||e===void 0||e.setPlugins(this.options.plugins)}updatePlugin(t){this.setPlugins(e=>e.map(n=>typeof n=="object"&&n.key===t.key?Object.assign(Object.assign({},n),t):n))}getPlugins(){return this.options.plugins||[]}getPluginInstance(t){return this.context.plugin.getPluginInstance(t)}setTransforms(t){var e;this.options.transforms=A(t)?t(this.getTransforms()):t,(e=this.context.transform)===null||e===void 0||e.setTransforms(this.options.transforms)}updateTransform(t){this.setTransforms(e=>e.map(n=>typeof n=="object"&&n.key===t.key?Object.assign(Object.assign({},n),t):n)),this.context.model.refreshData()}getTransforms(){return this.options.transforms||[]}getData(){return this.context.model.getData()}getElementData(t){return Array.isArray(t)?t.map(e=>this.context.model.getElementDataById(e)):this.context.model.getElementDataById(t)}getNodeData(t){return t===void 0?this.context.model.getNodeData():Array.isArray(t)?this.context.model.getNodeData(t):this.context.model.getNodeLikeDatum(t)}getEdgeData(t){return t===void 0?this.context.model.getEdgeData():Array.isArray(t)?this.context.model.getEdgeData(t):this.context.model.getEdgeDatum(t)}getComboData(t){return t===void 0?this.context.model.getComboData():Array.isArray(t)?this.context.model.getComboData(t):this.context.model.getNodeLikeDatum(t)}setData(t){this.context.model.setData(A(t)?t(this.getData()):t)}addData(t){this.context.model.addData(A(t)?t(this.getData()):t)}addNodeData(t){this.context.model.addNodeData(A(t)?t(this.getNodeData()):t)}addEdgeData(t){this.context.model.addEdgeData(A(t)?t(this.getEdgeData()):t)}addComboData(t){this.context.model.addComboData(A(t)?t(this.getComboData()):t)}addChildrenData(t,e){this.context.model.addChildrenData(t,e)}updateData(t){this.context.model.updateData(A(t)?t(this.getData()):t)}updateNodeData(t){this.context.model.updateNodeData(A(t)?t(this.getNodeData()):t)}updateEdgeData(t){this.context.model.updateEdgeData(A(t)?t(this.getEdgeData()):t)}updateComboData(t){this.context.model.updateComboData(A(t)?t(this.getComboData()):t)}removeData(t){this.context.model.removeData(A(t)?t(this.getData()):t)}removeNodeData(t){this.context.model.removeNodeData(A(t)?t(this.getNodeData()):t)}removeEdgeData(t){this.context.model.removeEdgeData(A(t)?t(this.getEdgeData()):t)}removeComboData(t){this.context.model.removeComboData(A(t)?t(this.getComboData()):t)}getElementType(t){return this.context.model.getElementType(t)}getRelatedEdgesData(t,e="both"){return this.context.model.getRelatedEdgesData(t,e)}getNeighborNodesData(t){return this.context.model.getNeighborNodesData(t)}getAncestorsData(t,e){return this.context.model.getAncestorsData(t,e)}getParentData(t,e){return this.context.model.getParentData(t,e)}getChildrenData(t){return this.context.model.getChildrenData(t)}getDescendantsData(t){return this.context.model.getDescendantsData(t)}getElementDataByState(t,e){return this.context.model.getElementDataByState(t,e)}initCanvas(){return L(this,void 0,void 0,function*(){var t;if(this.context.canvas)return yield this.context.canvas.ready;const{container:e="container",width:n,height:s,renderer:o,cursor:r,background:a,canvas:c,devicePixelRatio:l=(t=globalThis.devicePixelRatio)!==null&&t!==void 0?t:1}=this.options;if(e instanceof so)this.context.canvas=e,r&&e.setCursor(r),o&&e.setRenderer(o),yield e.ready;else{const d=le(e)?document.getElementById(e):e,h=ro(d);this.emit(O.BEFORE_CANVAS_INIT,{container:d,width:n,height:s});const u=Object.assign(Object.assign({},c),{container:d,width:n||h[0],height:s||h[1],background:a,renderer:o,cursor:r,devicePixelRatio:l}),f=new so(u);this.context.canvas=f,yield f.ready,this.emit(O.AFTER_CANVAS_INIT,{canvas:f})}})}updateCanvas(t){var e,n;const{renderer:s,cursor:o,height:r,width:a}=t,c=this.context.canvas;c&&(s&&(this.emit(O.BEFORE_RENDERER_CHANGE,{renderer:this.options.renderer}),c.setRenderer(s),this.emit(O.AFTER_RENDERER_CHANGE,{renderer:s})),o&&c.setCursor(o),(U(a)||U(r))&&this.setSize((e=a??this.options.width)!==null&&e!==void 0?e:0,(n=r??this.options.height)!==null&&n!==void 0?n:0))}initRuntime(){this.context.options=this.options,this.context.batch||(this.context.batch=new Wd(this.context)),this.context.plugin||(this.context.plugin=new Qd(this.context)),this.context.viewport||(this.context.viewport=new th(this.context)),this.context.transform||(this.context.transform=new Jd(this.context)),this.context.element||(this.context.element=new Kd(this.context)),this.context.animation||(this.context.animation=new $d(this.context)),this.context.layout||(this.context.layout=new Gd(this.context)),this.context.behavior||(this.context.behavior=new Vd(this.context))}prepare(){return L(this,void 0,void 0,function*(){if(yield Promise.resolve(),this.destroyed)throw new Error(St("The graph instance has been destroyed"));yield this.initCanvas(),this.initRuntime()})}render(){return L(this,void 0,void 0,function*(){if(yield this.prepare(),W(this,new z(O.BEFORE_RENDER)),this.options.layout)if(!this.rendered&&nl(this.options.layout)){const t=yield this.context.element.preLayoutDraw({type:"render"});yield Promise.all([t==null?void 0:t.finished,this.autoFit()])}else{const t=this.context.element.draw({type:"render"});yield Promise.all([t==null?void 0:t.finished,this.context.layout.postLayout()]),yield this.autoFit()}else{const t=this.context.element.draw({type:"render"});yield Promise.all([t==null?void 0:t.finished,this.autoFit()])}this.rendered=!0,W(this,new z(O.AFTER_RENDER))})}draw(){return L(this,void 0,void 0,function*(){var t;yield this.prepare(),yield(t=this.context.element.draw())===null||t===void 0?void 0:t.finished})}layout(t){return L(this,void 0,void 0,function*(){yield this.context.layout.postLayout(t)})}stopLayout(){this.context.layout.stopLayout()}clear(){return L(this,void 0,void 0,function*(){const{model:t,element:e}=this.context;t.setData({}),t.clearChanges(),e==null||e.clear()})}destroy(){var t;W(this,new z(O.BEFORE_DESTROY));const{layout:e,animation:n,element:s,model:o,canvas:r,behavior:a,plugin:c}=this.context;c==null||c.destroy(),a==null||a.destroy(),e==null||e.destroy(),n==null||n.destroy(),s==null||s.destroy(),o.destroy(),r==null||r.destroy(),this.options={},this.context={},this.off(),(t=globalThis.removeEventListener)===null||t===void 0||t.call(globalThis,"resize",this.onResize),this.destroyed=!0,W(this,new z(O.AFTER_DESTROY))}getCanvas(){return this.context.canvas}resize(t,e){var n;const s=ro((n=this.context.canvas)===null||n===void 0?void 0:n.getContainer()),o=[t||s[0],e||s[1]];if(!this.context.canvas)return;const r=this.context.canvas.getSize();$(o,r)||(W(this,new z(O.BEFORE_SIZE_CHANGE,{size:o})),this.context.canvas.resize(...o),W(this,new z(O.AFTER_SIZE_CHANGE,{size:o})))}fitView(t,e){return L(this,void 0,void 0,function*(){var n;yield(n=this.context.viewport)===null||n===void 0?void 0:n.fitView(t,e)})}fitCenter(t){return L(this,void 0,void 0,function*(){var e;yield(e=this.context.viewport)===null||e===void 0?void 0:e.fitCenter({animation:t})})}autoFit(){return L(this,void 0,void 0,function*(){const{autoFit:t}=this.context.options;if(t)if(le(t))t==="view"?yield this.fitView():t==="center"&&(yield this.fitCenter());else{const{type:e,animation:n}=t;e==="view"?yield this.fitView(t.options,n):e==="center"&&(yield this.fitCenter(n))}})}focusElement(t,e){return L(this,void 0,void 0,function*(){var n;yield(n=this.context.viewport)===null||n===void 0?void 0:n.focusElements(Array.isArray(t)?t:[t],{animation:e})})}zoomBy(t,e,n){return L(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"relative",scale:t,origin:n},e)})}zoomTo(t,e,n){return L(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"absolute",scale:t,origin:n},e)})}getZoom(){return this.context.viewport.getZoom()}rotateBy(t,e,n){return L(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"relative",rotate:t,origin:n},e)})}rotateTo(t,e,n){return L(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"absolute",rotate:t,origin:n},e)})}getRotation(){return this.context.viewport.getRotation()}translateBy(t,e){return L(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"relative",translate:t},e)})}translateTo(t,e){return L(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"absolute",translate:t},e)})}getPosition(){return P([0,0],this.getCanvasByViewport([0,0]))}translateElementBy(t,e){return L(this,arguments,void 0,function*(n,s,o=!0){var r,a;const[c,l]=at(n)?[n,(r=s)!==null&&r!==void 0?r:!0]:[{[n]:s},o];Object.entries(c).forEach(([d,h])=>this.context.model.translateNodeLikeBy(d,h)),yield(a=this.context.element.draw({animation:l,stage:"translate"}))===null||a===void 0?void 0:a.finished})}translateElementTo(t,e){return L(this,arguments,void 0,function*(n,s,o=!0){var r,a;const[c,l]=at(n)?[n,(r=s)!==null&&r!==void 0?r:!0]:[{[n]:s},o];Object.entries(c).forEach(([d,h])=>this.context.model.translateNodeLikeTo(d,h)),yield(a=this.context.element.draw({animation:l,stage:"translate"}))===null||a===void 0?void 0:a.finished})}getElementPosition(t){return this.context.model.getElementPosition(t)}getElementRenderStyle(t){return Eo(this.context.element.getElement(t).attributes,["context"])}setElementVisibility(t,e){return L(this,arguments,void 0,function*(n,s,o=!0){var r,a;const[c,l]=at(n)?[n,(r=s)!==null&&r!==void 0?r:!0]:[{[n]:s},o],d={nodes:[],edges:[],combos:[]};Object.entries(c).forEach(([f,g])=>{const p=this.getElementType(f);d[`${p}s`].push({id:f,style:{visibility:g}})});const{model:h,element:u}=this.context;h.preventUpdateNodeLikeHierarchy(()=>{h.updateData(d)}),yield(a=u.draw({animation:l,stage:"visibility"}))===null||a===void 0?void 0:a.finished})}showElement(t,e){return L(this,void 0,void 0,function*(){const n=Array.isArray(t)?t:[t];yield this.setElementVisibility(Object.fromEntries(n.map(s=>[s,"visible"])),e)})}hideElement(t,e){return L(this,void 0,void 0,function*(){const n=Array.isArray(t)?t:[t];yield this.setElementVisibility(Object.fromEntries(n.map(s=>[s,"hidden"])),e)})}getElementVisibility(t){var e,n;const s=this.context.element.getElement(t);return(n=(e=s==null?void 0:s.style)===null||e===void 0?void 0:e.visibility)!==null&&n!==void 0?n:"visible"}setElementZIndex(t,e){return L(this,void 0,void 0,function*(){var n;const s={nodes:[],edges:[],combos:[]},o=at(t)?t:{[t]:e};Object.entries(o).forEach(([c,l])=>{const d=this.getElementType(c);s[`${d}s`].push({id:c,style:{zIndex:l}})});const{model:r,element:a}=this.context;r.preventUpdateNodeLikeHierarchy(()=>r.updateData(s)),yield(n=a.draw({animation:!1,stage:"zIndex"}))===null||n===void 0?void 0:n.finished})}frontElement(t){return L(this,void 0,void 0,function*(){const e=Array.isArray(t)?t:[t],{model:n}=this.context,s={};e.map(o=>{const r=n.getFrontZIndex(o);if(n.getElementType(o)==="combo"){const c=n.getAncestorsData(o,R).at(-1)||this.getComboData(o),l=[c,...n.getDescendantsData(v(c))],d=r-ao(c);l.forEach(u=>{s[v(u)]=this.getElementZIndex(v(u))+d});const{internal:h}=_s(l.map(v),u=>n.getRelatedEdgesData(u));h.forEach(u=>{const f=v(u);s[f]=this.getElementZIndex(f)+d})}else s[o]=r}),yield this.setElementZIndex(s)})}getElementZIndex(t){return ao(this.context.model.getElementDataById(t))}setElementState(t,e){return L(this,arguments,void 0,function*(n,s,o=!0){var r,a;const[c,l]=at(n)?[n,(r=s)!==null&&r!==void 0?r:!0]:[{[n]:s},o],d=u=>u?Array.isArray(u)?u:[u]:[],h={nodes:[],edges:[],combos:[]};Object.entries(c).forEach(([u,f])=>{const g=this.getElementType(u);h[`${g}s`].push({id:u,states:d(f)})}),this.updateData(h),yield(a=this.context.element.draw({animation:l,stage:"state"}))===null||a===void 0?void 0:a.finished})}getElementState(t){return this.context.model.getElementState(t)}getElementRenderBounds(t){return this.context.element.getElement(t).getRenderBounds()}collapseElement(t){return L(this,arguments,void 0,function*(e,n=!0){const{model:s,element:o}=this.context;if(Q(s.getNodeLikeData([e])[0])||this.isCollapsingExpanding)return;typeof n=="boolean"&&(n={animation:n,align:!0});const r=s.getElementType(e);yield this.frontElement(e),this.isCollapsingExpanding=!0,this.setElementCollapsibility(e,!0),r==="node"?yield o.collapseNode(e,n):r==="combo"&&(yield o.collapseCombo(e,!!n.animation)),this.isCollapsingExpanding=!1})}expandElement(t){return L(this,arguments,void 0,function*(e,n=!0){const{model:s,element:o}=this.context;if(!Q(s.getNodeLikeData([e])[0])||this.isCollapsingExpanding)return;typeof n=="boolean"&&(n={animation:n,align:!0});const r=s.getElementType(e);this.isCollapsingExpanding=!0,this.setElementCollapsibility(e,!1),r==="node"?yield o.expandNode(e,n):r==="combo"&&(yield o.expandCombo(e,!!n.animation)),this.isCollapsingExpanding=!1})}setElementCollapsibility(t,e){const n=this.getElementType(t);n==="node"?this.updateNodeData([{id:t,style:{collapsed:e}}]):n==="combo"&&this.updateComboData([{id:t,style:{collapsed:e}}])}toDataURL(){return L(this,arguments,void 0,function*(t={}){return this.context.canvas.toDataURL(t)})}getCanvasByViewport(t){return this.context.canvas.getCanvasByViewport(t)}getViewportByCanvas(t){return this.context.canvas.getViewportByCanvas(t)}getClientByCanvas(t){return this.context.canvas.getClientByCanvas(t)}getCanvasByClient(t){return this.context.canvas.getCanvasByClient(t)}getViewportCenter(){return this.context.viewport.getViewportCenter()}getCanvasCenter(){return this.context.viewport.getCanvasCenter()}on(t,e,n){return super.on(t,e,n)}once(t,e){return super.once(t,e)}off(t,e){return super.off(t,e)}}qs.defaultOptions={autoResize:!1,theme:"light",rotation:0,zoom:1,zoomRange:[.01,10]};var eh=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e};function gh(i,t){const{getNodeData:e=(a,c)=>{if(a.depth=c,!a.children)return a;const{children:l}=a,d=eh(a,["children"]);return Object.assign(Object.assign({},d),{children:l.map(h=>h.id)})},getEdgeData:n=(a,c)=>({source:a.id,target:c.id}),getChildren:s=a=>a.children||[]}={},o=[],r=[];return Kt(i,(a,c)=>{o.push(e(a,c));const l=s(a);for(const d of l)r.push(n(a,d))},a=>s(a),"TB"),{nodes:o,edges:r}}class nh extends Wt{beforeDraw(t){const{add:e,update:n}=t,{model:s}=this.context;return[...e.edges.entries(),...n.edges.entries()].forEach(([,o])=>{ur(s,o)}),t}}const ur=(i,t)=>{const{source:e,target:n}=t,s=i.getElementDataById(e),o=i.getElementDataById(n),r=bi(s,h=>i.getParentData(h,R)),a=bi(o,h=>i.getParentData(h,R)),c=v(r),l=v(a),d={sourceNode:c,targetNode:l};return t.style?Object.assign(t.style,d):t.style=d,t},sh=(i,t,e)=>{const[n,s]=t,[o,r]=e;if(s===n)return o;const a=(i-n)/(s-n);return o+a*(r-o)},ih=(i,t,e)=>{const[n,s]=t,[o,r]=e,a=Math.log(i-n+1)/Math.log(s-n+1);return o+a*(r-o)},oh=(i,t,e,n=2)=>{const[s,o]=t,[r,a]=e,c=Math.pow((i-s)/(o-s),n);return r+c*(a-r)},rh=(i,t,e)=>{const[n,s]=t,[o,r]=e,a=Math.sqrt((i-n)/(s-n));return o+a*(r-o)};class ns extends Wt{constructor(t,e){super(t,Gt({},ns.defaultOptions,e)),this.assignSizeByCentrality=(n,s,o,r,a,c)=>{const l=[s,o],d=[r[0],a[0]],h=[r[1],a[1]],u=[r[2],a[2]],f=(g,p)=>{if(typeof c=="function")return c(g,l,p);switch(c){case"linear":return sh(g,l,p);case"log":return ih(g,l,p);case"pow":return oh(g,l,p,2);case"sqrt":return rh(g,l,p);default:return p[0]}};return[f(n,d),f(n,h),f(n,u)]}}beforeDraw(t){const{model:e}=this.context,n=e.getNodeData(),s=nt(this.options.maxSize),o=nt(this.options.minSize),r=this.getCentralities(this.options.centrality),a=r.size>0?Math.max(...r.values()):0,c=r.size>0?Math.min(...r.values()):0;return n.forEach(l=>{var d;const h=this.assignSizeByCentrality(r.get(v(l))||0,c,a,o,s,this.options.scale),u=(d=this.context.element)===null||d===void 0?void 0:d.getElement(v(l)),f={size:h};this.assignLabelStyle(f,h,l,u),(!u||!Ge(f,u.attributes))&&et(t,u?"update":"add","node",Gt(l,{style:f}),!0)}),t}assignLabelStyle(t,e,n,s){var o;const r=s?s.config.style:(o=this.context.element)===null||o===void 0?void 0:o.getElementComputedStyle("node",n);if(Object.assign(t,Te(r,["labelFontSize","labelLineHeight"])),this.options.mapLabelSize){const a=this.getLabelSizeByNodeSize(e,1/0,Number(t.labelFontSize));Object.assign(t,{labelFontSize:a,labelLineHeight:a+la(t.labelPadding)})}return t}getLabelSizeByNodeSize(t,e,n){const s=Math.min(...t)/2,[o,r]=Array.isArray(this.options.mapLabelSize)?this.options.mapLabelSize:[n,e];return Math.min(r,Math.max(s,o))}getCentralities(t){const{model:e}=this.context,n=e.getData();if(typeof t=="function")return t(n);const s=e.getRelatedEdgesData.bind(e);return Ro(n,s,t)}}ns.defaultOptions={centrality:{type:"degree"},maxSize:80,minSize:20,scale:"linear",mapLabelSize:!1};class ss extends Wt{constructor(t,e){super(t,Object.assign({},ss.defaultOptions,e))}get ref(){return this.context.model.getRootsData()[0]}afterLayout(){var t;const e=V(this.ref),{graph:n,model:s}=this.context;(t=s.getData().nodes)===null||t===void 0||t.forEach(r=>{var a;if(v(r)===v(this.ref))return;const c=No(P(V(r),e)),l=Math.abs(c)>Math.PI/2,d=!r.children||r.children.length===0,h=v(r),u=(a=this.context.element)===null||a===void 0?void 0:a.getElement(h);if(!u||!u.isVisible())return;const f=nt(n.getElementRenderStyle(h).size)[0]/2,g=(d?1:-1)*(f+this.options.offset),p=[["translate",g*Math.cos(c),g*Math.sin(c)],["rotate",l?oi(c)+180:oi(c)]];s.updateNodeData([{id:v(r),style:{labelTextAlign:l===d?"right":"left",labelTextBaseline:"middle",labelTransform:p}}])}),n.draw()}}ss.defaultOptions={offset:5};const ah="quadratic",ho=["top","top-right","right","right-bottom","bottom","bottom-left","left","left-top"];class is extends Wt{constructor(t,e){super(t,Object.assign({},is.defaultOptions,e)),this.cacheMergeStyle=new Map,this.getAffectedParallelEdges=n=>{const{add:{edges:s},update:{nodes:o,edges:r,combos:a},remove:{edges:c}}=n,{model:l}=this.context,d=new Map,h=(g,p)=>{l.getRelatedEdgesData(p).forEach(m=>!d.has(v(m))&&d.set(v(m),m))};o.forEach(h),a.forEach(h);const u=g=>{const p=l.getEdgeData().map(m=>ur(l,m));ch(g,p).forEach(m=>!d.has(v(m))&&d.set(v(m),m))};if(c.size&&c.forEach(u),s.size&&s.forEach(u),r.size){const g=rr(Xs(l.getChanges())).update.edges;r.forEach(p=>{var y;u(p);const m=(y=g.find(E=>v(E.value)===v(p)))===null||y===void 0?void 0:y.original;m&&!Qs(p,m)&&u(m)})}gt(this.options.edges)||d.forEach((g,p)=>!this.options.edges.includes(p)&&d.delete(p));const f=l.getEdgeData().map(v);return new Map([...d].sort((g,p)=>f.indexOf(g[0])-f.indexOf(p[0])))},this.applyBundlingStyle=(n,s,o)=>{const{edgeMap:r,reverses:a}=uo(s);r.forEach(c=>{c.forEach((l,d,h)=>{var u;const f=h.length,g=l.style||{};if(l.source===l.target){const m=ho.length;g.loopPlacement=ho[d%m],g.loopDist=Math.floor(d/m)*o+50}else if(f===1)g.curveOffset=0;else{const m=(d%2===0?1:-1)*(a[`${l.source}|${l.target}|${d}`]?-1:1);g.curveOffset=f%2===1?m*Math.ceil(d/2)*o*2:m*(Math.floor(d/2)*o*2+o)}const p=Object.assign(l,{type:ah,style:g}),y=(u=this.context.element)===null||u===void 0?void 0:u.getElement(v(l));(!y||!Ge(p.style,y.attributes))&&et(n,y?"update":"add","edge",p,!0)})})},this.resetEdgeStyle=n=>{const s=n.style||{},o=this.cacheMergeStyle.get(v(n))||{};return Object.keys(o).forEach(r=>{$(s[r],o[r])&&(n[r]?s[r]=n[r]:delete s[r])}),Object.assign(n,{style:s})},this.applyMergingStyle=(n,s)=>{const{edgeMap:o,reverses:r}=uo(s);o.forEach(a=>{var c;if(a.length===1){const d=a[0],h=(c=this.context.element)===null||c===void 0?void 0:c.getElement(v(d)),u=this.resetEdgeStyle(d);(!h||!Ge(u,h.attributes))&&et(n,h?"update":"add","edge",u);return}const l=a.map(({source:d,target:h,style:u={}},f)=>{const{startArrow:g,endArrow:p}=u,y={},[m,E]=r[`${d}|${h}|${f}`]?["endArrow","startArrow"]:["startArrow","endArrow"];return vs(g)&&(y[m]=g),vs(p)&&(y[E]=p),y}).reduce((d,h)=>Object.assign(Object.assign({},d),h),{});a.forEach((d,h,u)=>{var f;if(h!==0){et(n,"remove","edge",d);return}const g=Object.assign({},A(this.options.style)?this.options.style(u):this.options.style,{childrenData:u});this.cacheMergeStyle.set(v(d),g);const p=Object.assign(Object.assign({},d),{type:"line",style:Object.assign(Object.assign(Object.assign({},d.style),l),g)}),y=(f=this.context.element)===null||f===void 0?void 0:f.getElement(v(d));(!y||!Ge(p.style,y.attributes))&&et(n,y?"update":"add","edge",p,!0)})})}}beforeDraw(t){const e=this.getAffectedParallelEdges(t);return e.size===0||(this.options.mode==="bundle"?this.applyBundlingStyle(t,e,this.options.distance):this.applyMergingStyle(t,e)),t}}is.defaultOptions={mode:"bundle",distance:15};const uo=i=>{const t=new Map,e=new Set,n={},s=new Map;for(const[o,r]of i){if(e.has(o))continue;const{source:a,target:c}=r,l=`${a}-${c}`;t.has(l)||(t.set(l,[]),s.set(l,new Set));const d=t.get(l),h=s.get(l);d&&h&&!h.has(o)&&(d.push(r),h.add(o),e.add(o));for(const[u,f]of i)if(!(e.has(u)||u===o)&&Qs(r,f)){const g=t.get(l),p=s.get(l);g&&p&&!p.has(u)&&(g.push(f),p.add(u),a===f.target&&c===f.source&&(n[`${f.source}|${f.target}|${g.length-1}`]=!0),e.add(u))}}return{edgeMap:t,reverses:n}},ch=(i,t,e)=>t.filter(n=>Qs(n,i)),Qs=(i,t)=>{const{sourceNode:e,targetNode:n}=i.style||{},{sourceNode:s,targetNode:o}=t.style||{};return e===s&&n===o||e===o&&n===s};class lh extends Wt{beforeDraw(t,e){const{stage:n}=e;if(n==="visibility")return t;const{model:s}=this.context,{update:{nodes:o,edges:r,combos:a}}=t,c=(l,d)=>{s.getRelatedEdgesData(d).forEach(u=>!r.has(v(u))&&r.set(v(u),u))};return o.forEach(c),a.forEach(c),t}}const dh={animation:{"combo-collapse":Ao,"combo-expand":ra,"node-collapse":_o,"node-expand":ia,"path-in":To,"path-out":oa,fade:na,translate:sa},behavior:{"brush-select":Me,"click-select":un,"collapse-expand":wn,"create-edge":Cn,"drag-canvas":_n,"drag-element-force":ol,"drag-element":Ne,"fix-element-size":An,"focus-element":Mn,"hover-activate":Pn,"lasso-select":al,"auto-adapt-label":ln,"optimize-viewport-transform":Rn,"scroll-canvas":Ln,"zoom-canvas":Nn},combo:{circle:rc,rect:ac},edge:{cubic:te,line:xn,polyline:Sn,quadratic:On,"cubic-horizontal":vn,"cubic-radial":bn,"cubic-vertical":En},layout:{"antv-dagre":Kr,"combo-combined":Yr,"compact-box":ke.compactBox,"d3-force":Ur,"force-atlas2":Hr,circular:Vr,concentric:Wr,dagre:$r,dendrogram:ke.dendrogram,fishbone:In,force:Fr,fruchterman:zr,grid:jr,indented:ke.indented,mds:Br,mindmap:ke.mindmap,radial:kr,random:Ir,snake:kn},node:{circle:Jt,diamond:qa,ellipse:pn,hexagon:nc,html:yn,image:Zo,rect:ic,star:oc,donut:gn,triangle:mn},palette:{spectral:hl,tableau:ul,oranges:fl,greens:gl,blues:pl},theme:{dark:Ad,light:Pd},plugin:{"bubble-sets":jn,"edge-bundling":Fn,"edge-filter-lens":$n,"grid-line":Hn,background:Bn,contextmenu:zn,fisheye:Wn,fullscreen:Vn,history:Un,hull:Kn,legend:Xn,minimap:Gn,snapline:Zn,timebar:qn,toolbar:Qn,tooltip:Jn,watermark:ts},transform:{"arrange-draw-order":Rd,"collapse-expand-combo":Ld,"collapse-expand-node":Nd,"get-edge-actual-ends":nh,"map-node-size":ns,"place-radial-labels":ss,"process-parallel-edges":is,"update-related-edges":lh},shape:{circle:an,ellipse:mo,group:Oo,html:vo,image:$s,line:Es,path:Rt,polygon:yo,polyline:Nr,rect:_t,text:Rs,label:Ft,badge:ue}};function hh(){Object.entries(dh).forEach(([i,t])=>{Object.entries(t).forEach(([e,n])=>{Id(i,e,n)})})}hh();export{ue as B,x as C,Se as E,qs as G,rt as N,ic as R,O as a,Id as r,gh as t};
